(function($){"use strict";$.dataGrid=function(e){this.init(e)},$.extGrid=$.dataGrid,$.dataGrid.fn={},$.dataGrid.fn.extend=function(e){$.extend($.dataGrid.prototype,e)},$.dataGrid.extend=function(e){$.extend($.dataGrid,e)},$.dataGrid.extend({version:"1.2.6",padding:8,puglins:[],puglinsConf:{},puglinsEvent:{},defaults:{},eventMaps:{},aid:1,addExtConf:function(e){$.extend(this.puglinsConf,e)},addExtEvent:function(e){$.extend(this.puglinsEvent,e)},addEventMaps:function(e){$.extend(this.eventMaps,e)},template:{cache:{},helper:$.noop,compile:function(e,t){var n=this.cache[e]?this.cache[e]:new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return this.cache[e]=n,t?n(t):n}},getDefaults:function(e){var t={self:null,init:$.noop,renderTo:null,title:"",cls:"",iconCls:"",toolBars:!1,_toolItem:{text:"",cls:"",callBack:$.noop,disabled:!1},ltText:"",rowNumbersWidth:!1,rowNumbersExpand:!1,rowNumbers2Row:!0,rowTpl:"",showHeader:!0,showFooter:!1,headerTpl:"",containerCss:"datagrid-container-border",clsOverRow:"datagrid-row-over",clsSelectRow:"datagrid-row-selected",clsSingleRow:"datagrid-row-single",clsDoubleRow:"datagrid-row-double",border:!0,lazyLoadRow:!1,pageTotal:0,lazyMaxRow:0,lazyRows:[],lazyTopRows:5,lazyBottomRows:5,showLazyLoading:!0,_trHeight:-1,_lazyEdge:80,_csTop:0,_loadRowing:!1,_tq:0,_initLazy:!0,padding:$.dataGrid.padding,autoHeight:!1,minAutoHeight:50,maxAutoHeight:0,width:700,height:250,minWidth:0,minHeight:0,maxWidth:0,maxHeight:0,checkBox:!1,checkBoxWidth:"28px",checkBoxForceFit:!1,checkBoxTitle:'<input type="checkbox">',checkBoxFit:!1,editColumn:!1,editColumnTitle:"操作",editColumnFit:!0,editColumnForceFit:!1,editCellW:63,columns:[],moveColumnTm:500,moveColumns:!0,forceFit:!1,_columnMetaData:{field:"",index:"",title:"",width:"120px",minWidth:20,maxWidth:null,align:"left",_expand:!1,callBack:$.noop,hcls:"",bcls:"",fcls:"",sortable:!1,textLimit:!1,fitColumn:!0,casePerChange:!0,reader:{},forceFit:!0,disabled:!1},readerDef:"_default_",textLimit:!1,textLimitDef:"...",autoScrollToField:!0,autoScrollToRow:!0,scrollbarSize:!1,sTop:0,sLeft:0,_lTime:0,_lStart:0,_lSize:0,fitColumns:!0,data:[],emptyGridMsg:"",showEmptyGridMsg:!0,pk:"_pk",hideColumns:[],selectRows:[],isCreate:!1,isShow:!1,views:{},method:"post",url:"",loadMsg:"加载中,请稍后...",_lmt:0,cache:!0,cacheData:[],pageNumber:1,pageSize:10,dataType:"json",queryParams:{},singleSelect:!1,rowStyler:"",rowCallBack:$.noop,tpl:{},methodCall:{},template:template||$.dataGrid.template,isEscape:!1,noop:$.noop,denyRowEvents:!1,eventMaps:{},events:{onStart:$.noop,onViewCreate:$.noop,onShowContainer:$.noop,onFinish:$.noop,onBeforeLoad:$.noop,onLoadSuccess:$.noop,onLoadError:$.noop,onClickRow:$.noop,onColumnOver:$.noop,onColumnOut:$.noop,onOverCell:$.noop,onOutCell:$.noop,onOverRow:$.noop,onOutRow:$.noop,onDblClickRow:$.noop,onClickCell:$.noop,onDblClickCell:$.noop,onResizeColumnStart:$.noop,onResizeColumn:$.noop,onResizeColumnStop:$.noop,onAfterResize:$.noop,onSelect:$.noop,onUnselect:$.noop,onSelectAll:$.noop,onUnselectAll:$.noop,onHeaderContextMenu:$.noop,onHeaderCreate:$.noop,onToolBarCreate:$.noop,onRowContextMenu:$.noop,onCellContextMenu:$.noop,onBeforeRefresh:$.noop,onRefresh:$.noop,onShowGriding:$.noop,onShowGrid:$.noop,onBeforeShowGrid:$.noop,onGetData:$.noop,onClickRowNumber:$.noop,onShowColumn:$.noop,onHideColumn:$.noop,onBeforeHideColumn:$.noop,onBeforeShowColumn:$.noop,onLockColumn:$.noop,onViewSizeChange:$.noop,onSizeChange:$.noop,onFieldWidthChange:$.noop,onScroll:$.noop,onScrollBar:$.noop,onScrollEnd:$.noop,onDataChange:$.noop,onBeforeCellEdit:$.noop,onCellEdit:$.noop,onBeforeAddRow:$.noop,onAfterAddRow:$.noop,onBeforeUpdateRow:$.noop,onAfterUpdateRow:$.noop,onBeforeDeleteRow:$.noop,onAfterDeleteRow:$.noop,onShowGroup:$.noop,onHideGroup:$.noop,onAdd:$.noop,onUpdate:$.noop,onDelete:$.noop,onAjaxAdd:$.noop,onAjaxUpdate:$.noop,onAjaxDelete:$.noop,onColumnMove:$.noop,onColumnMoving:$.noop,onBeforeColumnMove:$.noop,onAutoColumnResize:$.noop,onShowLazyRows:$.noop,onLazyRowHide:$.noop,onUpdateHeaderRow:$.noop,onUpdateFooterRow:$.noop,onLazyRowShow:$.noop,onColumnValueChange:$.noop}};return $.extend(t.events,$.dataGrid.puglinsEvent),$.extend(t.eventMaps,$.dataGrid.eventMaps),$.extend(t,$.dataGrid.puglinsConf,e)},getToGridOptions:function(e){var t={options_from:"data-options",columns_from:"thead th",data_from:"tbody tr",footdata_from:"tfoot tr"};return $.extend(!0,t,e)},_undef:function(e,t){return e===undefined?t:e},_Tpl:{container:'<div class="datagrid-container <%=cls%> <%=border?containerCss:""%>" id="<%=id%>" style=" position:relative; overflow:hidden; width:<%=width%>px; height:<%=height%>px;"></div>',title:'<div class="datagrid-title <%=iconCls%>" id="title_<%=id%>"><%=title%></div>',toolbar:'<div class="datagrid-toolbar" id="toolbar_<%=id%>"></div>',grid:'<div class="datagrid-view" id="view_<%=id%>" style="width:1px; height:1px;"></div>',group_row:'<tr id="<%=id%>-group-row-<%=gid%>"  datagrid-group-row-id="<%=gid%>" class="datagrid-group-row"><td style="width:<%=w%>px" colspan="<%=colspan%>"><div  class="datagrid-group-cell"><%=html%>(<%=num%>)</div></td></tr>',view1:'<div class="datagrid-view1" id="view1_<%=id%>" style="width:<%=parseFloat(rowNumbersWidth)%>px;height:100%;"><div  class="datagrid-header" id="view1-datagrid-header-<%=id%>" style="width: 100%; z-index:40; position:relative;"><div class="datagrid-header-inner" id="view1-datagrid-header-inner-<%=id%>"><div class="datagrid-header-inner-wraper" id="datagrid-view1-header-inner-wraper-<%=id%>"><table class="datagrid-htable" id="view1-datagrid-header-inner-htable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-inner-htable-tbody-<%=id%>"></tbody></table></div></div><div class="datagrid-header-outer" id="view1-datagrid-header-outer-<%=id%>"><div class="datagrid-header-outer-wraper" id="datagrid-view1-header-outer-wraper-<%=id%>"><table class="datagrid-locktable" id="view1-datagrid-header-outer-locktable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-outer-locktable-tbody-<%=id%>"></tbody></table></div></div></div><div class="datagrid-body-wrap" id="view1-datagrid-body-wrap-<%=id%>" style="width: 100%; height:0px; overflow:hidden;zoom:1; "><div class="datagrid-body" id="view1-datagrid-body-<%=id%>" style="width: 100%;float:left;z-index:30;position:relative;"><table class="datagrid-btable" id="view1-datagrid-body-btable-<%=id%>" cellspacing="0" cellpadding="0" border="0"><tbody id="view1-datagrid-body-btable-tbody-<%=id%>"></tbody></table></div></div><div class="datagrid-footer" id="view1-datagrid-footer-<%=id%>" style="width: 100%; height:0px; overflow:hidden;position:relative;z-index:31;"><div id="view1-datagrid-footer-inner-<%=id%>"  class="datagrid-footer-inner"></div></div></div>',view2:'<div class="datagrid-view2" id="view2_<%=id%>" style="width:1px;height:100%;"><div  class="datagrid-header" id="view2-datagrid-header-<%=id%>" style="width: 100%;"><div class="datagrid-header-inner" id="view2-datagrid-header-inner-<%=id%>"><div class="datagrid-header-inner-wraper" id="datagrid-view2-header-inner-wraper-<%=id%>"><table class="datagrid-htable" id="view2-datagrid-header-inner-htable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-inner-htable-tbody-<%=id%>"></tbody></table></div></div><div class="datagrid-header-outer" id="view2-datagrid-header-outer-<%=id%>"><div class="datagrid-header-outer-wraper" id="datagrid-view2-header-outer-wraper-<%=id%>"><table class="datagrid-locktable" id="view2-datagrid-header-outer-locktable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-outer-locktable-tbody-<%=id%>"></tbody></table></div></div></div><div class="datagrid-body" id="view2-datagrid-body-<%=id%>" style="width: 100%;height:0px;"><table class="datagrid-btable" id="view2-datagrid-body-btable-<%=id%>" cellspacing="0" cellpadding="0" border="0"><tbody id="view2-datagrid-body-btable-tbody-<%=id%>"></tbody></table></div><div class="datagrid-footer" id="view2-datagrid-footer-<%=id%>" style="width: 100%; height:0px; "><div id="view2-datagrid-footer-inner-<%=id%>"  class="datagrid-footer-inner"></div></div></div>',pager:"",view1_header_inner_row:'<tr class="datagrid-header-row"><% if( rowNumbersWidth !== false ) {%><td align="center" class="datagrid-td-rownumber" style=""><div class="datagrid-header-rownumber" style="width:<%=parseFloat(rowNumbersWidth)%>px;"><%=ltText%></div></td><% } %></tr>',view1_header_outer_row:"",view2_header_inner_row:'<tr class="datagrid-header-row"><% var i=0;len = fields.length;  for(;i<len;i++) {%><td field="<%=fields[i]["field"]%>" align="<%=fields[i]["align"]%>"><div class="datagrid-header-wrap" field="<%=fields[i]["field"]%>" ><div class="datagrid-cell datagrid-cell-<%=fields[i]["field"]%> datagrid-cell-header-<%=fields[i]["field"]%> <%=fields[i]["hcls"]%>" ><span><%=fields[i]["title"]%></span></div></div></td><% } %></tr>',view2_header_outer_row:"",view1_row:"",view2_row:""}}),$.dataGrid.fn.extend({init:function(e){var t=this;t.initEvents(e),t.configs=$.extend({},$.dataGrid.getDefaults($.dataGrid.defaults),e);var n=t.configs;n.self=t,t._eventLocks={},n.template.isEscape=n.isEscape,n.template.helper("parseInt",parseInt),n.template.helper("parseFloat",parseFloat),n.id=n.id||t.getId(),n.gid=n.gid||"#view_"+n.id,n.init.call(t,n),t.sysEvents(),t.fireEvent("onStart",[n]),t.setContainer().setTitle().setToolBar().setGrid().show()},copyArray:function(e){var t=[];if(e){var n=e.length;for(var r=0;r<n;r++)r in e&&t.push(e[r])}return t},copy:function(e){if($.isArray(e))return this.copyArray(e);var t=e;return t},_undef:function(e,t){return e===undefined?t:e},inArray:function(e,t){if(t){var n=t.length,r=0;for(;r<n;r++)if(r in t&&t[r]==e)return r}return-1},tpl:function(e,t){var n=this,r=n.configs;typeof e=="undefined"&&(e=""),typeof t=="undefined"&&(t={});var i={};typeof r.cacheData["_tpl_"]=="undefined"?(r.cacheData._tpl_={},i=r.cacheData._tpl_):i=r.cacheData._tpl_;var s="";if(!r.template)return $.isFunction(e)?s=e.call(n,t):e in n?s=n[e](t):s=e,s;r.template.isEscape=r.isEscape;if($.isFunction(e))s=e.call(n,t);else if(e in r.tpl&&r.tpl[e])if(r.tpl[e]in i){var o=i[r.tpl[e]];s=o(t)}else{var o=r.template.compile(r.tpl[e]);i[r.tpl[e]]=o,s=o(t)}else if(e in n)s=n[e](t);else if(e in $.dataGrid._Tpl&&$.dataGrid._Tpl[e])if($.dataGrid._Tpl[e]in i){var o=i[$.dataGrid._Tpl[e]];s=o(t)}else{var o=r.template.compile($.dataGrid._Tpl[e]);i[$.dataGrid._Tpl[e]]=o,s=o(t)}else if(e.toString()in i){var o=i[e.toString()];s=o(t)}else{var o=r.template.compile(e.toString());i[e.toString()]=o,s=o(t)}return s},denyEventInvoke:function(){var e=this,t;if(arguments.length){var n=[];for(var r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n[0];i in e&&(e._denyEvent=!0,n.splice(0,1),t=e[i].apply(e,n),e._denyEvent=!1)}return t},methodInvoke:function(){var e=this,t,n=e._methodLocks||{};if(arguments.length){var r=[];for(var i=0;i<arguments.length;i++)r.push(arguments[i]);var s=r[0];if(n[s])return;s in e&&(r.splice(0,1),t=e[s].apply(e,r))}return t},bind:function(e,t,n){if(typeof e=="undefined")return!1;var t=t||$.noop,r=this,i=r.configs,s=i.events,o=e.split(".");e=o[0];var u=o.length==2?o[1]:"";e in i.eventMaps&&(e=i.eventMaps[e]),s[e]=r._undef(s[e],[]),$.isFunction(s[e])&&(s[e]=[]);var a={scope:n?n:r,func:t,ext:u},f=s[e].push(a);return f-1},one:function(e,t,n){if(typeof e=="undefined")return!1;var t=t||$.noop,r=this,n=n?n:r,i=function(){r.unbind(e,i.id);var s=t.apply(n,arguments);return s},s=null;return s=r.bind(e,i,n),i.id=s,s},unbind:function(e,t){var n=this,r=n.configs,i=r.events,t=n._undef(t,!1),s=e.split(".");e=s[0];var o=s.length==2?s[1]:"";e in r.eventMaps&&(e=r.eventMaps[e]);if(e in i){if($.isFunction(i[e]))return i[e]=[],n;if(t===!1)if(o=="")i[e]=[];else{var u=0;for(var a=0;a<i[e].length;a++){var f=i[e][a];$.isPlainObject(f)&&f.ext==o&&(i[e][a]=null,u++)}}else i[e][t]=null;return n}return n},lockMethod:function(e){var t=this,n=t._methodLocks||{};return n[e]=!0,t._methodLocks=n,!0},unLockMethod:function(e){var t=this,n=t._methodLocks||{};return n[e]=!1,t._methodLocks=n,!0},lockEvent:function(e){var t=this,n=t._eventLocks||{};return n[e]=!0,t._eventLocks=n,!0},unLockEvent:function(e){var t=this,n=t._eventLocks||{};return n[e]=!1,t._eventLocks=n,!0},fireEvent:function(e,t){var n=this;if(n._denyEvent)return;var r=n.configs,i=r.events[e],t=n._undef(t,[]),s=n._eventLocks||{};if(s[e])return;s[e]=!0;var o=!0;if($.isArray(i)){var u=i.length;for(var a=0;a<u;a++){var f=i[a];$.isPlainObject(f)?o=f.func.apply(f.scope,t):$.isFunction(f)&&(o=f.apply(n,t));if(o===!1)break}}else $.isFunction(i)&&(o=i.apply(n,t));return s[e]=!1,o},loadPuglins:function(){var e=this;$.each($.dataGrid.puglins,function(t){$.isFunction(this)&&this.call(e)})},initEvents:function(e){var t=this,n=e.events?e.events:{};if($.isPlainObject(n)&&!$.isEmptyObject(n))for(var r in n)$.isFunction(n[r])&&n[r]!==$.noop&&(n[r]=[n[r]])},sysEvents:function(){var e=this,t=e.configs;e.bind("onStart",e.onStart),e.bind("onStart",e.loadPuglins),e.bind("onUnselectAll",function(){this.checkCk(!1,0)}),e.bind("onSelectAll",function(){this.checkCk(!0,0)}),e.bind("onUnselect",function(){this.checkCk(!1,1)}),e.bind("onBeforeShowGrid",function(){this.checkCk(!1,2)}),e.bind("onViewCreate",e.onInitFieldWidth),e.bind("onSetPk",e.setPk),e.bind("onSizeChange",e.onFinishFieldWidth),e.bind("onShowGrid",e.resetHeader),e.bind("onScrollBar",e.onScrollBar),e.bind("onScroll",e.loadRows),e.bind("onDataChange",e.onDataChange),e.bind("onOverRow",e.onOverRow),e.bind("onOutRow",e.onOutRow),e.bind("onShowGrid",e.onDisplayField),e.bind("onViewSizeChange",e.isEmptyGrid),e.bind("onHeaderCreate",e.onHeaderCreate),e.bind("onColumnValueChange",e.onColumnValueChange),e.bind("onAfterAddRow",e.onDisplayField),e.bind("onAfterAddRow",e.removeEmptyDiv),e.bind("onFieldWidthChange",e.setForceFitColumn),e.bind("onViewSizeChange",e._autoHeight),e.bind("onViewSizeChange",e.onFitColumn),e.bind("onShowLazyRows",e.onDisplayField),e.bind("onUpdateHeaderRow",e.onDisplayField),e.bind("onUpdateFooterRow",e.onDisplayField),e.bind("onSizeChange",function(){this.loadRows(!0)}),e.bind("onLazyRowShow",e._selectLazyRows)},getId:function(){var e=$.dataGrid.aid++;return"datagrid_"+e},unique:function(){var e=$.dataGrid.aid++;return e},isNumber:function(e){return/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)?!0:!1},showLoading:function(e,t){var n=this,r=n.configs,e=typeof e=="undefined"?r.loadMsg:e;r._lmt&&clearTimeout(r._lmt);var t="#"+r.id,i=$("#"+r.id+"_datagrid-mask-wraper");if(i.length){var s=$("#"+r.id+"_datagrid-mask-msg");s.html(e),i.show();var o=s.outerWidth(!0);return s.css("marginLeft",-o/2+"px"),n}var u=$('<div id="'+r.id+'_datagrid-mask-wraper" class="datagrid-mask-wraper"><div id="'+r.id+'_datagrid-mask" class="datagrid-mask"></div><div id="'+r.id+'_datagrid-mask-spacer" class="datagrid-mask-spacer"></div><div id="'+r.id+'_datagrid-mask-msg" class="datagrid-mask-msg" style=" left: 50%;">'+e+"</div><div>");$(t).append(u);var s=$("#"+r.id+"_datagrid-mask-msg"),o=s.outerWidth(!0);return s.css("marginLeft",-o/2+"px"),u.click(function(e){e.stopPropagation(),e.preventDefault()}),n},hideLoading:function(e){var t=this,n=t.configs;return n._lmt=setTimeout(function(){$("#"+n.id+"_datagrid-mask-wraper").hide()},0),t},methodCall:function(e){var e=e||"",t=this,n=t.configs;return e!=""&&e in n.methodCall&&$.isFunction(n.methodCall[e])&&n.methodCall[e].call(t),t},onStart:function(){var e=this,t=e.configs,n=t.events?t.events:{},r=/^on[A-Z][\w|\.]*$/;for(var i in t)r.test(i)&&$.isFunction(t[i])&&t[i]!==$.noop&&e.bind(i,t[i],e)},getColumnData:function(e,t,n){var r=this,i=r.configs,e=r._undef(e,!1),t=r._undef(t,!1);if(e===!1)return r;var s=i.columns,o=0,u=s.length;for(;o<u;o++)if(s[o]["field"]==e)return t===!1?s[o]:typeof n=="undefined"?s[o][t]:(s[o][t]=n,i.columns=s,r.fireEvent("onColumnValueChange",[s[o],t,n,i]),r);return null},setColumnData:function(e,t,n){var r=this;return r.getColumnData(e,t,n)},onColumnValueChange:function(e,t,n){var r=this,i=r.configs;switch(t){case"width":r.setFieldWidth(e.field,n);break;case"title":$(".datagrid-cell-header-"+e.field+" >span:first",$("#"+i.id)).html(n);break;case"field":r.setFieldWidth(n,e[n].width),r.setGridHeader(),r.refreshDataCache();break;default:r.setGridHeader(),r.refreshDataCache()}},getData:function(){var e=this,t=e.configs,n=e.getAsync();return n?(t.cacheData.source=t.cacheData.source||t.data,t.cacheData.source):t.data},textLimit:function(e,t,n){},getTpl:function(e){return e},resizeContainer:function(e,t){var n=this,r=n.configs,i=$("#"+r.id);r.width=n._undef(e,r.width),r.height=n._undef(t,r.height),r.minWidth>0&&(r.width=Math.max(r.width,r.minWidth)),r.minHeight>0&&(r.height=Math.max(r.height,r.minHeight)),r.maxWidth>0&&(r.width=Math.min(r.width,r.maxWidth)),r.maxHeight>0&&(r.height=Math.min(r.height,r.maxHeight));var e=r.width,t=r.height;return e-=i.outerWidth()-i.width(),t-=i.outerHeight()-i.height(),i.css({width:e,height:t}),{width:e,height:t}},setContainer:function(e){var e=e||{},t=this,e=t.configs,n=t.tpl("container",e);return e.renderTo.html(n),t.resizeContainer(),t},setTitle:function(e){var t=this,n=t.configs;n.title=typeof e=="undefined"?n.title:e;if(n.title=="")return t;var r=t.tpl("title",n);return t.configs.views.title=$(r),t},getTools:function(e){var t=this,n=t.configs;if($.isPlainObject(e))var e=[e];if(!$.isArray(e)&&!$.isPlainObject(e))return $(e);var r=n._toolItem,i='<table cellspacing="0" cellpadding="0" border="0"><tbody><tr>{$tools}</tr></tbody></table>',s="",o=0,u=e.length;for(;o<u;o++)if($.isPlainObject(e[o])){e[o]=$.extend({},r,e[o]),e[o]["cls"]!=""&&(e[o].cls+=" l-btn-icon-left");var a=e[o].disabled?"l-btn-disabled":"";s+='<td><a href="javascript:void(0)" class="l-btn l-btn-plain '+a+'" indexid="'+o+'"><span class="l-btn-left"><span class="l-btn-text '+e[o].cls+'">'+e[o].text+"</span></span></a></td>"}else e[o]=="|"||e[o]=="-"||e[o]==";"||e[o]==","?s+='<td><div class="datagrid-btn-separator"></div></td>':s+="<td>"+e[o]+"</td>";i=i.replace("{$tools}",s);var i=$(i);return i.find(".l-btn").each(function(n){$(this).click(function(n){var r=$(this).attr("indexid");e[r].callBack.call(t,this,e[r]),n.stopPropagation(),n.preventDefault()})}),i},setToolBar:function(){var e=this,t=e.configs;if(t.toolBars===!1)return e;var n=e.tpl("toolbar",t);e.configs.views.toolbar=$(n);var r=e.getTools(t.toolBars);return r!==!1&&e.configs.views.toolbar.append(r),e.fireEvent("onToolBarCreate",[e.configs.views.toolbar,t.toolBars,t]),e.methodCall("setToolBar"),e},_setGridWH:function(){var e=this,t=e.configs,n=t.views,r=n.grid,i=0;for(var s in n){if(s=="grid")continue;i+=n[s].outerHeight(!0)}var o=$("#"+t.id);r._outerHeight(o.height()-i),r._outerWidth(o.width())},setGrid:function(){var e=this,t=e.configs,n=t.views;if(!n.grid){var r=e.tpl("grid",t);e.configs.views.grid=$(r)}return e.methodCall("setGrid"),e},checkCk:function(e,t){var n=this,r=n.configs,i=r.gid,s=i,e=n._undef(e,!1),t=n._undef(t,0);if(t==1&&r.lazyLoadRow)return;$("#view2-datagrid-header-inner-htable-tbody-"+r.id).find(">.datagrid-header-row td[field='ck']").find("input:checkbox").each(function(t){this.checked=e?!0:!1})},getScrollbarSize:function(){var e=this,t=e.configs;if(!t.scrollbarSize){var n=document.body,r=document.createElement("div");r.style.width=r.style.height="100px",r.style.overflow="scroll",r.style.position="absolute",n.appendChild(r),t.scrollbarSize={width:r.offsetWidth-r.clientWidth,height:r.offsetHeight-r.clientHeight},n.removeChild(r)}return t.scrollbarSize},scrollToField:function(e){var t=this,n=t.configs,r=$("#view2-datagrid-header-"+n.id);if(!r.length)return t;var i=t.getColumnList();if(t.inArray(e,i)==-1)return t;if(t.inArray(e,n.hideColumns)!=-1)return t;var s=t.fireEvent("onBeforeScrollToField",[e,n]);if(s===!1)return s;var o=t.getScrollbarSize(),u=r.offset(),a=r.outerWidth(),f=$("#view2-datagrid-body-"+n.id),l=f.get(0).scrollHeight;l>f.outerHeight()&&(a-=o.width);var c=$(">tr.datagrid-header-row td[field='"+e+"']","#view2-datagrid-header-inner-htable-tbody-"+n.id);if(!c.length)return t;var h=c.offset(),p=c.outerWidth(),d=0;u.left>h.left?d=u.left-h.left:u.left+a<h.left+p&&(d=u.left+a-(h.left+p));var v=0;return v=n.sLeft-d,n.sLeft=v,t.onScroll(!0),t.fireEvent("onAfterScrollToField",[e,n]),t},scrollToRow:function(e){var t=this,n=t.configs,r=t.fireEvent("onBeforeScrollToRow",[e,n]);if(r===!1)return r;if(n.lazyLoadRow&&t.inArray(e,n.lazyRows)==-1)return n.sTop=n._trHeight*e,t.fireEvent("onScroll",[]),t;var i=$("#view2-datagrid-body-"+n.id);if(!i.length)return t;var s=t.getScrollbarSize(),o=i.offset(),u=i.outerHeight(),a=i.get(0).scrollWidth;a>i.outerWidth()&&(u-=s.height);var f=$("#"+n.id+"-row-"+e);if(!f.length)return t;var l=f.offset(),c=f.outerHeight(),h=0;o.top>l.top?h=o.top-l.top:o.top+u<l.top+c&&(h=o.top+u-(l.top+c));var p=0;return p=n.sTop-h,n.sTop=p,t.onScroll(!0),t.fireEvent("onAfterScrollToRow",[e,n]),t},_autoHeight:function(){var e=this,t=e.configs;t.autoHeight&&e.autoHeight()},autoHeight:function(){var e=this,t=e.configs,n=$("#"+t.id),r=$("#view_"+t.id),i=e.getScrollbarSize();$("#view2-datagrid-body-"+t.id).css("overflow-y","hidden");var s=n.outerHeight()-r.outerHeight(),o=$("#view2-datagrid-header-"+t.id).outerHeight(),u=$("#view2-datagrid-body-btable-"+t.id).outerHeight(),a=$("#view2-datagrid-footer-"+t.id).outerHeight(),f=t.minAutoHeight,l=t.maxAutoHeight;u=Math.max(u,f),l>0&&(u>l&&$("#view2-datagrid-body-"+t.id).css("overflow-y","auto"),u=Math.min(u,l));var c=0;if(!t.forceFit){var h=$("#datagrid-view2-header-inner-wraper-"+t.id);h.get(0).scrollWidth>h.outerWidth()&&(c=i.height)}var p=o+u+a+s+c;e.onSizeChange(t.width,p+(n.outerHeight()-n.height())),e.onViewSizeChange(),e.fireEvent("onAutoHeight",[t])},unAutoHeight:function(){var e=this,t=e.configs;t.autoHeight=!1,$("#view2-datagrid-body-"+t.id).css("overflow-y","auto")},resetGridSize:function(e,t,n){var r=this,i=r.configs,n=r._undef(n,!1),e=r._undef(e,i.width),t=r._undef(t,i.height),s=r.onSizeChange(e,t,n);if(s===!1)return s;r.methodInvoke("resetViewSize",function(){r.fireEvent("onSizeChange",[i])})},setGridSize:function(e,t,n){this.resetGridSize(e,t,n)},onSizeChange:function(e,t,n){var r=this,i=r.configs,n=r._undef(n,!1);if(!n){var s=r._undef(e,i.width),o=r._undef(t,i.height);if(s==i.width&&o==i.height)return!1}i.width=r._undef(e,i.width),i.height=r._undef(t,i.height);var u=$("#"+i.id),a=r.resizeContainer(i.width,i.height),f=i.views,l=f.grid,o=0;for(var c in f){if(c=="grid")continue;o+=f[c].outerHeight(!0)}l._outerWidth(a.width),l._outerHeight(a.height-o),r.fireEvent("onSetGridSize",[i])},resetViewSize:function(e){var t=this,n=t.configs;n.__svt&&clearTimeout(n.__svt),n.__svt=setTimeout(function(){t.onViewSizeChange(),t.fireEvent("onViewSizeChange",[n]),n.__svt=0,e&&$.isFunction(e)&&e()},0)},setViewSize:function(){var e=this;e.methodInvoke("resetViewSize")},onViewSizeChange:function(e){var t=this,n=t.configs,r=n.gid,e=t._undef(e,!0),i=$(r),s=i.width(),o=i.height();if(n.renderTo.is(":hidden")){var u=$("<div></div>").appendTo(document.body);u.css({position:"absolute",top:-9999}),u.append($("#"+n.id))}var a=$("#view1_"+n.id),f=$("#view2_"+n.id),l=$("#view1-datagrid-header-inner-htable-"+n.id)._outerWidth();a.width(l);var c=s-a._outerWidth();f._outerWidth(c);var h=$("#view2-datagrid-header-inner-htable-"+n.id).height();$("#view1-datagrid-header-inner-htable-"+n.id).height(h),n.showHeader||(h=0),$("#view1-datagrid-header-inner-"+n.id)._outerHeight(h),$("#view2-datagrid-header-inner-"+n.id)._outerHeight(h);var p=$("#datagrid-view2-header-outer-wraper-"+n.id).height();$("#view1-datagrid-header-outer-"+n.id).height(p),$("#view2-datagrid-header-outer-"+n.id).height(p);var d=$("#view2-datagrid-header-inner-"+n.id)._outerHeight()+$("#view2-datagrid-header-outer-"+n.id)._outerHeight();$("#view1-datagrid-header-"+n.id).height(d),$("#view2-datagrid-header-"+n.id).height(d);if(!n.showFooter)n.gfooter.height(0),$("#view1-datagrid-footer-"+n.id).height(0);else{var v=0,m=$("#view2-datagrid-footer-inner-"+n.id).children();m.each(function(){v+=$(this)._outerHeight()}),n.gfooter.height(v),$("#view1-datagrid-footer-"+n.id).height(v)}var g=f.height()-n.gheader._outerHeight()-n.gfooter._outerHeight();n.gbody._outerHeight(g),$("#view1-datagrid-body-wrap-"+n.id)._outerHeight(g),n.showFooter,e&&t.onScroll(!0),n.renderTo.is(":hidden")&&(n.renderTo.append($("#"+n.id)),u.remove()),t.fireEvent("onSetGridViewSize",[n])},array_sort:function(e,t,n,r){if(t==n)return e;var i=e;e=[];var s=0,o=i.length;for(;s<o;s++){var u=e.push(s);s==t?t=u-1:s==n&&(n=u-1)}var a=e[t];if(t>n){r||n++;for(var f=t;f>=0;f--){if(f==n){e[f]=a;break}e[f]=e[f-1]}}else if(t<n){r&&n--;for(var f=t;f<=n;f++)f==n?e[f]=a:e[f]=e[f+1]}var l=[],c=0,o=e.length;for(;c<o;c++)l.push(i[e[c]]);return e=l,e},moveColumn:function(e,t,n){var r=this,i=r.configs;return r.onColumnMove(e,t,n),r},onColumnMove:function(e,t,n){var r=this,i=r.configs,s=i.columns,o=0,u=0,a=n||i.moveToFieldPos;i.moveField=e||i.moveField,i.moveToField=t||i.moveToField;if(i.moveField==i.moveToField)return;var f=r.fireEvent("onBeforeSwitchColumn",[i.moveField,i.moveToField,i.moveToFieldPos,i]);if(f===!1)return f;var l=0,c=s.length;for(;l<c;l++)s[l]["field"]==i.moveField&&(o=l),s[l]["field"]==i.moveToField&&(u=l);s=i.columns=r.array_sort(s,o,u,a);if(a){var o=$("#view2-datagrid-header-inner-htable-tbody-"+i.id).find("td[field='"+i.moveField+"']"),u=$("#view2-datagrid-header-inner-htable-tbody-"+i.id).find("td[field='"+i.moveToField+"']");u.before(o);if(i.lazyLoadRow){var h=0,c=i.lazyRows.length;for(;h<c;h++){var p=i.lazyRows[h];o=$("#"+i.id+"-row-"+p).find("td[field='"+i.moveField+"']"),u=$("#"+i.id+"-row-"+p).find("td[field='"+i.moveToField+"']"),u.before(o)}}else{var h=0,c=i.data.length;for(;h<c;h++)o=$("#"+i.id+"-row-"+h).find("td[field='"+i.moveField+"']"),u=$("#"+i.id+"-row-"+h).find("td[field='"+i.moveToField+"']"),u.before(o)}}else{var o=$("#view2-datagrid-header-inner-htable-tbody-"+i.id).find("td[field='"+i.moveField+"']"),u=$("#view2-datagrid-header-inner-htable-tbody-"+i.id).find("td[field='"+i.moveToField+"']");u.after(o);if(i.lazyLoadRow){var h=0,c=i.lazyRows.length;for(;h<c;h++){var p=i.lazyRows[h];o=$("#"+i.id+"-row-"+p).find("td[field='"+i.moveField+"']"),u=$("#"+i.id+"-row-"+p).find("td[field='"+i.moveToField+"']"),u.after(o)}}else{var h=0,c=i.data.length;for(;h<c;h++)o=$("#"+i.id+"-row-"+h).find("td[field='"+i.moveField+"']"),u=$("#"+i.id+"-row-"+h).find("td[field='"+i.moveToField+"']"),u.after(o)}}r.fireEvent("onColumnMove",[i.moveField,i.moveToField,a,i])},setView:function(){var e=this,t=e.configs,n=e.tpl(e.getTpl("view1"),t),r=e.tpl(e.getTpl("view2"),t),i=t.gid;$(i).html(""),$(n).appendTo(i),$(r).appendTo(i),t.gheader=$("#view2-datagrid-header-"+t.id),t.gbody=$("#view2-datagrid-body-"+t.id),t.gfooter=$("#view2-datagrid-footer-"+t.id),t.gbody.scroll(function(){e.onScroll(),e.fireEvent("onScroll",[]),e.fireEvent("onScrollBar",[])})},getRowData:function(e,t){var n=this,r=n.configs,t=n._undef(t,!1),i=t?n.getData():r.data;if(!t){var s=$("#"+r.id+"-row-"+e);return s.size()?s.data("rowData"):i[e]}var o=r.pk,u=0,a=i.length;for(;u<a;u++)if(i[u][o]==e)return i[u];return!1},getRowId:function(e){var t=this,n=t.configs;if(typeof e=="undefined")return!1;var r=[];if($.isArray(e))for(var i=0;i<e.length;i++)$.isPlainObject(e[i])&&n.pk in e[i]?r.push(e[i][n.pk]):r.push(e[i]);else $.isPlainObject(e)&&n.pk in e?r.push(e[n.pk]):r.push(e);var s=[];return $("#view2-datagrid-header-outer-locktable-tbody-"+n.id+",#view2-datagrid-body-btable-tbody-"+n.id).find(">tr.datagrid-row").each(function(e){var i=$(this).data("rowData"),o=$(this).attr("datagrid-rid");i&&n.pk in i&&t.inArray(i[n.pk],r)!=-1&&s.push(o)}),s.length==1?s[0]:s},setRowData:function(e,t,n){var r=this,i=r.configs,s=$("#"+i.id+"-row-"+e),o;s.size()?o=s.data("rowData"):o=i.data[e];if(!o)return!1;o[t]=n;var u=!1;return typeof o[i.pk]!="undefined"&&(u=r.getRowData(o[i.pk],!0),u&&(u[t]=n)),!0},getRealField:function(e){var t=this,n=t.configs;if(typeof e=="undefined")return null;var r=e,e=t.getColumnData(e,"index");return e=e==""?r:e,e},getFieldValue:function(e,t,n){var r=this,i=r.configs,n=r._undef(n,!0);t=r.getRealField(t);var s=this.getRowData(e);return typeof s=="undefined"?"":typeof s[t]=="undefined"?"":n?s[t]:r._cellReader(s[t],r.getColumnData(t,"reader"),s)},setFieldValue:function(e,t,n){var r=this,i=r.configs,s=i.gid,o=r.getRealField(t),u=r.getRowData(e);if(!u)return!1;u[o]=typeof u[o]=="undefined"?"":u[o];if(u[o]==n)return!1;var a=r.fireEvent("onBeforeCellEdit",[e,t,n,u,i]);if(a===!1)return!1;r.setRowData(e,o,n);var f=$("#"+i.id+"_"+t+"_row_"+e+"_cell");if(!f.size())var l="#"+i.id+"-row-"+e+",#"+i.id+"-view1-row-"+e,f=$(l).find("td[field='"+t+"'] div.datagrid-cell");if(f.size()){var c=r.getColumnData(t,"_expand");c=c===null?!1:c;var n=c!==!1?r.tpl(c,u):r._cellReader(n,r.getColumnData(t,"reader"),u);f.html(n).addClass("datagrid-cell-edit");var h=r.getColumnData(t,"callBack");h!=null&&$.isFunction(h)&&h!=i.noop&&h.call(r,f,e,t,u)}return r.fireEvent("onCellEdit",[f,e,t,u[o],u,i]),u},getSlectRows:function(e){var t=this,n=t.configs,r=n.gid,i=n.selectRows,e=t._undef(e,!1),s=[];if(e){var o=0,u=i.length;for(;o<u;o++){if(!n.data[i[o]])continue;s.push(n.data[i[o]])}return s}return i},getSelectRows:function(e){var t=this;return t.getSlectRows(e)},_getRowNumber:function(e){var t=this,n=t.configs,r=n.data,i=n.gid,s=$("#"+n.id+"-view1-row-"+e),o=!1,u={};if(!s.size()){o=!0;var a=t.getTpl("view1_row");u={i:e,id:n.id,rowNumbersExpand:n.rowNumbersExpand,data:r[e],rowNumbersWidth:n.rowNumbersWidth,opt:n};var f=$(t.tpl(a,u));t.bindRowEvent(!1,f),s=f}return{isNew:o,node:s}},getCheckBoxColumn:function(e){var t=this,n=t.configs,r=$.extend({},n._columnMetaData);return r.field="ck",r.title=n.checkBoxTitle,r._expand='<input type="checkbox">',r.hcls="datagrid-header-check",r.bcls="datagrid-cell-check",r.width=n.checkBoxWidth,r.forceFit=n.checkBoxForceFit,r.fitColumn=n.checkBoxFit,r.align="center",r.callBack=function(e,t,n,r){var i=this;$(e).find("input:checkbox").click(function(e){this.checked?i.selectRow(t):i.unselectRow(t),e.stopPropagation()})},r},geteditColumn:function(e){var t=this,n=t.configs,r=$.extend({},n._columnMetaData),i=0,s=0;$.isArray(n.editColumn)?$.each(n.editColumn,function(e,t){$.isPlainObject(this)?(n.editColumn[e]=$.extend({},n._toolItem,n.editColumn[e]),i++):s++}):n.editColumn=[];var o="";return r.field="ed",r.title=n.editColumnTitle==""||n.editColumnTitle===!1?" ":n.editColumnTitle,r._expand=o,r.forceFit=n.editColumnForceFit,r.hcls="datagrid-header-edit",r.bcls="datagrid-cell-edit",r.width=i*n.editCellW+s*4+"px",r.fitColumn=n.editColumnFit,r.align="center",r.callBack=function(e,t,r,i){var s=this,o=n._toolItem,u=[],a={},f=0,l=n.editColumn.length;for(;f<l;f++)$.isPlainObject(n.editColumn[f])?(a=$.extend(!0,{},o,n.editColumn[f]),a.callBack=function(e,o){var u=$(e).attr("indexid");n.editColumn[u].callBack.call(s,e,t,r,i,o)},u.push(a)):u.push(n.editColumn[f]);var c=s.getTools(u);e.append(c)},r},onInitFieldWidth:function(){var e=this,t=e.configs;return e._initFieldWidth(),e},onFinishFieldWidth:function(){var e=this,t=e.configs,n=t.columns;return $.each(n,function(t,n){n.width.toString().indexOf("%")!=-1&&e.setFieldWidth(n.field,n.width)}),e},_initFieldWidth:function(){var e=this,t=e.configs,n=e.getColumns(),r=0,i=$("#"+t.id).width(),s=$("#view1-datagrid-header-inner-htable-"+t.id).outerWidth();r=i-parseFloat(s),$("#"+t.id+"_css").remove();var o=[];o.push('<style type="text/css" id="'+t.id+'_css">');for(var u=0;u<n.length;u++){var a=n[u].width,f=n[u].field;a.toString().indexOf("%")!=-1?a=parseFloat(a)*r/100:a=parseFloat(a);var l=n[u].maxWidth;l!==null&&(l=parseFloat(l),a=Math.min(l,a));var c=n[u].minWidth;a=a>=c?a:c,a-=t.padding,a=Math.floor(a);var h="#"+t.id+" .datagrid-cell-"+n[u].field+"{width:"+a+"px;}";o.push(h)}return o.push("</style>"),o=o.join("\n"),$("#"+t.id).before(o),e},_setFieldWidth:function(e,t,n){var r=this,i=r.configs,n=r._undef(n,!1),t=r._undef(t,120);if(t.toString().indexOf("%")!=-1){var s=0,o=r.getScrollbarSize(),u=$("#view2-datagrid-body-"+i.id);s=u.outerWidth();var a=u.get(0).scrollHeight;a>u.outerHeight()&&(s-=o.width),t=parseFloat(t)*s/100}else t=parseFloat(t);var f=r.getColumnData(e,"maxWidth");f!==null&&(f=parseFloat(f),t=Math.min(f,t));var l=parseFloat(r.getColumnData(e,"minWidth"));t=t>=l?t:l;var c=t;n||(t-=i.padding),t=Math.floor(t);var h="#"+i.id+" .datagrid-cell-"+e,p=$("#"+i.id+"_css").get(0);if(!p)return!1;var d=p.
styleSheet?p.styleSheet:p.sheet||document.styleSheets[document.styleSheets.length-1],v=d.cssRules||d.rules,m=!1;for(var g=0;g<v.length;g++)if(v[g].selectorText.toLowerCase()==h.toLowerCase()){v[g].style.width=t+"px",m=!0;break}if(!m){var y=d.addRule||d.insertRule;d.addRule?d.addRule(h,"width:"+t+"px"):d.insertRule(h+"{width:"+t+"px}",v.length)}return c},setFieldWidth:function(e,t,n){var r=this,i=r.configs,s=r.getColumnData(e);if(s===null)return t;var o=r._setFieldWidth(e,t,n),u=s.width;return t.toString().indexOf("%")!=-1?r.setColumnValue(e,"width",t):u.toString().indexOf("%")!=-1?s.casePerChange&&r.setColumnValue(e,"width",o):r.setColumnValue(e,"width",o),r.fireEvent("onFieldWidthChange",[e,o,t,u,i]),r.lockEvent("onScroll"),r.methodInvoke("resetViewSize"),r.unLockEvent("onScroll"),r.setGridHeaderTextLimit(),r.setGridBodyTextLimit(e),o},setForceFitColumn:function(e,t){var n=this,r=n.configs,i=n.getColumnData(e);r.forceFit&&i.forceFit&&n.onFitColumn(e,t)},onFitColumn:function(e,t){var n=this,r=n.configs;r.forceFit&&(n.forceFitColumn(e,t),n.fireEvent("onAutoColumnResize",[r]))},forceFitColumn:function(e,t){var n=this,r=n.configs,i=r.columns,e=typeof e=="undefined"?[]:e;e=$.isArray(e)?e:[e];var s=n.getScrollbarSize();$("#view2-datagrid-body-"+r.id).css("overflow-x","hidden");var o=$("#view2-datagrid-header-"+r.id),u=o.outerWidth(),a=$("#view2-datagrid-body-"+r.id),f=a.get(0).scrollHeight,l=a.get(0).scrollWidth;f>a.outerHeight()?u-=s.width:u-=0;var c={},h={},p=0,d=0;$("#view2-datagrid-header-inner-htable-tbody-"+r.id).find(">tr.datagrid-header-row td[field]").each(function(){var t=$(this).outerWidth(),s=$(this).attr("field");d||(d=$(this).outerWidth()-$(this).width());for(var o=0;o<i.length;o++)if(i[o]["field"]==s&&n.inArray(s,r.hideColumns)==-1){i[o].forceFit&&n.inArray(s,e)==-1?(c[s]=t,h[s]=i[o].minWidth,p+=t):u-=t;break}});var v=0;for(var m in c)c[m]=u*Math.floor(c[m]*1e4/p)/1e4-d,c[m]<h[m]&&(v+=h[m]-c[m]),n._setFieldWidth(m,c[m]);return v&&e.length==1&&n._setFieldWidth(e[0].field,t-v),n.fireEvent("onForceFitColumn",[r]),n},unForceFitColumn:function(){var e=this,t=e.configs;t.forceFit=!1,$("#view2-datagrid-body-"+t.id).css("overflow-x","auto")},getColumns:function(e){var t=this,n=t.configs,r=n.columns,e=t._undef(e,!1);n.cacheData.columns=t._undef(n.cacheData.columns,r);if(e)return n.cacheData.columns;if(r.length<=0&&n.data.length>0&&$.isPlainObject(n.data[0]))for(var i in n.data[0])r.push({field:i});var s=[],o=!1,u=!1,i=0,a=r.length;for(;i<a;i++){r[i]=$.extend({},n._columnMetaData,r[i]);if(r[i].disabled===!0)continue;r[i].title=r[i]["title"]==""?r[i].field:r[i].title,r[i].index=r[i]["index"]==""?r[i].field:r[i].index,n.checkBox!==!1&&r[i]["field"]=="ck"&&o===!1&&(r[i]=t.getCheckBoxColumn(r),o=!0),n.editColumn!==!1&&r[i]["field"]=="ed"&&u===!1&&(r[i]=t.geteditColumn(r),u=!0),s.push(r[i])}n.columns=r=s;var f=[],l=[];return n.checkBox!==!1&&o===!1&&t.getCheckBoxColumn(r)!==!1&&(f=[t.getCheckBoxColumn(r)],$.merge(f,r),r=f),n.editColumn!==!1&&u===!1&&t.geteditColumn(r)!==!1&&(l=[t.geteditColumn(r)],$.merge(r,l)),n.columns=r,n.columns},getColumnList:function(){var e=this,t=e.configs,n=t.gid,r=t.columns,i=[],s=0,o=r.length;for(;s<o;s++)i.push(r[s].field);return i},onDisplayField:function(){var e=this,t=e.configs,n=t.hideColumns,r=t.gid;if(n.length<=0)return;var i=0,s=n.length;for(;i<s;i++){if(n[i]==null)continue;e.hideColumn(n[i])}},displayColumn:function(e,t){var n=this,r=n.configs,i=r.hideColumns,s=r.gid,o=n.getColumnList();if(n.inArray(e,o)==-1)return!1;var u=t=="show"?!0:!1;if(u){var a=0,f=i.length;for(;a<f;a++)i[a]==e&&(i[a]=null)}else n.inArray(e,i)==-1&&i.push(e);$(s).find("td[field='"+e+"']")[t]();var l=u?"onShowColumn":"onHideColumn";return n.fireEvent(l,[e,r]),n.methodInvoke("resetViewSize"),!0},showColumn:function(e){var t=this,n=t.fireEvent("onBeforeShowColumn",[e,opt]);return n===!1?n:t.displayColumn(e,"show")},hideColumn:function(e){var t=this,n=t.fireEvent("onBeforeHideColumn",[e,opt]);return n===!1?n:t.displayColumn(e,"hide")},sortColumn:function(e){},showHeader:function(){var e=this,t=e.configs;t.showHeader=!0,e.methodInvoke("resetViewSize")},hideHeader:function(){var e=this,t=e.configs;t.showHeader=!1,e.methodInvoke("resetViewSize")},setGridHeaderEvent:function(e,t){var n=this,r=n.configs,i=r.gid,s=r.columns;if(r.fitColumns){var o=$.extend({},r);o.self=n,o.stop=function(e,t){var i=n.fireEvent("onResizeColumnStop",[t,r]);if(i===!1)return i;n.cStop(t)}}var u=e.find("td[field]").each(function(){var e=$(this).attr("field");if(r.fitColumns){var t=n.getColumnData(e,"fitColumn");t&&$("div.datagrid-cell",this)._resize(o)}});r.moveColumns&&u.moveColumn(r),u.bind("click",function(e){var t=$(this).attr("field");r.autoScrollToField&&n.scrollToField(t);var i=n.fireEvent("onColumnClick",[t,this,e]);if(i===!1)return i}),u.bind({mouseenter:function(e){var t=$(this).attr("field");$(this).addClass("datagrid-header-over");var r=n.fireEvent("onColumnOver",[t,this,e]);if(r===!1)return r},mouseleave:function(e){var t=$(this).attr("field");$(this).removeClass("datagrid-header-over");var r=n.fireEvent("onColumnOut",[t,this,e]);if(r===!1)return r},dblclick:function(e){var t=$(this).attr("field"),r=n.fireEvent("onColumnDblClick",[t,this,e]);if(r===!1)return r},contextmenu:function(e){var t=$(this).attr("field"),r=n.fireEvent("onColumnContextMenu",[t,this,e]);if(r===!1)return r}}),e.bind("contextmenu",function(e){var t=n.fireEvent("onHeaderContextMenu",[this,e]);if(t==0)return!1}),n.setGridHeaderTextLimit();if(r.checkBox){var a=e.find("td[field='ck']");a.find("input:checkbox").click(function(){if(r.singleSelect)return this.checked=!1,!1;this.checked?n.selectAllRows():n.unselectAllRows()})}n.fireEvent("onSetGridHeaderEvent",[e,u,r])},setGridHeaderTextLimit:function(){},updateHeaderRow:function(e){var t=this,n=t.configs,e=t._undef(e,!1);t.setGridHeader(),e&&t.onInitFieldWidth(),t.fireEvent("onUpdateHeaderRow",[n])},setGridHeader:function(){var e=this,t=e.configs,n=t.gid,r=e.getColumns(),i=e.getTpl("view1_header_inner_row"),s=t.headerTpl?t.headerTpl:e.getTpl("view2_header_inner_row"),o=$("#datagrid-view2-header-inner-wraper-"+t.id),u=$("#datagrid-view1-header-inner-wraper-"+t.id),a=$("#datagrid-view2-header-outer-wraper-"+t.id),f=$("#datagrid-view1-header-outer-wraper-"+t.id),l=['<table class="datagrid-htable" id="view1-datagrid-header-inner-htable-'+t.id+'" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-inner-htable-tbody-'+t.id+'">'],c=['<table class="datagrid-htable" id="view2-datagrid-header-inner-htable-'+t.id+'" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-inner-htable-tbody-'+t.id+'">'],h=['<table class="datagrid-locktable" id="view1-datagrid-header-outer-locktable-'+t.id+'" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-outer-locktable-tbody-'+t.id+'"></tbody></table>'],p=['<table class="datagrid-locktable" id="view2-datagrid-header-outer-locktable-'+t.id+'" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-outer-locktable-tbody-'+t.id+'"></tbody></table>'],d=e.tpl(i,t),v=e.tpl(s,{fields:r,opt:t});return l.push(d),c.push(v),l.push("</tbody></table>"),c.push("</tbody></table>"),u.html(l.join("")),o.html(c.join("")),f.html(h.join("")),a.html(p.join("")),e.fireEvent("onHeaderCreate",[v,d,t]),d=$("> tr.datagrid-header-row","#view1-datagrid-header-inner-htable-tbody-"+t.id),v=$("> tr.datagrid-header-row","#view2-datagrid-header-inner-htable-tbody-"+t.id),e.setGridHeaderEvent(v,d),e.methodCall("setGridHeader"),!0},onHeaderCreate:function(){var self=this,opt=self.configs,gid=opt.gid;if(!opt.headerTpl)return-1;var fields=opt.columns,headerBody=$("#view2-datagrid-header-inner-htable-tbody-"+opt.id),_columns=[],_thex=$.dataGrid.getToGridOptions();return headerBody.find("td[field],th[field],td["+_thex.options_from+"],th["+_thex.options_from+"]").each(function(i){var field=$(this).attr("field"),_d=$(this).attr(_thex.options_from);_d?_d=eval("({"+_d+"})"):_d={},field||(field=_d.field?_d.field:"field_"+$.dataGrid.aid++);var _d2={};_d2.title=$(this).html(),_d2.title==""&&(_d2={});var _d3={},j=0,len=fields.length;for(;j<len;j++)if(fields[j]["field"]==field){_d3=fields[j];break}$.isEmptyObject(_d3)&&(_d3.field=field);var _d4=$.extend(!0,{},_d3,_d,_d2);_d4.align=_d4.align?_d4.align:$(this).attr("align")?$(this).attr("align"):opt._columnMetaData.align,_d4.hcls=_d4.hcls?_d4.hcls:opt._columnMetaData.hcls,_d4.title=_d4.title==""?_d4.field:_d4.title,_d4.width=_d4.width?_d4.width:$(this).width();var $this=this;$(this).is("th")?($this=$('<td field="'+_d4.field+'" align="'+_d4.align+'"></td>'),$(this).replaceWith($this)):($(this).attr("field",_d4.field),$(this).attr("align",_d4.align)),$($this).html('<div class="datagrid-header-wrap" field="'+_d4.field+'"><div class="datagrid-cell datagrid-cell-'+_d4.field+" datagrid-cell-header-"+_d4.field+" "+_d4.hcls+'" ><span>'+_d4.title+"</span></div></div>"),_columns.push(_d4)}),opt.columns=_columns,headerBody.find(">tr").addClass("datagrid-header-row"),self.getColumns(),opt._headerTpl=self._undef(opt._headerTpl,""),opt._headerTpl!=opt.headerTpl&&self.onInitFieldWidth(),headerBody.find(">tr")},setColumnValue:function(e,t,n){var r=this,i=r.getColumns(),s=0,o=i.length;for(;s<o;s++)if(i[s]["field"]==e){i[s][t]=n;continue}},cStop:function(e){var t=this,n=t.configs,r=n.gid,i=$(r).find("td[field='"+e.field+"']:first").find("div.datagrid-cell");if(!i.size())return;var s=parseFloat(i.width());s+=e.offsetX,s+=n.padding;var s=t.setFieldWidth(e.field,s);t.fireEvent("onAfterResize",[e.field,s,e])},isRowHidden:function(e){var t=this,n=t.configs,r=n.gid;return e===undefined?!0:$("#"+n.id+"-row-"+e).size()&&!$("#"+n.id+"-row-"+e).is(":hidden")?!1:!0},selectAllRows:function(){var e=this,t=e.configs,n=t.gid;if(t.singleSelect)return e;var r=e.fireEvent("onSelectAll",[t]);if(r===!1)return e;if(t.lazyLoadRow){t.selectRows=[];var i=0,s=t.data.length;for(;i<s;i++)t.selectRows.push(i)}return $(">tr.datagrid-row",$("#view2-datagrid-header-outer-locktable-tbody-"+t.id)).each(function(t){e.selectRow($(this).attr("datagrid-rid"))}),$(">tr.datagrid-row",$("#view2-datagrid-body-btable-tbody-"+t.id)).each(function(t){e.selectRow($(this).attr("datagrid-rid"))}),e},unselectAllRows:function(){var e=this,t=e.configs,n=t.gid,r=t.events,i=e.fireEvent("onUnselectAll",[t]);return i===!1?e:($(">tr.datagrid-row",$("#view2-datagrid-header-outer-locktable-tbody-"+t.id)).each(function(t){e.unselectRow($(this).attr("datagrid-rid"))}),$(">tr.datagrid-row",$("#view2-datagrid-body-btable-tbody-"+t.id)).each(function(t){e.unselectRow($(this).attr("datagrid-rid"))}),t.selectRows=[],e)},selectRow:function(e){var t=this,n=t.configs,r=n.gid,i=n.events,s=r,e=typeof e=="undefined"?!1:e;if(e===!1)return t;var o=t.getRowData(e),u=$("#"+n.id+"-row-"+e),a=$("#"+n.id+"-view1-row-"+e),f=$(u).add(a);if(!f.size()){var l=t.fireEvent("onSelect",[f,e,o,n]);if(l===!1)return l}else{if(u.hasClass(n.clsSelectRow))return t;var l=t.fireEvent("onSelect",[f,e,o,n]);if(l===!1)return l}t.inArray(e,n.selectRows)==-1&&n.selectRows.push(e),f.size()&&(u.addClass(n.clsSelectRow),a.addClass(n.clsSelectRow));if(n.checkBox&&f.size()){var c=f.find("td[field='ck'] .datagrid-cell-check input:checkbox");c.length&&(c.get(0).checked=!0)}if(n.singleSelect){var h=n.selectRows,p=[];for(var d=0;d<h.length;d++){if(h[d]==e)continue;p.push(h[d])}for(var d=0;d<p.length;d++)t.unselectRow(p[d]);n.selectRows=[e]}return t},unselectRow:function(e){var t=this,n=t.configs,r=n.gid,e=typeof e=="undefined"?!1:e;if(e===!1)return t;var i=t.getRowData(e),s=$("#"+n.id+"-row-"+e),o=$("#"+n.id+"-view1-row-"+e),u=$(s).add(o);if(!u.size()){var a=t.fireEvent("onUnselect",[u,e,i,n]);if(a===!1)return a}else{if(!s.hasClass(n.clsSelectRow))return t;var a=t.fireEvent("onUnselect",[u,e,i,n]);if(a===!1)return a}var f=t.inArray(e,n.selectRows);f!=-1&&n.selectRows.splice(f,1),u.size()&&(s.removeClass(n.clsSelectRow),o.removeClass(n.clsSelectRow));if(n.checkBox&&u.size()){var l=u.find("td[field='ck'] .datagrid-cell-check input:checkbox");l.length&&(l.get(0).checked=!1)}return t},onOverRow:function(e){var t=this,n=t.configs,r=n.gid;n.clsOverRow&&($("#"+n.id+"-view1-row-"+e).addClass(n.clsOverRow),$("#"+n.id+"-row-"+e).addClass(n.clsOverRow))},onOutRow:function(e){var t=this,n=t.configs,r=n.gid;n.clsOverRow&&($("#"+n.id+"-view1-row-"+e).removeClass(n.clsOverRow),$("#"+n.id+"-row-"+e).removeClass(n.clsOverRow))},setGridBodyTextLimit:function(e,t){},bindRowEvent:function(e,t){var n=this,r=n.configs,i=r.data,s=r.gid;typeof e=="undefined"&&(e=!1),typeof t=="undefined"&&(t=!1);var o=r.columns,u={click:function(e){var t=$(this).attr("datagrid-rid"),i=n.getRowData(t);r.autoScrollToRow&&n.scrollToRow(t);var s=n.cellEvents(t,e);if(s===!1)return!1;var o=n.fireEvent("onClickRow",[this,t,i,e]);if(o===!1)return!1;var u=$(this).hasClass(r.clsSelectRow),a=n.getSlectRows();u?r.singleSelect?a.length==1&&a[0]!=t&&n.unselectRow(t):n.unselectRow(t):n.selectRow(t)},mouseover:function(e){var t=$(this).attr("datagrid-rid"),r=n.cellEvents(t,e);if(r===!1)return!1;n.fireEvent("onOverRow",[t,e])},mouseout:function(e){var t=$(this).attr("datagrid-rid"),r=n.cellEvents(t,e);if(r===!1)return!1;n.fireEvent("onOutRow",[t,e])},dblclick:function(e){var t=$(this).attr("datagrid-rid"),r=n.getRowData(t),i=n.cellEvents(t,e);if(i===!1)return!1;var s=n.fireEvent("onDblClickRow",[this,t,r,e]);if(s==0)return!1},contextmenu:function(e){var t=$(this).attr("datagrid-rid"),r=n.getRowData(t),i=n.cellEvents(t,e);if(i===!1)return!1;var s=n.fireEvent("onRowContextMenu",[this,t,r,e]);if(s==0)return!1}};e&&(e.bind(u),e.each(function(){var e=$(this),t=$(this).attr("datagrid-rid"),i=n.getRowData(t);$.isFunction(r.rowCallBack)&&r.rowCallBack!=$.noop&&r.rowCallBack.call(n,e,t,i);if(r.rowStyler)if($.isFunction(r.rowStyler)){var s=r.rowStyler.call(n,e,t,i);typeof s=="string"&&e.addClass(s)}else typeof r.rowStyler=="string"&&e.addClass(r.rowStyler);var u=[],a=0,f=o.length;for(;a<f;a++){u=o[a];if(!$.isFunction(u.callBack)||u["callBack"]==r.noop)continue;var l=$("#"+r.id+"_"+u.field+"_row_"+t+"_cell");u.callBack.call(n,l,t,u,i)}n.setGridBodyTextLimit(e,i)}));if(t){var a={click:function(e){var t=$(this).attr("datagrid-rid"),i=t,s=e.srcElement?e.srcElement:e.target,o=n.cellEvents(t,e);if(o===!1)return!1;n.fireEvent("onClickRowNumber",[i,e]),r.rowNumbers2Row!==!1&&$("#"+r.id+"-row-"+i).trigger("click")},mouseover:function(e){var t=$(this).attr("datagrid-rid"),r=n.cellEvents(t,e);if(r===!1)return!1;n.fireEvent("onOverRow",[t,e])},mouseout:function(e){var t=$(this).attr("datagrid-rid"),r=n.cellEvents(t,e);if(r===!1)return!1;n.fireEvent("onOutRow",[t,e])},dblclick:function(e){var t=$(this).attr("datagrid-rid"),i=t,s=n.cellEvents(t,e);if(s===!1)return!1;r.rowNumbers2Row!==!1&&$("#"+r.id+"-row-"+i).trigger("dblclick")},contextmenu:function(e){}};t.bind(a)}n.fireEvent("onSetRowEvent",[e,t,r])},isCell:function(e){if(!$(e).length)return!1;if($(e).is("td")&&$(e).hasClass("datagrid-td-rownumber"))return!1;if($(e).is("tr")&&$(e).hasClass("datagrid-row"))return!1;if(!$(e).hasClass("datagrid-cell")){var t=$(e).closest("tr.datagrid-row div.datagrid-cell");if(!t.length)return!1}return!0},cellEvents:function(e,t){var n=this,r=n.configs,i=t.srcElement?t.srcElement:t.target;if(!n.isCell(i))return!0;var s=$(i),o=s.parent("td").attr("field"),u=n.getFieldValue(e,o),a=!0;switch(t.type){case"click":r.autoScrollToField&&n.scrollToField(o),a=n.fireEvent("onClickCell",[s.eq(0),e,o,u,t]);break;case"dblclick":a=n.fireEvent("onDblClickCell",[s.eq(0),e,o,u,t]);break;case"mouseover":a=n.fireEvent("onOverCell",[s.eq(0),e,o,u,t]);break;case"mouseout":a=n.fireEvent("onOutCell",[s.eq(0),e,o,u,t]);break;case"contextmenu":a=n.fireEvent("onCellContextMenu",[s.eq(0),e,o,u,t])}return a},_insert:function(e,t,n){var r=this,i=r.configs,s=i.data,o=i.gid,u=i.columns,e=r._undef(e,0),a=!1,f=$("#"+i.id+"-row-"+e);f.size()&&(a=!0);var l=e,n=r._undef(n,!0),t=r._undef(t,{}),c=r.getTpl("view1_row"),h=i.rowTpl?i.rowTpl:r.getTpl("view2_row"),p=$("#view2-datagrid-body-btable-tbody-"+i.id),d=$("#view1-datagrid-body-btable-tbody-"+i.id),v=$("#view2-datagrid-body-btable-tbody-header-"+i.id),m=$("#view1-datagrid-body-btable-tbody-header-"+i.id),g=$("#view2-datagrid-body-btable-tbody-footer-"+i.id),y=$("#view1-datagrid-body-btable-tbody-footer-"+i.id);if(!a){var b={i:l,id:i.id,fields:u,rowNumbersExpand:i.rowNumbersExpand,data:t,isCreate:i.isCreate,rowNumbersWidth:i.rowNumbersWidth,opt:i},w=$(r.tpl(h,b)),E=!1;E=$(r.tpl(c,b))}else{var w=f,E=!1;E=$("#"+i.id+"-view1-row-"+e)}if(n)g.before(w),E!==!1&&y.before(E);else{var S=$(">tr.datagrid-row","#view2-datagrid-body-btable-tbody-"+i.id),x=[];S.each(function(e,t){x.push(Number($(t).attr("datagrid-rid")))}),x.push(e),x.sort(function(e,t){return e>=t?1:-1});var T=r.inArray(e,x);if(!T)v.after(w),E!==!1&&m.after(E);else{var N=x[T-1];$("#"+i.id+"-row-"+N).after(w),E!==!1&&$("#"+i.id+"-view1-row-"+N).after(E)}}return i.rowTpl&&r.parseRowTpl(w,e,t),w.data("rowData",t),r.fireEvent("onAfterAddRow",[e,t,i]),r.methodInvoke("resetViewSize"),{tr:w,ltr:E,isNew:!a}},addRow:function(e,t){var n=this,r=n.configs,i=r.data,s=r.gid,o=r.columns,u=i.length,a=u,t=n._undef(t,!0),e=n._undef(e,{});if(n.getAsync()){i.push(e);var f=n.getData();f.push(e)}else i.push(e);r.total++;var l=r.pk;e[l]||(e[l]=n.unique());var c=n.fireEvent("onBeforeAddRow",[e,r]);if(c===!1)return!1;n.fireEvent("onSuccessAddRow",[u,e,r]);if(t&&u>=r.pageSize)return!0;var h=n._insert(u,e);return h.isNew&&(r.denyRowEvents===!1?n.bindRowEvent(h.tr,h.ltr):$.isFunction(r.denyRowEvents)&&r.denyRowEvents.call(n,h.tr,h.ltr)),u},updateRow:function(e,t){var n=this,r=n.configs,i=r.data,s=r.gid,t=n._undef(t,{}),o=n.fireEvent("onBeforeUpdateRow",[e,t,r]);if(o===!1)return!1;var u=n.getColumnList(),a=[];for(var f in t)if(n.inArray(f,u)!=-1){var l=n.setFieldValue(e,f,t[f]);l!==!1&&a.push(f)}return n.fireEvent("onAfterUpdateRow",[e,t,a,r]),!0},deleteRow:function(e,t){var n=this,r=n.configs,i=r.data,s=r.gid,t=n._undef(t,!0),o=n.fireEvent("onBeforeDeleteRow",[e,r]);if(o===!1)return!1;var u=$("#"+r.id+"-row-"+e),a=$("#"+r.id+"-view1-row-"+e),i=u.size()?u.data("rowData"):r.data[e,r];if(!i)return!1;if(!i[r.pk])return!1;if(t){for(var f=0;f<r.data.length;f++)if(r.data[f][r.pk]==i[r.pk]){r.data.splice(f,1);break}if(n.getAsync()){var l=n.getData();for(var f=0;f<l.length;f++)if(l[f][r.pk]==i[r.pk]){l.splice(f,1);break}}r.total--}return u.remove(),a.remove(),n.fireEvent("onAfterDeleteRow",[e,r]),n.methodInvoke("resetViewSize"),!0},parseRowTpl:function(e,t,n){var r=this,i=r.configs,s=i.data,o=i.gid,u=i.columns,a=t,f=t,n=r._undef(n,!1);n||(n=s[a]?s[a]:{}),e.find(">td,>th").each(function(e){var t=i.id+"_"+u[e].field+"_row_"+f+"_td",n=i.id+"_"+u[e].field+"_row_"+f+"_cell",r=this;$(this).is("th")?(r=$("<td id='"+t+"' field='"+u[e].field+"' align='"+u[e].align+"'><div  id='"+n+"'  class='datagrid-cell datagrid-cell-"+u[e].field+" ' >"+$(this).html()+"</div></td>"),$(this).replaceWith(r)):$(this).attr("field",u[e].field).attr("align",u[e].align).attr("id",t).html("<div  id='"+n+"' class='datagrid-cell datagrid-cell-"+u[e].field+" ' >"+$(this).html()+"</div>")});var l=(t+1)%2?i.clsSingleRow:i.clsDoubleRow;e.addClass("datagrid-row "+l).attr("id",i.id+"-row-"+a).attr("datagrid-rid",a),typeof n["_groupid_"]!="undefined"&&e.attr("datagrid-group-id",n._groupid_)},setRow:function(e,t){var n=this,r=n.configs,i=r.data,s=r.gid,o=r.columns,u=n.getTpl("view1_row"),a=r.rowTpl?r.rowTpl:n.getTpl("view2_row"),f={},l=$("#view2-datagrid-body-"+r.id),c=$("#view1-datagrid-body-"+r.id),t=n._undef(t,$.noop),e=n._undef(e,0),h=r._lSize,p=1,d=['<table class="datagrid-btable" id="view1-datagrid-body-btable-'+r.id+'" cellspacing="0" cellpadding="0" border="0"><tbody id="view1-datagrid-body-btable-tbody-'+r.id+'"><tr class="datagrid-row-header" id="view1-datagrid-body-btable-tbody-header-'+r.id+'" style="height:0px;"></tr>'],v=['<table class="datagrid-btable" id="view2-datagrid-body-btable-'+r.id+'" cellspacing="0" cellpadding="0" border="0"><tbody id="view2-datagrid-body-btable-tbody-'+r.id+'"><tr class="datagrid-row-header" id="view2-datagrid-body-btable-tbody-header-'+r.id+'" style="height:0px;"></tr>'],m=[];$.isArray(i)||(i=[]);var g=i.length;for(var y=e;y<g;y++){if(h>0){if(p>h)break;p++,r._lStart=p}m.push(y),f={i:y,id:r.id,fields:o,rowNumbersExpand:r.rowNumbersExpand,data:i[y],isCreate:r.isCreate,rowNumbersWidth:r.rowNumbersWidth,opt:r};var b=n.tpl(a,f);v.push(b);var w=!1;w=n.tpl(u,f),d.push(w)}v.push('<tr class="datagrid-row-footer" id="view2-datagrid-body-btable-tbody-footer-'+r.id+'" style="height:0px;"></tr></tbody></table>'),d.push('<tr class="datagrid-row-footer" id="view1-datagrid-body-btable-tbody-footer-'+r.id+'" style="height:0px;"></tr></tbody></table>'),l.html(v.join("")),c.html(d.join(""));var b=!1,w=!1;r.rowTpl?(b=$(">tr:not(.datagrid-row-header,.datagrid-row-footer)","#view2-datagrid-body-btable-tbody-"+r.id),b.each(function(e){var t=$(this),r=m[e],i=r;n.parseRowTpl(t,r)})):b=$(">tr.datagrid-row","#view2-datagrid-body-btable-tbody-"+r.id),b.each(function(e){var t=$(this).attr("datagrid-rid");$(this).data("rowData",i[t])}),w=$(">tr.datagrid-row","#view1-datagrid-body-btable-tbody-"+r.id),r.denyRowEvents===!1?n.bindRowEvent(b,w):$.isFunction(r.denyRowEvents)&&r.denyRowEvents.call(n,b,w),t(),n.afterGridShow()},_cellReader:function(e,t,n){var r=this,i=r.configs,e=r._undef(e,""),t=r._undef(t,{}),n=r._undef(n,{});return e in t?r.tpl(t[e],n):i.readerDef in t?r.tpl(t[i.readerDef],n):e},view2_row:function(e){if(!e)return"";var t=this,n=t.configs,r=n.data,i=n.gid;typeof e.data[n.pk]=="undefined"&&(e.data[n.pk]=t.unique());var s=[];typeof e.data["_groupid_"]!="undefined"&&(s.push("datagrid-group-id="),s.push(e.data._groupid_)),s=s.join("");var o=(e.i+1)%2?n.clsSingleRow:n.clsDoubleRow,u=[];u.push('<tr id="'),u.push(e.id),u.push("-row-"),u.push(e.i),u.push('" '),u.push(s),u.push(' datagrid-rid="'),u.push(e.i),u.push('" class="datagrid-row '),u.push(o),u.push('">');var a=0,f=e.fields.length;for(;a<f;a++){var l=[];l.push(n.id),l.push("_"),l.push(e.fields[a].field),l.push("_row_"),l.push(e.i),l.push("_td"),l=l.join("");var c=[];c.push(n.id),c.push("_"),c.push(e.fields[a].field),c.push("_row_"),c.push(e.i),c.push("_cell"),c=c.join("");var h=e.fields[a].field,p=e.fields[a].index,d=e.fields[a]._expand!==!1?n.self.tpl(e.fields[a]._expand,e.data):t._cellReader(e.data[p],e.fields[a].reader,e.data);u.push('<td field="'),u.push(h),u.push('" id="'),u.push(l),u.push('" align="'),u.push(e.fields[a].align),u.push('">'),u.push('<div id="'),u.push(c),u.push('" class="datagrid-cell datagrid-cell-'),u.push(h),u.push(" "),u.push(e.fields[a].bcls),u.push('" >'),u.push(d),u.push("</div></td>")}return u.push("</tr>"),u.join("")},view1_row:function(e){if(!e)return"";var t=this,n=t.configs,r=n.data,i=n.gid,s=[];typeof e.data["_groupid_"]!="undefined"&&(s.push("datagrid-group-id="),s.push(e.data._groupid_)),s=s.join("");var o=(e.i+1)%2?"datagrid-row-single":"datagrid-row-double",u=[];u.push(n.id),u.push("_row_"),u.push(e.i),u.push("_td_rownumber"),u=u.join("");var a=[];a.push(n.id),a.push("_row_"),a.push(e.i),a.push("_cell_rownumber"),a=a.join("");var f=[];f.push('<tr id="'),f.push(e.id),f.push("-view1-row-"),f.push(e.i),f.push('" '),f.push(s),f.push(' datagrid-rid="'),f.push(e.i),f.push('" class="datagrid-row datagrid-row-view1 '),f.push(o),f.push('">');if(n.rowNumbersWidth!==!1){f.push('<td id="'),f.push(u),f.push('" align="center" class="datagrid-td-rownumber"><div id="'),f.push(a),f.push('" class="datagrid-cell-rownumber" style="width:'),f.push(parseFloat(e.rowNumbersWidth)),f.push('px;">');var l="";e.rowNumbersExpand===!1?l=(n.pageNumber-1)*n.pageSize+ ++e.i:e.rowNumbersExpand=="auto"?l=++e.i:$.isFunction(e.rowNumbersExpand)?l=e.rowNumbersExpand.call(t,e.data):l=n.self.tpl(e.rowNumbersExpand,e.data),f.push(l),f.push("</div></td>")}return f.push("</tr>"),f.join("")},resetHeader:function(){var e=this,t=e.configs,n=t.gid;if("lockColumns"in t&&t.lockColumns.length){var r=0,i=t.lockColumns.length;for(;r<i;r++)if(t.lockColumns[r]!=null){e.setGridHeader();return}}if("lockRows"in t&&t.lockRows.length){var r=0,i=t.lockRows.length;for(;r<i;r++)if(t.lockRows[r]!=null){e.setGridHeader();return}}},_selectLazyRows:function(e){var t=this,n=t.configs;n.lazyLoadRow&&t.inArray(e,n.selectRows)!=-1&&t.selectRow(e)},_loadRow:function(e,t){var n=this,r=n.configs,i=r.data,s=r.pageTotal||i.length;if(!s)return;var t=n._undef(t,!0),o=n.denyEventInvoke("_insert",e,i[e],t);o.isNew&&(r.denyRowEvents===!1?n.bindRowEvent(o.tr,o.ltr):$.isFunction(r.denyRowEvents)&&r.denyRowEvents.call(n,o.tr,o.ltr))},_loadRows:function(){var e=this,t=e.configs,n=t.data,r=t.pageTotal||n.length;if(!t.lazyLoadRow||!r)return;var i=$("#view2-datagrid-body-"+t.id).height();t.__vh=i;var s=(t.lazyMaxRow?t.lazyMaxRow:Math.ceil(i/t._trHeight))+t.lazyTopRows+t.lazyBottomRows,o=Math.ceil(t.sTop/t._trHeight)-t.lazyTopRows;o=o>0?o:1;var u=s+o;u=u<=r?u:r,o>=r&&(u=r,o=u-s,o=o>0?o:1);var a=e.fireEvent("onBeforeLazyLoadRow",[o,u,s,n,t]);if(a===!1)return!1;var f=(o-1)*t._trHeight,l=(r-u)*t._trHeight;$("#view2-datagrid-body-btable-tbody-header-"+t.id).height(f),$("#view1-datagrid-body-btable-tbody-header-"+t.id).height(f),$("#view2-datagrid-body-btable-tbody-footer-"+t.id).height(l),$("#view1-datagrid-body-btable-tbody-footer-"+t.id).height(l),e.lockMethod("resetViewSize");var c=[];$("#view2-datagrid-body-btable-tbody-"+t.id).find(">tr.datagrid-row").each(function(n){var r=$(this).attr("datagrid-rid");e.inArray(r,t.lazyRows)==-1&&t.lazyRows.push(r)});for(var h=0;h<t.lazyRows.length;h++){if(t.lazyRows[h]>=o-1&&t.lazyRows[h]<=u-1)continue;var p=t.lazyRows[h],d=e.fireEvent("onBeforeLazyRowHide",[p,t]);if(d===!1)continue;e.denyEventInvoke("deleteRow",p,!1),e.fireEvent("onLazyRowHide",[p,t]),c.push(p)}for(var v=0;v<c.length;v++){var m=c[v],g=e.inArray(m,t.lazyRows);g!=-1&&t.lazyRows.splice(g,1)}var y=t.lazyRows;for(var b=o;b<=u;b++){var p=b-1;if(e.inArray(p,y)!=-1)continue;var d=e.fireEvent("onBeforeLazyRowShow",[p,t]);if(d===!1)continue;var w=e.denyEventInvoke("_insert",p,n[p],!1);w.isNew&&(t.denyRowEvents===!1?e.bindRowEvent(w.tr,w.ltr):$.isFunction(t.denyRowEvents)&&t.denyRowEvents.call(e,w.tr,w.ltr)),t.lazyRows.push(p),e.fireEvent("onLazyRowShow",[p,w,t])}t.lazyRows.sort(function(e,t){return e>=t?1:-1}),e.unLockMethod("resetViewSize")},loadRows:function(e){var t=this,n=t.configs,r=n.pageTotal||n.data.length;if(!n.lazyLoadRow)return;var e=t._undef(e,!1),i=n._tq;i&&clearTimeout(i);var s=function(){var r=n._initLazy;n._initLazy=!1,n._trHeight<=0&&(t.lockMethod("resetViewSize"),t.denyEventInvoke("_insert",0,{},!1),n._trHeight=$("#"+n.id+"-row-0").outerHeight(),t.denyEventInvoke("deleteRow",0,!1),t.unLockMethod("resetViewSize")),n._hc=Math.min(n.lazyBottomRows,n.lazyTopRows)*n._trHeight-n._lazyEdge;var i=!1;if(!r){if(Math.abs(n.sTop-n._csTop)<=n._hc&&!e)return;n.__vh=n.__vh||$("#view2-datagrid-body-"+n.id).height(),Math.abs(n.sTop-n._csTop)>=n.__vh&&(i=!0),n._csTop=n.sTop}else n.lazyRows=[],n._csTop=n.sTop;t.lockEvent("onScroll"),(i||r)&&n.showLazyLoading&&t.showLoading(),setTimeout(function(){t._loadRows(),(i||r)&&n.showLazyLoading&&t.hideLoading(),t.lockMethod("resetViewSize"),t.fireEvent("onShowLazyRows",[n.lazyRows,n]),t.unLockMethod("resetViewSize"),r?t.afterGridShow(!0):t.onScroll(!0),t.unLockEvent("onScroll")},0)},o;o=setTimeout(function(){t.lockMethod("resetViewSize"),t.fireEvent("onBeforeShowLazyRows",[n]),t.unLockMethod("resetViewSize"),s()},50),n._tq=o},lazyLoadRow:function(){var e=this,t=e.configs,n=t.data,r=t.pageTotal||t.data.length,i=t.columns,s=$("#view2-datagrid-body-"+t.id),o=$("#view1-datagrid-body-"+t.id),u=['<table class="datagrid-btable" id="view1-datagrid-body-btable-'+t.id+'" cellspacing="0" cellpadding="0" border="0"><tbody id="view1-datagrid-body-btable-tbody-'+t.id+'"><tr class="datagrid-row-header" id="view1-datagrid-body-btable-tbody-header-'+t.id+'" style="height:0px;"></tr>'],a=['<table class="datagrid-btable" id="view2-datagrid-body-btable-'+t.id+'" cellspacing="0" cellpadding="0" border="0"><tbody id="view2-datagrid-body-btable-tbody-'+t.id+'"><tr class="datagrid-row-header" id="view2-datagrid-body-btable-tbody-header-'+t.id+'" style="height:0px;"></tr>'];$.isArray(n)||(n=[]),a.push('<tr class="datagrid-row-footer" id="view2-datagrid-body-btable-tbody-footer-'+t.id+'" style="height:0px;"></tr></tbody></table>'),u.push('<tr class="datagrid-row-footer" id="view1-datagrid-body-btable-tbody-footer-'+t.id+'" style="height:0px;"></tr></tbody></table>'),s.html(a.join("")),o.html(u.join("")),t._trHeight<=0&&(e.lockMethod("resetViewSize"),e.denyEventInvoke("_insert",0,{},!1),t._trHeight=$("#"+t.id+"-row-0").outerHeight(),e.denyEventInvoke("deleteRow",0,!1),e.unLockMethod("resetViewSize"));var f=t._trHeight*r;$("#view2-datagrid-body-btable-tbody-header-"+t.id).height(f),$("#view1-datagrid-body-btable-tbody-header-"+t.id).height(f)},_clearBeforeShow:function(){var e=this,t=e.configs;t.selectRows=[]},setGridBody:function(e,t){var n=this,r=n.configs,i=r.gid,s=!0;r.columns.length||(s=!1),n.getColumns(),s||(n.setGridHeader(),n.onInitFieldWidth());var t=t||$.noop;n._clearBeforeShow();var o=n.fireEvent("onBeforeShowGrid",[r]);if(o===!1)return!1;if(r.lazyLoadRow){r._initLazy=!0;var u=r.sLeft,a=r.sTop;return n.one("onShowGrid.lazy",function(){r.sLeft=u,r.sTop=a}),n.lazyLoadRow(),n.onViewSizeChange(!1),n.fireEvent("onScroll",[]),n.hideLoading(),!0}return setTimeout(function(){var e=r.data,i=r.sLeft,s=r.sTop;n.onViewSizeChange(!1),n.setRow(0,function(){t(),r.sLeft=i,r.sTop=s}),n.hideLoading()},0),!0},afterGridShow:function(e){var t=this,n=t.configs,r=n.gid,e=t._undef(e,!1);t.methodCall("setGridBody"),t.lockMethod("resetViewSize"),t.fireEvent("onShowGrid",[n]),t.unLockMethod("resetViewSize"),t.methodInvoke("resetViewSize"),t.onFinishDone=t.onFinishDone||!1,t.onFinishDone||(t.onFinishDone=!0,t.fireEvent("onFinish",[n]))},removeEmptyDiv:function(){var e=this,t=e.configs,n=t.gid;if(!t.showEmptyGridMsg)return;var r=$("#"+t.id+"_empty-grid-msg");return r.size()&&r.remove(),!0},isEmptyGrid:function(){var e=this,t=e.configs,n=t.gid;if(!t.showEmptyGridMsg)return;t.showHeader||$("#"+t.id+"_empty-grid-msg").remove();if(t.data.length>=1||!t.showHeader)return;var r=$("#view2-datagrid-header-inner-htable-"+t.id).outerWidth(),i=$("#view2-datagrid-body-"+t.id),s=i.height();if(r>i.width()){var o=e.getScrollbarSize();s-=o.width}var u=$("#"+t.id+"_empty-grid-msg");if(u.size()){u._outerWidth(r),u._outerHeight(s);return}var a=$('<div class="empty-grid-msg" id="'+t.id+'_empty-grid-msg" style="height:100%;">'+e.tpl(t.emptyGridMsg,t)+"</div>");$("#view2-datagrid-body-"+t.id).append(a),a._outerWidth(r),a._outerHeight(s)},addFooterItems:function(e,t){var n=this,r=n.configs,i=$("#view2-datagrid-footer-inner-"+r.id),s=$("#view1-datagrid-footer-inner-"+r.id);s.append(e),i.append(t),n.methodInvoke("resetViewSize")},onScroll:function(e){var t=this,n=t.configs,r=n.gid,i=i||r+" .datagrid-view2",s=r+" .datagrid-view1";e=t._undef(e,!1),e&&(n.sLeft>=0&&n.gbody.scrollLeft(n.sLeft),n.sTop>=0&&n.gbody.scrollTop(n.sTop)),n.sLeft=n.gbody._scrollLeft(),n.sTop=n.gbody._scrollTop(),$("#datagrid-view2-header-inner-wraper-"+n.id)._scrollLeft(n.sLeft),$("#datagrid-view2-header-outer-wraper-"+n.id)._scrollLeft(n.sLeft),$("#view2-datagrid-footer-inner-"+n.id)._scrollLeft(n.sLeft),$("#view1-datagrid-body-"+n.id)._scrollTop(n.sTop)},onScrollBar:function(){var e=this,t=e.configs,n=t.gid,r=$("#view2-datagrid-body-"+t.id),i=0;r[0].scrollWidth>r.width()&&(i=e.getScrollbarSize().width);var s=r[0].scrollHeight;t.sTop+r.innerHeight()-i>=s&&e.fireEvent("onScrollEnd")},showGrid:function(e,t,n){var r=this,i=r.configs,s=i.gid,o=o||s+" .datagrid-view2",e=e||$.noop,t=t||$.noop,n=r._undef(n,!1);r.getGridData(function(){r.fireEvent("onGetData",[i.data,i]),e.apply(this,arguments)},function(){t.apply(this,arguments)},n)},refreshData:function(){var e=this.configs.events,t=this,n=t.configs,r=n.gid,i=i||r+" .datagrid-view2";t.fireEvent("onBeforeRefresh",[n]),t.showGrid(function(){t.setGridBody(i,function(){t.fireEvent("onRefresh",[n])})})},updateGrid:function(e){var t=this,n=t.configs;t.setGridData(e,!1,!0)},updateGridData:function(e){var t=this,n=t.configs;t.setGridData(e,!0,!0)},refreshDataCache:function(){var e=this;e.setGridBody()},clearCache:function(){var e=this.configs;e.views=[],e.isCreate=!1,this.onFinishDone=!1,e.isShow=!1,e.pki=0},clearDataCache:function(){var e=this.configs;return e.cacheData=[],this},reLoadGrid:function(e,t){this.clearCache(),this.clearDataCache();var n=[];e.data&&(n=e.data,e.data=[]);var r=$.extend(!0,{},e);r.data=n,e.data=n,$.dataGrid.call(this,r)},width:function(e){var t=this,n=t.configs;return t.resetGridSize(e,n.height),t},height:function(e){var t=this
,n=t.configs;return t.resetGridSize(n.width,e),t},setWH:function(e,t){var n=this;return n.resetGridSize(e,t),n},resize:function(e){var t=this,n=t.configs,r=n.renderTo.width(),i=n.renderTo.height();t.resetGridSize(r,i,e)},C:function(e,t){return typeof e=="undefined"?this.configs:typeof t=="undefined"?this.configs[e]:(this.configs[e]=t,this)},createGrid:function(e){var t=this,n=t.configs,r=n.gid,e=e||r+" .datagrid-view2";return t.setGridHeader(e),t.showGrid(function(){t.setGridBody(e)}),t.methodCall("createGrid"),t},sortData:function(e,t,n){},onDataChange:function(e){var t=this,n=t.configs;t.refreshData()},addData:function(e){var t=this,n=t.configs,r=t.getAsync(),i=t._undef(i,[]);i=$.isPlainObject(i)?[i]:i;var s=n.pk;if(r){var o=t.getData(),u=i.length;for(var a=0;a<u;a++){var e=i[a];e[s]=t._undef(e[s],t.unique()),o.push(e)}t.fireEvent("onAdd",[i,!0]),t.fireEvent("onDataChange",t,[i])}else t.fireEvent("onAjaxAdd",[i,function(){t.onDataChange(i)}])},updateData:function(e){var t=this,n=t.configs,r=t.getAsync(),e=t._undef(e,[]);e=$.isPlainObject(e)?[e]:e;var i=n.pk,s=!1;if(r){var o=e.length;for(var u=0;u<o;u++){var a=e[u];if(!$.isPlainObject(a))continue;s=t._undef(a[i],!1);if(s===!1)continue;var f=t.getData(),l=0,c=f.length;for(;l<c;l++)if(f[l][i]==a[i]){f[l]=a;break}}t.fireEvent("onUpdate",[e,!0]),t.fireEvent("onDataChange",[e])}else t.fireEvent("onAjaxUpdate",[e,function(){t.onDataChange(e)}])},deleteData:function(e){var t=this,n=t.configs,r=t.getAsync(),e=t._undef(e,[]);e=$.isPlainObject(e)?[e]:e;var i=n.pk,s=!1;if(r){var o=t.getData(),u=e.length;for(var a=0;a<u;a++){var f=e[a];if(!$.isPlainObject(f))continue;s=t._undef(f[i],!1);if(s===!1)continue;var l=0,u=o.length;for(;l<u;l++)if(o[l][i]==f[i])break;var c=0,h=[];for(;c<u;c++){if(l==c)continue;h.push(o[c])}o=h}t.fireEvent("onDelete",[e,!0]),t.fireEvent("onDataChange",[e])}else t.fireEvent("onAjaxDelete",[e,function(){t.onDataChange(e)}])},getAsync:function(){var e=this,t=e.configs,n=t.gid;return t.url==""||t.url===!1?!0:!1},setGridData:function(e,t,n){var r=this,i=r.configs,s=i.gid,e=r._undef(e,!1);if(!e)return!1;var t=r._undef(t,null),n=r._undef(n,!1);return t==null&&(t=r.getAsync()),t?i.cacheData.source=e:i.data=e,i.pk=="_pk"&&r.fireEvent("onSetPk",[e]),n&&(t?r.showGrid(function(){r.setGridBody()},$.noop,!0):r.refreshDataCache()),!0},page:function(e){var t=this,n=t.configs,e=t._undef(e,1);n.pageNumber=parseInt(e)<=0?1:parseInt(e),t.refreshData()},jsonFilter:function(e){return e},metaData:function(e,t){var n=this,r=n.configs,i=e||{},t=n._undef(t,!1);i.footer&&(r.footerData=i.footer),i.rows&&(r.data=i.rows),r.total=i.total||i.rows.length,r.pageSize=n.isNumber(i.pageSize)?i.pageSize:r.pageSize,r.pageNumber=n.isNumber(i.pageNumber)?i.pageNumber:r.pageNumber,i.columns&&(r.columns=i.columns,n.setGridHeader());for(var s in i)n.inArray(s,["footer","rows","total","pageSize","pageNumber","columns"])==-1&&(r[s]=i[s]);t&&n.refreshDataCache()},_loadSuccess:function(e,t){var n=this,r=n.configs,i=r.gid,s=r.dataType.toLowerCase(),o=s+"Filter",e=e;o in n?$.isFunction(n[o])&&(e=n[o].call(n,e)):o in r?$.isFunction(r[o])&&(e=r[o].call(n,e)):o in window&&$.isFunction(window[o])&&(e=window[o].call(window,e)),n.fireEvent("onLoadSuccess",[e,t,r]),n.metaData(e)},_loadError:function(e,t,n){var r=this,i=r.configs,s=i.gid;r.showLoading(e),r.fireEvent("onLoadError",[e,t,n,i]),setTimeout(function(){r.hideLoading(),r.refreshDataCache()},2e3)},getGridData:function(e,t,n){var r=this,i=r.configs,s=i.gid,e=e||$.noop,t=t||$.noop,o=s+" .datagrid-view2",n=r._undef(n,!1);n==0&&(n=r.getAsync()),r.methodCall("getGridData");var u=r.fireEvent("onGetGridData",[e,t,n]);if(u===!1)return;if(n){i.cacheData.source=i.cacheData.source||i.data,r.fireEvent("onSetPk",[i.cacheData.source]),i.total=i.cacheData.source.length;var a=(i.pageNumber-1)*i.pageSize,f=i.pageSize*i.pageNumber;f=f>i.total?i.total:f;var l=[];for(var c=a;c<f;c++)i.cacheData.source[c]&&l.push(i.cacheData.source[c]);i.data=l,e.call(r,o);return}i.queryParams.pageNumber=i.pageNumber,i.queryParams.pageSize=i.pageSize;var h=function(){var e=r.fireEvent("onBeforeLoad",[i.queryParams,i]);if(e===!1)return!1;r.showLoading()},p=function(t){r._loadSuccess(t,e),r.fireEvent("onSetPk",[i.data]),e.call(r)},d=function(e){var e=$.isPlainObject(e)?e:{responseText:e};r._loadError(e.responseText,t,e),t.call(r,e.responseText)};if($.isFunction(i.url)){var v=h();if(v===!1)return;i.url.call(r,i.queryParams,p,d)}else $.ajax({url:i.url,type:i.method,cache:i.cache,dataType:i.dataType,data:i.queryParams,beforeSend:h,success:p,error:d})},setPk:function(e){var t=this,n=t.configs;if(n.pk!="_pk")return;$.each(e,function(t,r){var i=$.dataGrid.aid++;e[t][n.pk]=i})},show:function(){var e=this,t=e.configs,n=t.views,r=$("#"+t.id);if(t.isShow)return;t.isShow=!0;var i=e.fireEvent("onBeforeShowContainer",[n]);if(i===!1)return;for(var s in n)r.append(n[s]);e._setGridWH(),e.setView(),e.fireEvent("onViewCreate",[]),e.createGrid(),e.methodCall("show"),e.fireEvent("onShowContainer",[n])}}),$.fn._scrollLeft=function(e){return e==undefined?this.scrollLeft():this.each(function(){$(this).css("marginLeft",e*-1)})},$.fn._scrollTop=function(e){return e==undefined?this.scrollTop():this.each(function(){$(this).css("marginTop",e*-1)})},$.fn.grid=function(e){if(this.size()<=0)return!1;var t=[],n=[];return e.data&&(n=e.data,e.data=[]),this.each(function(r){var i=$(this),s=$.extend(!0,{},e);s.selector=i.selector,s.renderTo=i,s.width=$.dataGrid._undef(s.width,i.width()),s.height=$.dataGrid._undef(s.height,i.height()),e.data&&(s.data=n),i.data("metaData",s);var o=new $.dataGrid(s);i.data("datagrid",o),t.push(o)}),this.size()==1?this.data("datagrid"):t},$.fn.datagrid=$.fn.datagrid||$.fn.grid,$.fn.dataGrid=$.fn.dataGrid||$.fn.grid,$.fn.extGrid=$.fn.grid,$.fn.extgrid=$.fn.grid,$.fn.togrid=function(e,t){},$.fn.toGrid=$.fn.togrid,$.fn._resize=function(e){function n(e,t){$(document.body).css("cursor","col-resize"),$(document.body).css("-moz-user-select","none"),$(document.body).attr("unselectable","on"),t.gheader.find(".datagrid-header-inner").css("cursor","col-resize"),t.gheader.find("div.datagrid-cell").css("cursor","col-resize");var n=$("<div class='datagrid-resize'></div>"),s="#view_"+t.id;$(s).append(n);var o=$(this).offset().left-$(s).offset().left,u=$(s).height(),a=$(this).width();o=parseFloat(o)+parseFloat(a),n.css({position:"absolute",top:0,zIndex:9999,height:parseFloat(u),left:o}),t.line=n,t.x=e.clientX,t.left=o,t.offsetX=0,$(document.body).bind("selectstart",function(e){return!1}),$(document).bind("mousemove",function(e){var n=t.self.fireEvent("onResizeColumn",[t,e]);if(n===!1)return;r(e,t)}),$(document).bind("mouseup",function(e){var n=t.stop(e,t);i(e,t)})}function r(e,t){var n=e.clientX,r=t.left+(n-t.x);t.offsetX=n-t.x,t.line.css({left:r})}function i(e,t){var n="#view_"+t.id;$(document).unbind("mousemove"),$(document).unbind("mouseup"),$(document.body).unbind("selectstart"),$(document.body).css("cursor","default"),$(document.body).removeAttr("unselectable"),t.gheader.find(".datagrid-header-inner").css("cursor","default"),t.gheader.find("div.datagrid-cell").css("cursor","default"),$(t.line).remove()}var e=e||{},e=$.extend({},e),t=this;t.each(function(t){$("<div class='datagrid_resize'></div>").appendTo($(this).parent()).bind("mousedown",function(t){e.field=$(this).parent().attr("field");var r=e.self.fireEvent("onResizeColumnStart",[this,e,t]);if(r===!1)return;n.call(this,t,e),t.preventDefault(),t.stopPropagation()})})},$.fn.moveColumn=function(e){function r(t){n=!0,e.moveField=$(this).attr("field");var r=e.self.fireEvent("onBeforeColumnMove",[e.moveField,e]);if(r===!1)return r;var i=$('<div class="column-move" id="'+e.id+'_move" style="position:absolute;z-index:9999;">'+$(".datagrid-cell",this).html()+"</div>").appendTo("#"+e.id),s=$('<div class="column-move-line" id="'+e.id+'_line" style="position:absolute;height:'+$(this).outerHeight()+'px;"></div>').appendTo("#"+e.id),o=$("#"+e.id).offset();i.css({left:t.pageX-o.left+10,top:t.pageY-o.top+10}),$(document.body).bind("mousemove.move",function(t){i.css({left:t.pageX-o.left+10,top:t.pageY-o.top+10}),t.preventDefault(),t.stopPropagation();var n=e.self.fireEvent("onColumnMoving",[i,e.moveField,e.moveToField,e]);if(n===!1){e.moveToField=e.moveField;return}}),$(document.body).bind("mouseup.move",function(t){n=!1,i.remove(),s.remove(),$(document.body).unbind("mousemove.move mouseup.move"),e.self.moveColumn(),t.preventDefault(),t.stopPropagation()})}var t=this,n=!1;t.bind("mousedown.move",function(t){var n=this,i=setTimeout(function(){r.call(n,t)},e.moveColumnTm);$(document.body).bind("mouseup.wt",function(e){clearTimeout(i),$(document.body).unbind("mouseup.wt")}),t.preventDefault(),t.stopPropagation()}),t.bind("mousemove.h",function(t){if(n==0)return;var r=$("#"+e.id).offset(),i=r.top,s=r.left,o=$(this).outerWidth(),u=$(this).height()-2,a=$(this).offset().top-i,f=$(this).offset().left-s-2,l=t.pageX,c=l-$(this).offset().left;e.moveToField=$(this).attr("field"),c<=o/2?($("#"+e.id+"_line").css({left:f,top:a,height:u}),e.moveToFieldPos=1):($("#"+e.id+"_line").css({left:f+o,top:a,height:u}),e.moveToFieldPos=0)})},$.fn._outerWidth=function(e){return e==undefined?this[0]==window?this.width()||document.body.clientWidth:this.outerWidth()||0:this.each(function(){if(!$.support.boxModel&&$.browser.msie)$(this).width(e);else{var t=e-($(this).outerWidth()-$(this).width());t=t<0?0:t,$(this).width(t)}})},$.fn._outerHeight=function(e){return e==undefined?this[0]==window?this.height()||document.body.clientHeight:this.outerHeight()||0:this.each(function(){if(!$.support.boxModel&&$.browser.msie)$(this).height(e);else{var t=e-($(this).outerHeight()-$(this).height());t=t<0?0:t,$(this).height(t)}})}})(jQuery)