(function(e){e.dataGrid=function(e){this.init(e)},e.dataGrid.fn={},e.dataGrid.fn.extend=function(t){e.extend(e.dataGrid.prototype,t)},e.dataGrid.extend=function(t){e.extend(e.dataGrid,t)},e.dataGrid.extend({getDefaults:function(){return{self:null,init:e.noop,title:"",toolBars:!1,_toolItem:{text:"",cls:"",callBack:e.noop,disabled:!1},rowNumbersWidth:"0px",rowNumbersExpand:!1,rowNumbers2Row:!0,rowTpl:"",headerTpl:"",leftBorder:1,rightBorder:1,topBorder:1,bottomBorder:1,width:700,height:250,checkBox:!1,editColumn:!1,editColumnTitle:"操作",editCellW:60,columns:[],_columnMetaData:{field:"",title:"",width:"120px",align:"left",_expand:!1,callBack:e.noop,hcls:"",bcls:"",fcls:"",sortable:!1,textLimit:!1,fitColumn:!0,disabled:!1},textLimit:!1,textLimitDef:"...",groupBy:!1,groupList:!1,groupListCallBack:e.noop,_groupListData:[],_sTop:0,_sLeft:0,_lTime:50,_lSize:50,fitColumns:!0,data:[],pk:"",lockRows:[],lockColumns:[],hideColumns:[],selectRows:[],isCreate:!1,isShow:!1,views:{},method:"post",url:"",loadMsg:"加载中,请稍后...",cache:!0,cacheData:[],pagination:!1,pageNumber:1,pageSize:10,dataType:"json",pageList:[10,20,30,40,50],queryParams:{},singleSelect:!1,iconCls:"",sortName:"",sortOrder:"asc",rowStyler:"",rowCallBack:e.noop,tpl:{},methodCall:{},template:template,isEscape:!1,noop:e.noop,events:{onStart:e.noop,onFinish:e.noop,onBeforeLoad:e.noop,onLoadSuccess:e.noop,onLoadError:e.noop,onClickRow:e.noop,onOverRow:e.noop,onOutRow:e.noop,onDblClickRow:e.noop,onClickCell:e.noop,onDblClickCell:e.noop,onSortColumn:e.noop,onResizeColumnStart:e.noop,onResizeColumn:e.noop,onResizeColumnStop:e.noop,onSelect:e.noop,onUnselect:e.noop,onSelectAll:e.noop,onUnselectAll:e.noop,onHeaderContextMenu:e.noop,onHeaderCreate:e.noop,onToolBarCreate:e.noop,onRowContextMenu:e.noop,onBeforeRefresh:e.noop,onRefresh:e.noop,onChangePageSize:e.noop,onShowGriding:e.noop,onShowGrid:e.noop,onBeforeShowGrid:e.noop,onGetData:e.noop,onSelectPage:e.noop,onClickRowNumber:e.noop,onSearch:e.noop,onExpandRow:e.noop,onLockColumn:e.noop,onAfterLockColumn:e.noop,onLockRow:e.noop,onAfterLockRow:e.noop,onUnlockColumn:e.noop,onUnlockRow:e.noop,onViewSizeChange:e.noop,onSizeChange:e.noop,onScroll:e.noop,onDataChange:e.noop,onAdd:e.noop,onUpdate:e.noop,onDelete:e.noop,onAjaxAdd:e.noop,onAjaxUpdate:e.noop,onAjaxDelete:e.noop}}},_undef:function(e,t){return e===undefined?t:e},_Tpl:{container:'<div class="datagrid-container" id="<%=id%>" style=" position:relative; overflow:hidden; width:<%=width%>px; height:<%=height%>px;"></div>',title:'<div class="datagrid-title <%=iconCls%>" id="title_<%=id%>"><%=title%></div>',toolbar:'<div class="datagrid-toolbar" id="toolbar_<%=id%>"></div>',grid:'<div class="datagrid-view" id="view_<%=id%>" style="width:<%=width%>px; height:0px;"></div>',group_row:'<tr id="<%=id%>-group-row-<%=gid%>"  datagrid-group-row-id="<%=gid%>" class="datagrid-group-row"><td style="width:<%=w%>px" colspan="<%=colspan%>"><div  class="datagrid-group-cell"><%=html%>(<%=num%>)</div></td></tr>',view1:'<div class="datagrid-view1" id="view1_<%=id%>" style="width:<%=parseInt(rowNumbersWidth)%>px;height:100%;"><div  class="datagrid-header" id="view1-datagrid-header-<%=id%>" style="width: 100%; z-index:40; position:relative;"><div class="datagrid-header-inner" id="view1-datagrid-header-inner-<%=id%>"><div class="datagrid-header-inner-wraper"><table class="datagrid-htable" id="view1-datagrid-header-inner-htable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-inner-htable-tbody-<%=id%>"></tbody></table></div></div><div class="datagrid-header-outer" id="view1-datagrid-header-outer-<%=id%>"><div class="datagrid-header-outer-wraper"><table class="datagrid-locktable" id="view1-datagrid-header-outer-locktable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-outer-locktable-tbody-<%=id%>"></tbody></table></div></div></div><div class="datagrid-body-wrap" id="view1-datagrid-body-wrap-<%=id%>" style="width: 100%; height:0px; overflow:hidden;zoom:1; "><div class="datagrid-body" id="view1-datagrid-body-<%=id%>" style="width: 100%;float:left;z-index:30;position:relative;"><table class="datagrid-btable" id="view1-datagrid-body-btable-<%=id%>" cellspacing="0" cellpadding="0" border="0"><tbody id="view1-datagrid-body-btable-tbody-<%=id%>"></tbody></table></div></div><div class="datagrid-footer" id="view1-datagrid-footer-<%=id%>" style="width: 100%; height:0px; overflow:hidden;"></div></div>',view2:'<div class="datagrid-view2" id="view2_<%=id%>" style="width:0px;height:100%;"><div  class="datagrid-header" id="view2-datagrid-header-<%=id%>" style="width: 100%;"><div class="datagrid-header-inner" id="view2-datagrid-header-inner-<%=id%>"><div class="datagrid-header-inner-wraper"><table class="datagrid-htable" id="view2-datagrid-header-inner-htable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-inner-htable-tbody-<%=id%>"></tbody></table></div></div><div class="datagrid-header-outer" id="view2-datagrid-header-outer-<%=id%>"><div class="datagrid-header-outer-wraper"><table class="datagrid-locktable" id="view2-datagrid-header-outer-locktable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-outer-locktable-tbody-<%=id%>"></tbody></table></div></div></div><div class="datagrid-body" id="view2-datagrid-body-<%=id%>" style="width: 100%;height:0px;"><table class="datagrid-btable" id="view2-datagrid-body-btable-<%=id%>" cellspacing="0" cellpadding="0" border="0"><tbody id="view2-datagrid-body-btable-tbody-<%=id%>"></tbody></table></div><div class="datagrid-footer" id="view2-datagrid-footer-<%=id%>" style="width: 100%; height:0px; overflow:hidden;"></div></div>',pager:'<div class="datagrid-pager pagination"> <table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><select class="pagination-page-list"><% var s = ""; for(var i=0;i<pageList.length;i++) {%><% if(pageList[i] == pageSize) {%><% s="selected";%><% } else {s="";} %><option value="<%=pageList[i]%>" <%=s%> ><%=pageList[i]%></option><% } %></select></td><td><div class="pagination-btn-separator"></div></td><td><a href="javascript:void(0)" class=" p-plain <%=(pageNumber <= 1 )?"p-btn-disabled":""%>"><span class="pagination-first  p-btn">&nbsp;</span></a></td><td><a href="javascript:void(0)" class=" p-plain <%=(pageNumber <= 1 )?"p-btn-disabled":""%>"><span class="pagination-prev  p-btn">&nbsp;</span></a></td><td><div class="pagination-btn-separator"></div></td><td><span style="padding-left:6px;">第</span></td><td><input class="pagination-num" type="text" value="<%=pageNumber%>" size="2"></td><td><span style="padding-right:6px;">页 共 <%=pages%> 页</span></td><td><div class="pagination-btn-separator"></div></td><td><a href="javascript:void(0)" class=" p-plain <%=(pageNumber >= pages)?"p-btn-disabled":""%>"><span class="pagination-next p-btn">&nbsp;</span></a></td><td><a href="javascript:void(0)" class=" p-plain <%=(pageNumber >= pages)?"p-btn-disabled":""%>"><span class="pagination-last p-btn ">&nbsp;</span></a></td><td><div class="pagination-btn-separator"></div></td><td><a href="javascript:void(0)" class=" p-plain"><span class="pagination-load p-btn">&nbsp;</span></a></td></tr></tbody></table><div class="pagination-info">当前显示 <%=(pageNumber*pageSize - pageSize + 1)<0 ? 0 : (pageNumber*pageSize - pageSize + 1)%> 到 <%=pageNumber*pageSize%> 条，共 <%=total%> 条</div><div style="clear:both;"></div></div>',view1_header_inner_row:'<tr class="datagrid-header-row"><td class="datagrid-td-rownumber"><div class="datagrid-header-rownumber" style="width:<%=parseInt(rowNumbersWidth)%>px;"></div></td></tr>',view1_header_outer_row:"",view2_header_inner_row:'<tr class="datagrid-header-row"><% for(var i in fields) {%><td field="<%=fields[i]["field"]%>" align="<%=fields[i]["align"]%>"><div class="datagrid-header-wrap" field="<%=fields[i]["field"]%>" ><div class="datagrid-cell <%=fields[i]["hcls"]%>"  style="width:<%=fields[i]["width"]%>"><span><%=fields[i]["title"]%></span><span class="datagrid-sort-icon">&nbsp;</span></div></div></td><% } %></tr>',view2_header_outer_row:"",view1_row:'<tr id="<%=id%>-view1-row-<%=i%>" <%=( typeof data["_groupid_"] != "undefined" ) ? "datagrid-group-id="+data["_groupid_"] : ""%> datagrid-row-index="<%=i%>" datagrid-row-select="0" class="datagrid-row datagrid-row-view1"><td align="center" class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber" style="width:<%=parseInt(rowNumbersWidth)%>px;"><%var j = i%><%=(rowNumbersExpand === false ? ++j : opt.self.tpl(rowNumbersExpand,data))%></div></td></tr>',view2_row:'<tr id="<%=id%>-row-<%=i%>" <%=( typeof data["_groupid_"] != "undefined" )? "datagrid-group-id="+data["_groupid_"] : ""%> datagrid-row-index="<%=i%>" datagrid-row-select="0" class="datagrid-row"><% for(var j in fields) {%><% var field = fields[j]["field"];%><td field="<%=fields[j]["field"]%>" align="<%=fields[j]["align"]%>"><div class="datagrid-cell datagrid-cell-c1-<%=fields[j]["field"]%> <%=fields[j]["bcls"]%>" style="width:<%=fields[j]["width"]%>;" ><%=fields[j]["_expand"] !== false ? opt.self.tpl(fields[j]["_expand"],data) : data[field]%></div></td><% } %></tr>'}}),e.dataGrid.fn.extend({init:function(t){var n=this;n.configs=e.extend({},e.dataGrid.getDefaults(),t);var r=n.configs;r.self=n,r.template.isEscape=r.isEscape,r.template.helper("parseInt",parseInt),r.width-=r.leftBorder+r.rightBorder,r.height-=r.topBorder+r.bottomBorder,r.id=r.id||n.getId(),r.gid=r.gid||"#view_"+r.id,r.rowNumbersWidth=parseInt(r.rowNumbersWidth)>=0?r.rowNumbersWidth:!1,r.rowNumbersWidth===!1&&(r.rowNumbersWidth=r.groupBy==0?!1:"0px"),console.log(parseInt(r.rowNumbersWidth)),r.init.call(n),n.sysEvents(),n.fireEvent("onStart",n),n.setContainer().setTitle().setToolBar().setGrid().setPager().show()},tpl:function(e,t){var n=this,r=n.configs,i=r.template.compile(e);return i(t)},bind:function(t,n){if(typeof t=="undefined")return this;var n=n||e.noop,r=this,i=r.configs.events;i[t]=e.dataGrid._undef(i[t],[]),e.isFunction(i[t])&&(i[t]=[]);var s=i[t].push(n);return s-1},unbind:function(t,n){var r=this,i=r.configs.events,n=e.dataGrid._undef(n,!1);return n===!1?i[t]=e.noop:i[t][n]=e.noop,r},fireEvent:function(t,n,r){var i=this,s=i.configs.events[t],n=e.dataGrid._undef(n,i),r=e.dataGrid._undef(r,[]),o=!0;if(e.isArray(s))for(var u=0;u<s.length;u++){o=s[u].apply(n,r);if(o===!1)break}else e.isFunction(s)&&(o=s.apply(n,r));return o},sysEvents:function(){var e=this,t=e.configs;e.bind("onShowGrid",e.autoExpand),e.bind("onClickRow",e.setExpandEvent),e.bind("onUnselectAll",function(){this.checkCk(!1)}),e.bind("onSelectAll",function(){this.checkCk(!0)}),e.bind("onUnselect",function(){this.checkCk(!1)}),e.bind("onSetPk",e.setPk),e.bind("onViewSizeChange",e.onViewSizeChange),e.bind("onSizeChange",e.onSizeChange),e.bind("onShowGrid",e.onLockRow),e.bind("onShowGrid",e.onLockColumn),e.bind("onBeforeShowGrid",e.onBeforeShowGrid),e.bind("onScroll",e.onScroll),e.bind("onAfterLockRow",e.onAfterLockRow),e.bind("onAfterLockColumn",e.onAfterLockColumn),e.bind("onDataChange",e.onDataChange),e.bind("onOverRow",e.onOverRow),e.bind("onOutRow",e.onOutRow),e.bind("onShowGrid",e.onDisplayField),e.bind("onSelect",e.addSelectRecode),e.bind("onUnselect",e.removeSelectRecode)},getId:function(){return"datagrid_"+Math.floor(Math.random()*99999)},unique:function(){return"unique_"+Math.floor(Math.random()*99999)},showLoading:function(t,n){var r=this,i=r.configs,t=typeof t=="undefined"?i.loadMsg:t,n=n||"#"+i.id;r.hideLoading(n),e('<div class="datagrid-mask" style="display:block"></div><div class="datagrid-mask-msg" style="display: block; left: 50%;">'+t+"</div>").appendTo(n);var s=e(n).find("> .datagrid-mask-msg").outerWidth(!0);e(n).find(">.datagrid-mask-msg").css("marginLeft",-s/2+"px"),e(n).find(">.datagrid-mask").click(function(e){return!1})},hideLoading:function(t){var n=this,r=n.configs,t=t||"#view_"+r.id;e("#"+r.id).find(".datagrid-mask-msg,.datagrid-mask").remove()},methodCall:function(t){var t=t||"",n=this,r=n.configs;return t!=""&&t in r.methodCall&&e.isFunction(r.methodCall[t])&&r.methodCall[t].call(n),n},getColumnData:function(t,n,r){var i=this,s=i.configs,t=e.dataGrid._undef(t,!1),n=e.dataGrid._undef(n,!1);if(t===!1)return i;var o=i.getColumns(!0);for(var u in o)if(o[u]["field"]==t)return n===!1?o[u]:typeof r=="undefined"?o[u][n]:(o[u][n]=r,s.columns=o,i.setGridHeader(),i.refreshDataCache(),i);return null},setColumnData:function(e,t,n){var r=this;return r.getColumnData(e,t,n)},getData:function(){var e=this,t=e.configs,n=e.getAsync();return n?t.cacheData.source:t.data},textLimit:function(t,n,r){var i=this,s=i.configs,t=e.dataGrid._undef(t,"");if(t=="")return t;t=new String(t);var o=e("<div style='position:absolute;left:-1000px;'></div>");o.appendTo(document.body),o.css({fontSize:r});var u=t.length,a="",f=0;for(var l=1;l<=u;l++){a=t.substr(0,l),o.html(a+s.textLimitDef);if(!(parseInt(o.width())<parseInt(n)))break;f=l}return o.remove(),f==0?t.substr(0,1)+s.textLimitDef:f==u?t:t.substr(0,f)+s.textLimitDef},getTpl:function(t){var t=t||"",n=this,r=n.configs;template.isEscape=r.isEscape;var i=t in r.tpl?e(r.tpl[t]).html():e.dataGrid._Tpl[t];return i=i==""?e.dataGrid._Tpl[t]:i,i},setContainer:function(t){var t=t||{},n=this,t=e.extend({},n.configs,t),r=n.tpl(n.getTpl("container"),t);return t.helper.html(r),n},setTitle:function(t){var n=this,r=n.configs;r.title=typeof t=="undefined"?r.title:t;if(r.title=="")return n;var i=n.tpl(n.getTpl("title"),r);return n.configs.views.title=e(i),n},getTools:function(t){var n=this,r=n.configs;if(!e.isArray(t))return!1;var i=r._toolItem,s='<table cellspacing="0" cellpadding="0" border="0"><tbody><tr>{$tools}</tr></tbody></table>',o="";for(var u in t)if(e.isPlainObject(t[u])){t[u]=e.extend({},i,t[u]),t[u]["cls"]!=""&&(t[u].cls+=" l-btn-icon-left");var a=t[u].disabled?"l-btn-disabled":"";o+='<td><a href="javascript:void(0)" class="l-btn l-btn-plain '+a+'" indexid="'+u+'"><span class="l-btn-left"><span class="l-btn-text '+t[u].cls+'">'+t[u].text+"</span></span></a></td>"}else t[u]=="|"||t[u]=="-"||t[u]==";"||t[u]==","?o+='<td><div class="datagrid-btn-separator"></div></td>':o+="<td>"+t[u]+"</td>";s=s.replace("{$tools}",o);var s=e(s);return s.find(".l-btn").each(function(r){e(this).click(function(r){var i=e(this).attr("indexid");t[i].callBack.call(n,this,t[i]),r.stopPropagation(),r.preventDefault()})}),s},setToolBar:function(){var t=this,n=t.configs;if(n.toolBars===!1)return t;var r=t.tpl(t.getTpl("toolbar"),n);t.configs.views.toolbar=e(r);var i=t.getTools(n.toolBars);return i!==!1&&t.configs.views.toolbar.append(i),t.fireEvent("onToolBarCreate",t,[t.configs.views.toolbar,n.toolBars]),t.methodCall("setToolBar"),t},setGrid:function(){var t=this,n=t.configs,r=n.views;if(!r.grid){var i=t.tpl(t.getTpl("grid"),n);t.configs.views.grid=e(i)}else{var s=r.grid,o=0;for(var u in r){if(u=="grid")continue;o+=r[u].outerHeight(!0)}s.height(n.height-o)}return t.methodCall("setGrid"),t},autoExpand:function(){var e=this,t=e.configs;for(var n in t.data)"_expand"in t.data[n]&&"_openExpand"in t.data[n]&&t.data[n]._openExpand&&e.expandRow(n,t.data[n]._expand)},checkCk:function(t){var n=this,r=n.configs,i=r.gid,s=i,t=e.dataGrid._undef(t,!1);e("#view2-datagrid-header-inner-htable-tbody-"+r.id).find(">.datagrid-header-row >td[field='ck']").find("input:checkbox").each(function(e){this.checked=t?!0:!1})},setExpandEvent:function(e,t,n){var r=this,i=r.configs;"_expand"in n&&(r.isExpandRowShow(t)?r.hideExpandRow(t):r.expandRow(t,n._expand))},addPagerEvent:function(){var t=this,n=t.configs,r=t.configs.views.pager,i=n.events;return r.find(".pagination-first").click(function(){if(e(this).parent().hasClass("p-btn-disabled"))return;n.pageNumber=1,t.refreshData()}),r.find(".pagination-prev").click(function(){if(e(this).parent().hasClass("p-btn-disabled"))return;var r=n.pageNumber-1;n.pageNumber=r<0?1:r,t.refreshData()}),r.find(".pagination-next").click(function(){if(e(this).parent().hasClass("p-btn-disabled"))return;var r=n.total||n.data.length,i=Math.ceil(parseInt(r)/parseInt(n.pageSize)),s=n.pageNumber+1;n.pageNumber=s>i?i:s,t.refreshData()}),r.find(".pagination-last").click(function(){if(e(this).parent().hasClass("p-btn-disabled"))return;var r=n.total||n.data.length,i=Math.ceil(parseInt(r)/parseInt(n.pageSize));n.pageNumber=i,t.refreshData()}),r.find(".pagination-load").click(function(){if(e(this).parent().hasClass("p-btn-disabled"))return;t.refreshData()}),r.find(".pagination-page-list").change(function(){var r=e(this).val(),i=t.fireEvent("onChangePageSize",t,[r]);if(i===!1)return!1;n.pageSize=r;var i=t.fireEvent("onSelectPage",t,[r]);if(i===!1)return!1;t.refreshData()}),r.find(".pagination-num").keydown(function(e){e.keyCode===13&&(n.pageNumber=r.find(".pagination-num").val(),t.refreshData())}),t},setPager:function(){var t=this,n=t.configs;if(!n.pagination)return t;var r={};r.total=n.total||n.data.length,r.pageSize=n.pageSize,r.pageNumber=n.pageNumber,r.pageList=n.pageList,r.pages=Math.ceil(parseInt(r.total)/parseInt(r.pageSize)),n.pageNumber=n.pageNumber>r.pages?r.pages:n.pageNumber,n.pageNumber=n.pageNumber<=0?1:n.pageNumber,r.pageNumber=n.pageNumber;if(n.id)var i=e("#"+n.id).find(">.datagrid-pager").size();var s=t.tpl(t.getTpl("pager"),r);return i?(e("#"+n.id).find(">.datagrid-pager").replaceWith(s),t.configs.views.pager=e("#"+n.id).find(">.datagrid-pager")):t.configs.views.pager=e(s),t.addPagerEvent(),t.methodCall("setPager"),t},onSizeChange:function(t,n){var r=this,i=r.configs;i.width=e.dataGrid._undef(t,i.width),i.height=e.dataGrid._undef(n,i.height),i.width-=i.leftBorder+i.rightBorder,i.height-=i.topBorder+i.bottomBorder,e("#"+i.id).css({width:i.width,height:i.height}),e("#view_"+i.id).css({width:i.width}),r.setGrid(),r.fireEvent("onViewSizeChange",r,[])},onViewSizeChange:function(){var t=this,n=t.configs,r=n.gid,i=e(r).width(),s=e(r).height(),o=e("#view1_"+n.id),u=e("#view2_"+n.id),a=e("#view1-datagrid-header-inner-htable-"+n.id).outerWidth();o.width(a),u.width(i-parseInt(a));var f=e("#view2-datagrid-header-inner-htable-"+n.id).outerHeight();f=parseInt(f)-1,e("#view1-datagrid-header-inner-"+n.id+",#view2-datagrid-header-inner-"+n.id).height(f);var l=e("#view2-datagrid-header-outer-locktable-"+n.id).outerHeight();e("#view1-datagrid-header-outer-"+n.id+",#view2-datagrid-header-outer-"+n.id).height(l);var c=parseInt(e("#view2-datagrid-header-inner-"+n.id).outerHeight())+parseInt(e("#view2-datagrid-header-outer-"+n.id).outerHeight());e("#view1-datagrid-header-"+n.id).height(c),e("#view2-datagrid-header-"+n.id).height(c);var h=u.height()-n.gheader.height()-n.gfooter.height();n.gbody.height(h),e("#view1-datagrid-body-wrap-"+n.id).height(h),t.fireEvent("onScroll",t,[])},setView:function(){var t=this,n=t.configs,r=t.tpl(t.getTpl("view1"),n),i=t.tpl(t.getTpl("view2"),n),s=n.gid;e(s).html(""),e(r).appendTo(s),e(i).appendTo(s),n.gheader=e("#view2-datagrid-header-"+n.id),n.gbody=e("#view2-datagrid-body-"+n.id),n.gfooter=e("#view2-datagrid-footer-"+n.id),n.gbody.scroll(function(){t.fireEvent("onScroll",t,[])})},getRowData:function(t,n){var r=this,i=r.configs,n=e.dataGrid._undef(n,!1),s=n?r.getData():i.data;if(!n)return s[t];var o=i.pk;for(var u in s)if(s[u][o]==t)return s[u]},setRowData:function(e,t,n){var r=this,i=r.configs.data;return i[e][t]=n,r},getFieldValue:function(e,t){var n=this.getRowData(e);return n[t]},setFieldValue:function(t,n,r){var i=this,s=i.configs,o=s.gid,u="#"+s.id+"-row-"+t+",#"+s.id+"-view1-row-"+t;return e(u).find("> td[field='"+n+"'] div.datagrid-cell").html(r),i.setRowData(t,n,r),i},getSlectRows:function(){var t=this,n=t.configs,r=n.gid,i=[];return e(r).find(">.datagrid-view2 tr.datagrid-row[datagrid-row-select='1']").each(function(t){i.push(e(this).attr("datagrid-row-index"))}),i},onLockRow:function(){var e=this,t=e.configs,n=t.lockRows;for(var r in n){if(n[r]==null)continue;e.lockRow(n[r])}},onAfterLockRow:function(){var e=this,t=e.configs},onLockColumn:function(){var e=this,t=e.configs,n=t.lockColumns;for(var r in n)e.lockColumn(n[r])},onAfterLockColumn:function(){var t=this,n=t.configs,r=n.gid;e(r).find(".datagrid-row-expand").each(function(n){var r=e(this).attr("datagrid-exoand-row-index");t.hideExpandRow(r);var i=t.getRowData(r);t.expandRow(r,i._expand)}),t.addGroupRow()},lockRow:function(t){var n=this,r=n.configs;n._lockRow(t)&&(e.inArray(t,r.lockRows)==-1&&r.lockRows.push(t),n.fireEvent("onAfterLockRow",n,[]),n.fireEvent("onViewSizeChange",n,[]))},unLockRow:function(e){var t=this,n=t.configs;if(t._unLockRow(e)){for(var r in n.lockRows)n.lockRows[r]==e&&(n.lockRows[r]=null);t.fireEvent("onViewSizeChange",t,[])}},unLockColumn:function(e){var t=this,n=t.configs;if(t._unLockColumn(e)){for(var r in n.lockColumns)n.lockColumns[r]==e&&(n.lockColumns[r]=null);t.fireEvent("onViewSizeChange",t,[])}},lockColumn:function(t){var n=this,r=n.configs;n._lockColumn(t)&&(e.inArray(t,r.lockColumns)==-1&&r.lockColumns.push(t),n.fireEvent("onAfterLockColumn",n,[]),n.fireEvent("onViewSizeChange",n,[]))},_lockRow:function(t){var n=this,r=n.configs,i=r.gid,s=i,o=e(s).find("#"+r.id+"-row-"+t),u=e(s).find("#"+r.id+"-view1-row-"+t);return o.length?(e("#view2-datagrid-header-outer-locktable-tbody-"+r.id).append(o),e("#view1-datagrid-header-outer-locktable-tbody-"+r.id).append(u),!0):!1},_unLockRow:function(t){var n=this,r=n.configs,i=r.gid,s=i,o=e(s).find("#"+r.id+"-row-"+t),u=e(s).find("#"+r.id+"-view1-row-"+t);return o.length?(t?(t-=1,o.insertAfter("#"+r.id+"-row-"+t),u.insertAfter("#"+r.id+"-view1-row-"+t)):(e("#view2-datagrid-body-btable-tbody-"+r.id).prepend(o),e("#view1-datagrid-body-btable-tbody-"+r.id).prepend(u)),!0):!1},_getRowNumber:function(t){var n=this,r=n.configs,i=r.data,s=r.gid,o=e("#"+r.id+"-view1-row-"+t),u=!1;if(!o.size()){u=!0;var a=n.getTpl("view1_row");_d={i:t,id:r.id,rowNumbersExpand:r.rowNumbersExpand?r.rowNumbersExpand:!1,data:i[t],groupBy:r.groupBy,rowNumbersWidth:r.rowNumbersWidth,opt:r};var f=e(n.tpl(a,_d));n.bindRowEvent(!1,f),o=f}return{isNew:u,node:o}},_lockColumn:function(t){var n=this,r=n.configs,i=r.data,s=r.gid,o=s,u=n.getColumnList(),t=e.isArray(t)?t:[t],a="#view1-datagrid-header-inner-htable-tbody-"+r.id,f="#view1-datagrid-header-outer-locktable-tbody-"+r.id;for(var l in t){if(t[l]==null)continue;if(e.inArray(t[l],u)==-1)continue;var c=e("#view2-datagrid-header-inner-htable-tbody-"+r.id).find(">tr.datagrid-header-row >td[field='"+t[l]+"']");e(a).find(">tr.datagrid-header-row").append(c),e("#view2-datagrid-header-outer-locktable-tbody-"+r.id).find(">tr.datagrid-row >td[field='"+t[l]+"']").each(function(t){var i=e(this).parent().attr("datagrid-row-index"),s=n._getRowNumber(i);s.isNew&&e("#view1-datagrid-header-outer-locktable-tbody-"+r.id).append(s.node),e(this).appendTo(s.node)}),e("#view2-datagrid-body-btable-tbody-"+r.id).find(">tr.datagrid-row >td[field='"+t[l]+"']").each(function(t){var i=e(this).parent().attr("datagrid-row-index"),s=n._getRowNumber(i);s.isNew&&e("#view1-datagrid-body-btable-tbody-"+r.id).append(s.node),e(this).appendTo(s.node)}),e("#view2-datagrid-footer-btable-tbody-"+r.id).find(">tr.datagrid-footer-row >td[field='"+t[l]+"']").each(function(t){var i=e(this).parent().attr("datagrid-row-index"),s=n._getRowNumber(i);s.isNew&&e("#view1-datagrid-footer-btable-tbody-"+r.id).append(s.node),e(this).appendTo(s.node)})}return!0},_unLockColumn:function(t){var n=this,r=n.configs,i=r.gid,s=i,o=n.getColumns(),u=!1;for(var a in o)if(o[a]["field"]==t){u=!0;break}if(!u)return!1;var f=e("#view1-datagrid-header-inner-htable-tbody-"+r.id).find(">tr.datagrid-header-row >td[field='"+t+"']"),l=e(i),c=e("#view1_"+r.id),h=e("#view2_"+r.id),p=a;return p<=0?f.prependTo(e("#view2-datagrid-header-inner-htable-tbody-"+r.id).find(">tr.datagrid-header-row")):f.insertAfter(e("#view2-datagrid-header-inner-htable-tbody-"+r.id).find(">tr.datagrid-header-row").find(">td").eq(p-1)),e("#view1-datagrid-header-outer-locktable-tbody-"+r.id).find(">tr.datagrid-row >td[field='"+t+"']").each(function(t){var n=e(this).parent(),i=n.attr("datagrid-row-index"),s=e("#"+r.id+"-row-"+i);p<=0?s.prepend(e(this)):s.find(">td").eq(p-1).after(e(this))}),e("#view1-datagrid-body-btable-tbody-"+r.id).find(">tr.datagrid-row >td[field='"+t+"']").each(function(t){var n=e(this).parent(),i=n.attr("datagrid-row-index"),s=e("#"+r.id+"-row-"+i);p<=0?s.prepend(e(this)):s.find(">td").eq(p-1).after(e(this))}),e("#view1-datagrid-footer-btable-tbody-"+r.id).find(">tr.datagrid-row >td[field='"+t+"']").each(function(t){var n=e(this).parent(),i=n.attr("datagrid-row-index"),s=e("#"+r.id+"-row-"+i);p<=0?s.prepend(e(this)):s.find(">td").eq(p-1).after(e(this))}),!0},getCheckBoxColumn:function(t){var n=this,r=n.configs,i=e.extend({},r._columnMetaData);for(var s in t)if(t[s]["field"]=="ck")return!1;return i.field="ck",i.title='<input type="checkbox">',i._expand='<input type="checkbox">',i.hcls="datagrid-header-check",i.bcls="datagrid-cell-check",i.width="20px",i.fitColumn=!1,i.align="center",i.callBack=function(t,n,r,i){var s=this;e(t).find("input:checkbox").click(function(e){this.checked?s.selectRow(n):s.unselectRow(n),e.stopPropagation()})},i},geteditColumn:function(t){var n=this,r=n.configs,i=e.extend({},r._columnMetaData),s=0,o=0;e.isArray(r.editColumn)?e.each(r.editColumn,function(t,n){e.isPlainObject(this)?(r.editColumn[t]=e.extend({},r._toolItem,r.editColumn[t]),s++):o++}):r.editColumn=[];for(var u in t)if(t[u]["field"]=="ed")return!1;var a="";return i.field="ed",i.title=r.editColumnTitle==""||r.editColumnTitle===!1?" ":r.editColumnTitle,i._expand=a,i.hcls="datagrid-header-edit",i.bcls="datagrid-cell-edit",i.width=s*r.editCellW+o*4+"px",i.fitColumn=!0,i.align="center",i.callBack=function(t,n,i,s){var o=this,u=r._toolItem,a=[],f={};for(var l in r.editColumn)e.isPlainObject(r.editColumn[l])?(f=e.extend({},u,r.editColumn[l]),f.callBack=function(t,u){var a=e(t).attr("indexid");r.editColumn[a].callBack.call(o,t,n,i,s,u)},a.push(f)):a.push(r.editColumn[l]);var c=o.getTools(a);t.append(c)},i},getColumns:function(t){var n=this,r=n.configs,i=r.columns,t=e.dataGrid._undef(t,!1);r.cacheData.columns=e.dataGrid._undef(r.cacheData.columns,i);if(t)return r.cacheData.columns;if(i.length<=0&&r.data.length>0)for(var s in r.data[0])i.push({field:s});var o=[];for(var s in i){i[s]=e.extend({},r._columnMetaData,i[s]);if(i[s].disabled===!0)continue;typeof i[s]["width"]=="number"&&(i[s].width+="px"),i[s].title=i[s]["title"]==""?i[s].field:i[s].title,o.push(i[s])}r.columns=i=o;var u=ed=[];return r.checkBox!==!1&&n.getCheckBoxColumn(i)!==!1&&(u=[n.getCheckBoxColumn(i)],e.merge(u,i),i=u),r.editColumn!==!1&&n.geteditColumn(i)!==!1&&(ed=[n.geteditColumn(i)],e.merge(i,ed)),r.columns=i,r.columns},getColumnList:function(){var e=this,t=e.configs,n=t.gid,r=e.getColumns(),i=[];for(var s in r)i.push(r[s].field);return i},onDisplayField:function(){var e=this,t=e.configs,n=t.hideColumns;gid=t.gid;if(n.length<=0)return;for(var r in n){if(n[r]==null)continue;e.hideColumn(n[r])}},displayColumn:function(t,n){var r=this,i=r.configs,s=i.hideColumns;gid=i.gid;var o=r.getColumnList();if(e.inArray(t,o)==-1)return!1;var u=n=="show"?!0:!1;if(u)for(var a in s)s[a]==t&&(s[a]=null);else e.inArray(t,s)==-1&&s.push(t);return e(gid).find("td[field='"+t+"']")[n](),r.fireEvent("onViewSizeChange",r),r.setGroupRowSize(),!0},showColumn:function(e){var t=this;return t.displayColumn(e,"show")},hideColumn:function(e){var t=this;return t.displayColumn(e,"hide")},sortColumn:function(t){var n=this,r=n.configs,i=r.gid,t=t||!1;if(t==0)return;var s=s||i+" .datagrid-view2 .datagrid-header";e(s).find("td[field='"+t+"']").find("div.datagrid-cell").click(function(t){var i=e(this).parent().attr("field");r.sortName=i;var o=n.fireEvent("onSortColumn",n,[i]);if(o===!1)return;e(this).hasClass("datagrid-sort-asc")?(e(s).find("div.datagrid-cell").removeClass("datagrid-sort-asc").removeClass("datagrid-sort-desc"),e(this).removeClass("datagrid-sort-asc"),e(this).addClass("datagrid-sort-desc"),r.sortOrder="desc"):(e(s).find("div.datagrid-cell").removeClass("datagrid-sort-asc").removeClass("datagrid-sort-desc"),e(this).removeClass("datagrid-sort-desc"),e(this).addClass("datagrid-sort-asc"),r.sortOrder="asc"),n.refreshData()})},setGridHeaderEvent:function(t,n){var r=this,i=r.configs,s=i.gid,o=r.getColumns();if(i.fitColumns){var u=e.extend({},i);u.self=r,u.stop=function(e,t){var n=r.fireEvent("onResizeColumnStop",r,[t]);if(n===!1)return n;r.cStop(t)};for(var a in o)o[a].fitColumn&&t.find(">td[field='"+o[a].field+"'] div.datagrid-cell")._resize(u)}for(var a in o)o[a]["sortable"]==1&&r.sortColumn(o[a].field);i.sortName&&t.find("> td[field='"+i.sortName+"']  div.datagrid-cell").addClass("datagrid-sort-"+i.sortOrder.toLowerCase()),t.bind("contextmenu",function(e){var t=r.fireEvent("onHeaderContextMenu",r,[this]);if(t==0)return!1}),t.find(">td").hover(function(){e(this).addClass("datagrid-header-over")},function(){e(this).removeClass("datagrid-header-over")}),r.setGridHeaderTextLimit();if(i.checkBox){var f=t.find("> td[field='ck']");f.find(".datagrid-sort-icon").hide(),f.find("input:checkbox").click(function(){if(i.singleSelect)return this.checked=!1,!1;this.checked?r.selectAllRows():r.unselectAllRows()})}},setGridHeaderTextLimit:function(){var t=this,n=t.configs,r=n.gid,i=r;if(!n.textLimit)return!1;var s=t.getColumns();for(var o in s){if(s[o].textLimit===!1)continue;var u=e(i).find(".datagrid-header-row td[field='"+s[o].field+"']").find("div.datagrid-cell"),a=u.width(),f=u.css("fontSize"),l=t.getColumnData(s[o].field,"title");l=t.textLimit(l,a,f),u.find("span").first().html(l)}},setGridHeader:function(){var t=this,n=t.configs,r=n.gid,i=t.getColumns(),s=t.getTpl("view1_header_inner_row"),o=n.headerTpl?n.headerTpl:t.getTpl("view2_header_inner_row"),u=e("#view2-datagrid-header-inner-htable-tbody-"+n.id),a=e("#view1-datagrid-header-inner-htable-tbody-"+n.id),f=e("#view2-datagrid-header-outer-locktable-tbody-"+n.id),l=e("#view1-datagrid-header-outer-locktable-tbody-"+n.id),c=e(t.tpl(s,n)),h=e(t.tpl(o,{fields:i,opt:n}));return u.html(""),a.html(""),f.html(""),l.html(""),a.append(c),u.append(h),t.setGridHeaderEvent(h,c),t.methodCall("setGridHeader"),!0},setColumnValue:function(e,t,n){var r=this,i=r.getColumns();for(var s in i)if(i[s]["field"]==e){i[s][t]=n;continue}},cStop:function(t){var n=this,r=n.configs,i=r.gid,s=e(i).find("td[field='"+t.field+"']").find("div.datagrid-cell");if(!s.size())return;var o=parseInt(s.width());o+=t.offsetX,o=o<10?10:o,n.setColumnValue(t.field,"width",o),s.width(o),n.fireEvent("onScroll",n,[!0]),n.setGridHeaderTextLimit(),n.setGridBodyTextLimit(t.field),n.fireEvent("onViewSizeChange",n,[]),n.setGroupRowSize()},setGroupRowSize:function(){var t=this,n=t.configs,r=n.gid;if(!n.groupBy)return;var i=r+" .datagrid-view2",s=e(i).find(".datagrid-header-row").first().width();e(i).find(".datagrid-group-row td").width(s)},isRowHidden:function(t){var n=this,r=n.configs,i=r.gid;return t===undefined?!0:e("#"+r.id+"-row-"+t).size()&&!e("#"+r.id+"-row-"+t).is(":hidden")?!1:!0},isExpandRowShow:function(t){var n=this,r=n.configs,i=r.gid,s=r.id+"-expand-row-"+t;return e("#"+s).size()&&!e("#"+s).is(":hidden")?!0:!1},expandRow:function(t,n){var r=this,i=r.configs,s=i.gid,o=i.events,t=typeof t=="undefined"?!1:t;if(t===!1)return r;var n=typeof n=="undefined"?"":n,u=r.getRowData(t);n=r.tpl(n,u);var a=e("#"+i.id+"-row-"+t),f=e("#"+i.id+"-view1-row-"+t);if(a.size()<=0)return r;var l=i.id+"-expand-row-"+t;if(e("#"+l).size())a.after(e("#"+l));else{var c=e("<tr id='"+l+"' class='datagrid-row-expand' datagrid-exoand-row-index='"+t+"'><td colspan='"+i.columns.length+"'><div class='datagrid-cell' style='width:100%;height:100%;'>"+n+"</div></td></tr>");a.after(c)}var h=i.id+"-expand-view1-row-"+t;if(i.rowNumbersWidth!==!1||i.lockColumns.length)if(e("#"+h).size())f.after(e("#"+h));else{var p=0,d="";if(i.lockColumns.length)for(var v in i.lockColumns)i.lockColumns[v]!=null&&p++;p&&(d='<td colspan="'+p+'"></td>');var m=e("<tr id='"+h+"'  class='datagrid-row datagrid-row-view1' datagrid-exoand-row-index='"+t+"'><td class='datagrid-td-rownumber'><div class='datagrid-cell-rownumber'></div></td>"+d+"</tr>");f.after(m)}var c=e.dataGrid._undef(c,e("#"+l)),m=e.dataGrid._undef(m,e("#"+h));r.isRowHidden(t)?(c.hide(),m.hide()):(c.show(),m.show());var g=c.height();m.css({height:g}),r.fireEvent("onExpandRow",r,[t]),r.fireEvent("onViewSizeChange",r,[])},hideExpandRow:function(t){var n=this,r=n.configs,i=r.gid,t=typeof t=="undefined"?!1:t;if(t===!1)return n;var s=r.id+"-expand-row-"+t,o=r.id+"-expand-view1-row-"+t;e("#"+s).hide(),e("#"+o).hide(),n.fireEvent("onViewSizeChange",n,[])},selectAllRows:function(){var e=this,t=e.configs,n=t.gid,r=t.events;if(t.singleSelect)return e;var i=e.fireEvent("onSelectAll",e,[]);if(i===!1)return e;for(var s in t.data)e.selectRow(s);return e},unselectAllRows:function(){var e=this
,t=e.configs,n=t.gid,r=t.events,i=e.fireEvent("onUnSelectAll",e,[]);if(i===!1)return e;var s=e.getSlectRows();for(var o in s)e.unselectRow(s[o]);return e},addSelectRecode:function(){},removeSelectRecode:function(){},selectRow:function(t){var n=this,r=n.configs,i=r.gid,s=r.events,o=i,t=typeof t=="undefined"?!1:t;if(t===!1)return n;var u=n.getRowData(t),a=e("#"+r.id+"-row-"+t+",#"+r.id+"-view1-row-"+t);if(a.size()<=0)return n;var f=n.fireEvent("onSelect",n,[a,t,u]);if(f===!1)return f;a.attr("datagrid-row-select","1").addClass("datagrid-row-selected");if(r.checkBox){var l=a.find(">td[field='ck'] .datagrid-cell-check input:checkbox");l.get(0).checked=!0}var c=n.getSlectRows();if(c.length&&r.singleSelect)for(var h=0;h<c.length;h++){if(c[h]==t)continue;n.unselectRow(c[h])}return n},unselectRow:function(t){var n=this,r=n.configs,i=r.gid,s=r.events,o=i,t=typeof t=="undefined"?!1:t;if(t===!1)return n;var u=n.getRowData(t),a=e("#"+r.id+"-row-"+t+",#"+r.id+"-view1-row-"+t);if(a.size()<=0)return n;var f=n.fireEvent("onUnselect",n,[a,t,u]);if(f===!1)return f;a.attr("datagrid-row-select","0").removeClass("datagrid-row-selected");if(r.checkBox){var l=a.find(">td[field='ck'] .datagrid-cell-check input:checkbox");l.get(0).checked=!1}return n},showGroup:function(t,n){var r=this,i=r.configs,s=i.gid,o=s+" .datagrid-view2",u=s+" .datagrid-view1",n=e.dataGrid._undef(n,"show");if(typeof t=="undefined")return r;var a=e(o).find("tr[datagrid-group-id='"+t+"']"),f=e(u).find("tr[datagrid-group-id='"+t+"']");return a[n](),f[n](),a.each(function(t){var i=e(this).attr("datagrid-row-index"),s=r.getRowData(i);s._openExpand=e.dataGrid._undef(s._openExpand,!1),s._openExpand&&r.expandRow(i,s._expand),n=="hide"&&r.hideExpandRow(i)}),n=="show"?(e(o).find("#"+i.id+"-group-row-"+t).find("div.datagrid-group-cell").addClass("datagrid-group-cell-select"),e(u).find("#"+i.id+"-group-view1-row-"+t).find("div.datagrid-group-cell-rownumber").addClass("datagrid-group-cell-rownumber-select")):(e(o).find("#"+i.id+"-group-row-"+t).find("div.datagrid-group-cell").removeClass("datagrid-group-cell-select"),e(u).find("#"+i.id+"-group-view1-row-"+t).find("div.datagrid-group-cell-rownumber").removeClass("datagrid-group-cell-rownumber-select")),r.fireEvent("onScroll",r,[!0]),r.fireEvent("onViewSizeChange",r,[]),r},hideGroup:function(e){var t=this;return t.showGroup(e,"hide")},addGroupRow:function(t){var n=this,r=n.configs,i=r.gid,s=i+" .datagrid-view2",o=i+" .datagrid-view1";if(!r.groupBy)return!1;var t=e.dataGrid._undef(t,!1);t&&(e("#view2-datagrid-body-btable-tbody-"+r.id).find("> tr").hide(),e("#view1-datagrid-body-btable-tbody-"+r.id).find("> tr").hide());var u=e(s).find(".datagrid-header-row").width(),a="";r.rowNumbersWidth!==!1&&(a="datagrid-group-cell-rownumber"),columns=r.lockColumns;var f=0;for(var l in columns)columns[l]!=null&&f++;for(var l in r.groupList){r._groupListData[l]=e.dataGrid._undef(r._groupListData[l],[]);var c=n.tpl(n.getTpl("group_row"),{gid:l,w:parseInt(u),id:r.id,colspan:r.columns.length-f,html:r.groupList[l],num:r._groupListData[l].length}),h=e(s).find(".datagrid-body tr[datagrid-group-id='"+l+"']");h.size()<=0&&(h=e(s).find(".datagrid-header .datagrid-header-outer .datagrid-locktable tr[datagrid-group-id='"+l+"']"));var p=e(o).find("tr[datagrid-group-id='"+l+"']"),d="<tr id='"+r.id+"-group-view1-row-"+l+"' datagrid-group-row-id='"+l+"' class='datagrid-group-row-view1'><td colspan='"+(f+1)+"'><div class='"+a+"'></div></td></tr>",v=e(c),m=e(d);if(e("#"+r.id+"-group-row-"+l).size())e("#"+r.id+"-group-row-"+l).replaceWith(v),e("#"+r.id+"-group-view1-row-"+l).replaceWith(m),h.first().is(":hidden")||m.find("div.datagrid-group-cell-rownumber").addClass("datagrid-group-cell-rownumber-select");else if(h.size())v.insertBefore(h.first()),m.insertBefore(p.first()),h.first().is(":hidden")||m.find("div.datagrid-group-cell-rownumber").addClass("datagrid-group-cell-rownumber-select");else{for(var g=l-1;g>=0;g--){var y=e(s).find("tr[datagrid-group-id='"+l+"']"),b=e(o).find("tr[datagrid-group-id='"+l+"']");if(y.size()){v.insertAfter(y.last()),m.insertAfter(b.first());break}}g<0&&(v.appendTo(e(s).find(".datagrid-body .datagrid-btable tbody")),m.appendTo(e(o).find(".datagrid-body .datagrid-btable tbody")))}var w=v.height();m.height(w),w!=m.height()&&m.height(w-1),r.groupListCallBack.call(n,v.find(".datagrid-group-cell"),r.groupList[l],r._groupListData[l])}n.setGroupEvent()},setGroupEvent:function(){var t=this,n=t.configs,r=n.gid,i=r+" .datagrid-view2",s=r+" .datagrid-view1";for(var o in n.groupList)e(i).find("#"+n.id+"-group-row-"+o).click(function(){var n=e(this).attr("datagrid-group-row-id"),r=e(this).find(".datagrid-group-cell");r.hasClass("datagrid-group-cell-select")?t.hideGroup(n):t.showGroup(n)}),e(s).find("#"+n.id+"-group-view1-row-"+o).click(function(){var n=e(this).attr("datagrid-group-row-id"),r=e(this).find(".datagrid-group-cell-rownumber");r.hasClass("datagrid-group-cell-rownumber-select")?t.hideGroup(n):t.showGroup(n)})},groupByField:function(t,n,r){var i=this,s=i.configs,o=s.gid,t=e.dataGrid._undef(t,s.groupBy),n=e.dataGrid._undef(n,s.data),r=e.dataGrid._undef(r,s.groupList);s._groupList=e.dataGrid._undef(s._groupList,s.groupList);if(t===!1)return i;var u=i.getColumns(),a=!1;for(var f=0;f<u.length;f++)if(u[f]["field"]==t){a=t;break}if(a===!1)return s.groupBy=a,i;t=a,s.groupBy=t;var l=[];if(s._groupList===!1){r=[];for(var f=0;f<n.length;f++)e.inArray(n[f][t],r)===-1&&r.push(n[f][t])}s.groupList=r;for(var c=0;c<r.length;c++){var h=[];for(var p=0;p<n.length;p++)n[p][t]==r[c]&&(n[p]._groupid_=c,h.push(n[p]));l[c]=h,h=[]}s._groupListData=l,n=[];for(var d in l)for(var v=0;v<l[d].length;v++)n.push(l[d][v]);return s.data=n,i},searchData:function(t,n,r,i){var s=this,o=s.configs,u=o.gid,t=e.dataGrid._undef(t,null);if(t==null)return s;var n=e.dataGrid._undef(n,!1),a=s.getColumns();if(n!==!1){var f=!1;for(var l=0;l<a.length;l++)if(a[l]["field"]==n){f=n;break}n=f}var r=e.dataGrid._undef(r,!0);o.cacheData.searchAsync=r;if(r){var i=e.dataGrid._undef(i,o.cacheData.searchData||o.cacheData.source||o.data);o.cacheData["searched"]!=1&&(o.cacheData.searchData=o.cacheData.searchData||i,o.cacheData._url=o.url,o.cacheData._pageNumber=o.pageNumber,o.cacheData._data=o.data,o.url="",o.pageNumber=1);var c=[];for(var l=0;l<i.length;l++)if(n!==!1)i[l][n].toString().indexOf(t)!=-1&&c.push(i[l]);else for(var h=0;h<a.length;h++)if(i[l][a[h]["field"]].toString().indexOf(t)!=-1){c.push(i[l]);break}s.setGridData(c,!0),s.showGrid(function(){s.fireEvent("onSearch",s,[c]),s.setGridBody()},e.noop,!0)}else o.cacheData["searched"]!=1&&(o.cacheData._pageNumber=o.pageNumber,o.pageNumber=1),o.queryParams.searchText=t,o.queryParams.searchField=n,s.showGrid(function(){s.fireEvent("onSearch",s,[o.data]),s.setGridBody()});return o.cacheData.searched=!0,s},clearSearch:function(){var e=this,t=e.configs,n=t.gid;if(t.cacheData.searched!==!0)return e;t.cacheData.searched=!1,e.setGridData(t.cacheData.searchData),t.url=t.cacheData._url||t.url,t.pageNumber=t.cacheData._pageNumber||t.pageNumber,t.data=t.cacheData._data||t.data;try{delete t.cacheData._url}catch(r){}try{delete t.cacheData._pageNumber}catch(r){}try{delete t.cacheData.searchData}catch(r){}try{delete t.cacheData._data}catch(r){}try{delete t.queryParams.searchText}catch(r){}try{delete t.queryParams.searchField}catch(r){}return t.cacheData.searchAsync||delete t.cacheData.source,t.cacheData.searchAsync?e.refreshDataCache():e.refreshData(),delete t.cacheData.searchAsync,e},onOverRow:function(t){var n=this,r=n.configs,i=r.gid,s=e(i).find("tr[datagrid-row-index='"+t+"']");s.addClass("datagrid-row-over")},onOutRow:function(t){var n=this,r=n.configs,i=r.gid,s=e(i).find("tr[datagrid-row-index='"+t+"']");s.removeClass("datagrid-row-over")},setGridBodyTextLimit:function(t,n){var r=this,i=r.configs,s=i.gid,o=s;if(!i.textLimit)return!1;if(typeof t=="undefined"){var n=i.data,u=r.getColumns();for(var a in u){if(u[a].textLimit===!1)continue;var f=e(o).find(".datagrid-view2 .datagrid-body td[field='"+u[a].field+"']");f.each(function(t){var n=e(this).parent().attr("datagrid-row-index"),i=r.getRowData(n),s=e(this).find("div.datagrid-cell").html();typeof i[u[a]["field"]]=="undefined"&&r.setRowData(n,u[a].field,s),s=i[u[a].field];var o=e(this).find("div.datagrid-cell").width(),f=e(this).find("div.datagrid-cell").css("fontSize"),l=s;l=r.textLimit(l,o,f),e(this).find("div.datagrid-cell").html(l)})}}else if(arguments.length==2){var l=t,u=r.getColumns(),c=[],h=l.attr("datagrid-row-index"),n=n,p="";for(var a in u){if(u[a].textLimit===!1)continue;p=e.dataGrid._undef(n[u[a].field],"");if(p=="")continue;var d=l.find("> td[field='"+u[a].field+"'] div.datagrid-cell"),v=d.width(),m=d.css("fontSize"),g=p;g=r.textLimit(g,v,m),d.html(g)}}else{var y=r.getColumnData(t,"textLimit");if(y){var f=e(o).find(".datagrid-row td[field='"+t+"']");f.each(function(n){var i=e(this).parent().attr("datagrid-row-index"),s=r.getRowData(i),o=e(this).find("div.datagrid-cell").html();typeof s[t]=="undefined"&&r.setRowData(i,t,o),o=s[t];var u=e(this).find("div.datagrid-cell").width(),a=e(this).find("div.datagrid-cell").css("fontSize"),f=o;f=r.textLimit(f,u,a),e(this).find("div.datagrid-cell").html(f)})}}},bindRowEvent:function(t,n){var r=this,i=r.configs,s=i.data,o=i.gid;typeof t=="undefined"&&(t=!1),typeof n=="undefined"&&(n=!1);var u=r.getColumns();if(t)var a=t.attr("datagrid-row-index"),f=r.getRowData(a);else if(n)var a=n.attr("datagrid-row-index"),f=r.getRowData(a);t&&(t.click(function(t){var n=r.fireEvent("onClickRow",r,[this,a,f]);if(n===!1)return!1;var s=e(this).attr("datagrid-row-select"),o=r.getSlectRows();s=="1"?i.singleSelect?o.length==1&&o[0]!=a&&r.unselectRow(a):r.unselectRow(a):r.selectRow(a)}),t.hover(function(){r.fireEvent("onOverRow",r,[a])},function(){r.fireEvent("onOutRow",r,[a])}),t.dblclick(function(){var e=r.fireEvent("onDblClickRow",r,[this,a,f]);if(e==0)return!1}),t.find("> td div.datagrid-cell").click(function(){var t=e(this).parent("td").attr("field"),n=r.getFieldValue(a,t),i=r.fireEvent("onClickCell",r,[this,a,t,n]);if(i==0)return!1}),t.find("> td div.datagrid-cell").dblclick(function(){var t=e(this).parent("td").attr("field"),n=r.getFieldValue(a,t),i=r.fireEvent("onDblClickCell",r,[this,a,t,n]);if(i==0)return!1}),t.bind("contextmenu",function(e){var t=r.fireEvent("onRowContextMenu",r,[this,a,f]);if(t==0)return!1}));if(t){var l=[];for(var c in u){l=u[c];if(!e.isFunction(l.callBack)||l["callBack"]==i.noop)continue;var h=t.find("> td[field='"+l.field+"'] > div.datagrid-cell");l.callBack.call(r,h,a,l,f)}e.isFunction(i.rowCallBack)&&i.rowCallBack!=e.noop&&(i.rowCallBack.call(r,t,a,f),i.gbody.find("tr.datagrid-row").each(function(t){var n=e(this).attr("datagrid-row-index"),s=r.getRowData(n);if(e.isFunction(i.rowStyler)){var o=r.rowStyler.call(this,n,s);o&&e(this).addClass(o)}else e(this).addClass(i.rowStyler)}));if(i.rowStyler)if(e.isFunction(i.rowStyler)){var p=r.rowStyler.call(r,t,a,f);typeof p=="string"&&t.addClass(p)}else typeof i.rowStyler=="string"&&t.addClass(i.rowStyler)}n&&(n.click(function(){var t=a;r.fireEvent("onClickRowNumber",r,[t]),i.rowNumbers2Row!==!1&&e("#"+i.id+"-row-"+t).click()}),n.hover(function(){r.fireEvent("onOverRow",r,[a])},function(){r.fireEvent("onOutRow",r,[a])})),t&&r.setGridBodyTextLimit(t,f)},setRow:function(t,n){var r=this,i=r.configs,s=i.data,o=i.gid,u=r.getColumns(),a=r.getTpl("view1_row"),f=i.rowTpl?i.rowTpl:r.getTpl("view2_row"),l={},c=e("#view2-datagrid-body-btable-tbody-"+i.id),h=e("#view1-datagrid-body-btable-tbody-"+i.id),n=e.dataGrid._undef(n,e.noop),t=e.dataGrid._undef(t,0);t||(c.html(""),h.html(""));var p=i._lSize,d=1;for(var v=t;v<s.length;v++){if(d>p){setTimeout(function(){r.setRow(v,n)},i._lTime);break}d++,l={i:v,id:i.id,fields:u,rowNumbersExpand:i.rowNumbersExpand?i.rowNumbersExpand:!1,data:s[v],isCreate:i.isCreate,groupBy:i.groupBy,rowNumbersWidth:i.rowNumbersWidth,opt:i};var m=e(r.tpl(f,l));e(c).append(m);var g=!1;i.rowNumbersWidth!==!1&&(g=e(r.tpl(a,l)),e(h).append(g)),r.bindRowEvent(m,g)}v>=s.length?(n(),r.afterGridShow()):r.fireEvent("onShowGriding",r,[v,s])},onBeforeShowGrid:function(){var e=this,t=e.configs,n=t.gid;if(t.lockColumns.length)for(var r in t.lockColumns)if(t.lockColumns[r]!=null){e.setGridHeader();return}if(t.lockRows.length)for(var r in t.lockRows)if(t.lockRows[r]!=null){e.setGridHeader();return}},setGridBody:function(t,n){var r=this,i=r.configs,s=i.gid;r.showLoading();var t=t||s+" .datagrid-view2",o=e("#view2_"+i.id),u=r.getColumns(),n=n||e.noop;r.groupByField();var a=i.data;r.fireEvent("onBeforeShowGrid",r,[]),r.fireEvent("onViewSizeChange",r,[]),r.setPager();var f=i.sLeft,l=i.sTop;return r.setRow(0,function(){n(),i.sLeft=f,i.sTop=l}),r.hideLoading(),!0},afterGridShow:function(){var e=this,t=e.configs,n=t.gid;e.onFinishDone=e.onFinishDone||!1,e.onFinishDone||(e.onFinishDone=!0,e.fireEvent("onFinish",e)),e.addGroupRow(!0),e.fireEvent("onScroll",e,[!0]),e.methodCall("setGridBody"),e.fireEvent("onViewSizeChange",e,[]),e.fireEvent("onShowGrid",e,[])},setGridFooter:function(){var e=this,t=e.configs,n=t.gid;return!0},onScroll:function(t){var n=this,r=n.configs,i=r.gid,s=s||i+" .datagrid-view2",o=i+" .datagrid-view1";t=e.dataGrid._undef(t,!1),t&&(r.gbody.scrollLeft(r.sLeft),r.gbody.scrollTop(r.sTop)),r.sLeft=r.gbody._scrollLeft(),r.sTop=r.gbody._scrollTop(),e("#view2-datagrid-header-inner-"+r.id).find(">.datagrid-header-inner-wraper")._scrollLeft(r.sLeft),e("#view2-datagrid-header-outer-"+r.id).find(">.datagrid-header-outer-wraper")._scrollLeft(r.sLeft),e("#view1-datagrid-body-"+r.id)._scrollTop(r.sTop)},showGrid:function(t,n,r){var i=this,s=i.configs,o=s.gid,u=u||o+" .datagrid-view2",t=t||e.noop,n=n||e.noop,r=e.dataGrid._undef(r,!1);i.getGridData(function(){i.fireEvent("onGetData",i,[s.data]),t.apply(this,arguments)},function(){n.apply(this,arguments)},r)},refreshData:function(){var e=this.configs.events,t=this,n=t.configs,r=n.gid,i=i||r+" .datagrid-view2";t.fireEvent("onBeforeRefresh",t),t.showGrid(function(){t.setGridBody(i,function(){t.fireEvent("onRefresh",t)})})},refreshDataCache:function(){var e=this.configs.events,t=this;t.setGridBody()},clearCache:function(){var e=this.configs;e.views=[],e.isCreate=!1,this.onFinishDone=!1,e.isShow=!1,e.pki=0},clearDataCache:function(t){var n=this.configs,r=n.cacheData;n.cacheData=[];var t=e.dataGrid._undef(t,!1);return t||(n.cacheData.source=r.source,n.cacheData.columns=r.columns),this},reLoadGrid:function(t,n){var r=this.configs,n=e.dataGrid._undef(n,!1);this.clearCache(n),e.extend(r,t),e.dataGrid.call(this,r)},setWH:function(e,t){var n=this;return n.fireEvent("onSizeChange",n,[e,t]),n},C:function(e,t){return typeof e=="undefined"?this.configs:typeof t=="undefined"?this.configs[e]:(this.configs[e]=t,this)},createGrid:function(e){var t=this,n=t.configs,r=n.gid,e=e||r+" .datagrid-view2";return t.setGridHeader(e),t.showGrid(function(){t.setGridBody(e)}),t.setGridFooter(e),t.methodCall("createGrid"),t},sortData:function(t,n,r){var i=this,s=i.configs,o=s.gid,t=e.dataGrid._undef(t,s.sortName);if(t=="")return i;var u=i.getColumns(),a=!1;for(var f=0;f<u.length;f++)if(u[f]["field"]==t){a=t;break}if(a===!1)return i;s.cacheData.source=s.cacheData.source||s.data;var n=e.dataGrid._undef(n,s.cacheData.source),r=e.dataGrid._undef(r,s.sortOrder),l=r=="asc"?!0:!1;return n.sort(function(n,r){return n[t]=e.dataGrid._undef(n[t],""),r[t]=e.dataGrid._undef(r[t],""),n[t]>=r[t]?l?1:-1:l?-1:1}),n},onDataChange:function(e){var t=this,n=t.configs;t.refreshData()},addData:function(t){var n=this,r=n.configs,i=n.getAsync();t=e.dataGrid._undef(t,{}),t=e.isPlainObject(t)?t:{};var s=r.pk;if(i){t[s]=e.dataGrid._undef(t[s],n.unique());var o=n.getData();o.push(t),n.fireEvent("onAdd",n,[t,!0]),n.fireEvent("onDataChange",n,[o])}else n.fireEvent("onAjaxAdd",n,[t,n.onDataChange])},updateData:function(t){var n=this,r=n.configs,i=n.getAsync();t=e.dataGrid._undef(t,{}),t=e.isPlainObject(t)?t:{};var s=r.pk,o=!1;if(i){o=e.dataGrid._undef(t[s],!1);if(o===!1){n.fireEvent("onUpdate",n,[t,!1]);return}var u=n.getData();for(var a in u)if(u[a][s]==t[s]){u[a]=t;break}n.fireEvent("onUpdate",n,[t,!0]),n.fireEvent("onDataChange",n,[u])}else n.fireEvent("onAjaxUpdate",n,[t,n.onDataChange])},deleteData:function(t){var n=this,r=n.configs,i=n.getAsync();t=e.dataGrid._undef(t,{}),t=e.isPlainObject(t)?t:{};var s=r.pk,o=!1;if(i){o=e.dataGrid._undef(t[s],!1);if(o===!1){n.fireEvent("onDelete",n,[t,!1]);return}var u=n.getData();for(var a in u)if(u[a][s]==t[s])break;var f=[];for(var l in u){if(a==l)continue;f.push(u[l])}r.cacheData.source=f,n.fireEvent("onDelete",n,[t,!0]),n.fireEvent("onDataChange",n,[f])}else n.fireEvent("onAjaxDelete",n,[t,n.onDataChange])},getAsync:function(){var e=this,t=e.configs,n=t.gid;return t.url==""||t.url===!1?!0:!1},setGridData:function(t,n,r){var i=this,s=i.configs,o=s.gid,n=e.dataGrid._undef(n,!1),r=e.dataGrid._undef(r,!1);n==0&&(n=i.getAsync()),n?s.cacheData.source=t:s.data=t,s.pk=="_pk"&&(s.pk="",i.fireEvent("onSetPk",i,[t])),r&&(n?i.showGrid(function(){i.setGridBody()},e.noop,!0):i.refreshDataCache())},getGridData:function(t,n,r){var i=this,s=i.configs,o=s.gid,t=t||e.noop,n=n||e.noop,u=o+" .datagrid-view2",r=e.dataGrid._undef(r,!1);r==0&&(r=i.getAsync()),i.methodCall("getGridData");if(r){s.cacheData.source=s.cacheData.source||s.data,i.fireEvent("onSetPk",i,[s.cacheData.source]),s.sortName!=""&&(s.cacheData.source=i.sortData()),s.total=s.cacheData.source.length;var a=(s.pageNumber-1)*s.pageSize,f=s.pageSize*s.pageNumber;f=f>s.total?s.total:f;var l=[];for(var c=a;c<f;c++)l.push(s.cacheData.source[c]);s.data=l,t.call(i,u);return}s.queryParams.pageNumber=s.pageNumber,s.queryParams.pageSize=s.pageSize,s.sortName!=""&&(s.queryParams.sortName=s.sortName,s.queryParams.sortOrder=s.sortOrder);var h=i.configs.events;e.ajax({url:s.url,type:s.method,cache:s.cache,dataType:s.dataType,data:s.queryParams,beforeSend:function(){i.fireEvent("onBeforeLoad",i,[]),i.showLoading()},success:function(e){i.hideLoading(),s.data=e.rows,s.total=e.total,e.columns&&(s.columns=e.columns,i.setGridHeader()),i.fireEvent("onLoadSuccess",i,[e]),t.call(i,u)},error:function(e){i.fireEvent("onLoadError",i,[e.responseText]),n.call(i,e.responseText),i.showLoading(e.responseText),setTimeout(function(){i.hideLoading()},2e3)}})},setPk:function(t){var n=this,r=n.configs;if(r.pk!="")return;r.pki=1,r.pk="_pk",e.each(t,function(e,n){t[e][r.pk]=r.pki++})},show:function(){var t=this,n=t.configs,r=n.views,i=e("#"+n.id);if(n.isShow)return;n.isShow=!0;for(var s in r)i.append(r[s]);t.setGrid(),t.setView(),t.createGrid(),t.methodCall("show")}}),e.fn._scrollLeft=function(t){return t==undefined?this.scrollLeft():this.each(function(){e(this).css("marginLeft",t*-1)})},e.fn._scrollTop=function(t){return t==undefined?this.scrollTop():this.each(function(){e(this).css("marginTop",t*-1)})},e.fn.datagrid=function(t){if(this.size()<=0||this.size()>1)return alert("容器不正确"),!1;var n=this,t=t||{};t.selector=n.selector,t.helper=n,t.width=e.dataGrid._undef(t.width,n.width()),t.height=e.dataGrid._undef(t.height,n.height());var r=new e.dataGrid(t);return n.data("datagrid",r),r},e.fn._resize=function(t){function r(t,n){e(document.body).css("cursor","col-resize"),e(document.body).css("-moz-user-select","none"),e(document.body).attr("unselectable","on"),n.gheader.find(".datagrid-header-inner").css("cursor","col-resize"),n.gheader.find("div.datagrid-cell").css("cursor","col-resize");var r=e("<div class='datagrid-resize'></div>"),o="#view_"+n.id;e(o).append(r);var u=e(this).offset().left-e(o).offset().left,a=e(o).height(),f=e(this).width();u=parseInt(u)+parseInt(f),r.css({position:"absolute",borderLeft:"1px solid #aac5e7",top:0,zIndex:9999,height:parseInt(a),left:u}),n.line=r,n.x=t.clientX,n.left=u,n.offsetX=0,e(document.body).bind("selectstart",function(e){return!1}),e(document).bind("mousemove",function(e){var t=n.self.fireEvent("onResizeColumn",n.self,[e,n]);if(t===!1)return;i(e,n)}),e(document).bind("mouseup",function(e){var t=n.stop(e,n);s(e,n)})}function i(e,t){var n=e.clientX,r=t.left+(n-t.x);t.offsetX=n-t.x,t.line.css({left:r})}function s(t,n){var r="#view_"+n.id;e(document).unbind("mousemove"),e(document).unbind("mouseup"),e(document.body).unbind("selectstart"),e(document.body).css("cursor","default"),e(document.body).removeAttr("unselectable"),n.gheader.find(".datagrid-header-inner").css("cursor","default"),n.gheader.find("div.datagrid-cell").css("cursor","default"),e(n.line).remove()}var t=t||{},t=e.extend({},t),n=this;n.each(function(n){e("<div class='datagrid_resize'></div>").appendTo(e(this).parent()).bind("mousedown",function(n){t.field=e(this).parent().attr("field");var i=t.self.fireEvent("onResizeColumnStart",t.self,[n,this,t]);if(i===!1)return;r.call(this,n,t)})})}})(jQuery)