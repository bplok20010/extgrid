//extgrid.v.1.2.5  
//http://www.extgrid.com
//author:nobo
//qq:505931977
//QQ交流群:13197510
//email:zere.nobo@gmail.com or QQ邮箱

/*!artTemplate - Template Engine*/var template=function(a,b){return template["object"==typeof b?"render":"compile"].apply(template,arguments)};(function(a,b){"use strict";a.version="2.0.1",a.openTag="<%",a.closeTag="%>",a.isEscape=!0,a.isCompress=!1,a.parser=null,a.render=function(a,b){var c=d(a);return void 0===c?e({id:a,name:"Render Error",message:"No Template"}):c(b)},a.compile=function(b,d){function l(c){try{return new j(c)+""}catch(f){return h?(f.id=b||d,f.name="Render Error",f.source=d,e(f)):a.compile(b,d,!0)(c)}}var g=arguments,h=g[2],i="anonymous";"string"!=typeof d&&(h=g[1],d=g[0],b=i);try{var j=f(d,h)}catch(k){return k.id=b||d,k.name="Syntax Error",e(k)}return l.prototype=j.prototype,l.toString=function(){return""+j},b!==i&&(c[b]=l),l},a.helper=function(b,c){a.prototype[b]=c},a.onerror=function(a){var c="[template]:\n"+a.id+"\n\n[name]:\n"+a.name;a.message&&(c+="\n\n[message]:\n"+a.message),a.line&&(c+="\n\n[line]:\n"+a.line,c+="\n\n[source]:\n"+a.source.split(/\n/)[a.line-1].replace(/^[\s\t]+/,"")),a.temp&&(c+="\n\n[temp]:\n"+a.temp),b.console&&console.error(c)};var c={},d=function(d){var e=c[d];if(void 0===e&&"document"in b){var f=document.getElementById(d);if(f){var g=f.value||f.innerHTML;return a.compile(d,g.replace(/^\s*|\s*$/g,""))}}else if(c.hasOwnProperty(d))return e},e=function(b){function c(){return c+""}return a.onerror(b),c.toString=function(){return"{Template Error}"},c},f=function(){a.prototype={$render:a.render,$escape:function(a){return"string"==typeof a?a.replace(/&(?![\w#]+;)|[<>"']/g,function(a){return{"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"}[a]}):a},$string:function(a){return"string"==typeof a||"number"==typeof a?a:"function"==typeof a?a():""}};var b=Array.prototype.forEach||function(a,b){for(var c=this.length>>>0,d=0;c>d;d++)d in this&&a.call(b,this[d],d,this)},c=function(a,c){b.call(a,c)},d="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",e=/\/\*(?:.|\n)*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|'[^']*'|"[^"]*"|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,f=/[^\w$]+/g,g=RegExp(["\\b"+d.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),h=/\b\d[^,]*/g,i=/^,+|,+$/g,j=function(a){return a=a.replace(e,"").replace(f,",").replace(g,"").replace(h,"").replace(i,""),a=a?a.split(/,+/):[]};return function(b,d){function w(b){return k+=b.split(/\n/).length-1,a.isCompress&&(b=b.replace(/[\n\r\t\s]+/g," ")),b=b.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n"),b=q[1]+"'"+b+"'"+q[2],b+"\n"}function x(b){var c=k;if(g?b=g(b):d&&(b=b.replace(/\n/g,function(){return k++,"$line="+k+";"})),0===b.indexOf("=")){var e=0!==b.indexOf("==");if(b=b.replace(/^=*|[\s;]*$/g,""),e&&a.isEscape){var f=b.replace(/\s*\([^\)]+\)/,"");m.hasOwnProperty(f)||/^(include|print)$/.test(f)||(b="$escape($string("+b+"))")}else b="$string("+b+")";b=q[1]+b+q[2]}return d&&(b="$line="+c+";"+b),y(b),b+"\n"}function y(a){a=j(a),c(a,function(a){l.hasOwnProperty(a)||(z(a),l[a]=!0)})}function z(a){var b;"print"===a?b=s:"include"===a?(n.$render=m.$render,b=t):(b="$data."+a,m.hasOwnProperty(a)&&(n[a]=m[a],b=0===a.indexOf("$")?"$helpers."+a:b+"===undefined?$helpers."+a+":"+b)),o+=a+"="+b+","}var e=a.openTag,f=a.closeTag,g=a.parser,h=b,i="",k=1,l={$data:!0,$helpers:!0,$out:!0,$line:!0},m=a.prototype,n={},o="var $helpers=this,"+(d?"$line=0,":""),p="".trim,q=p?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],r=p?"if(content!==undefined){$out+=content;return content}":"$out.push(content);",s="function(content){"+r+"}",t="function(id,data){if(data===undefined){data=$data}var content=$helpers.$render(id,data);"+r+"}";c(h.split(e),function(a){a=a.split(f);var c=a[0],d=a[1];1===a.length?i+=w(c):(i+=x(c),d&&(i+=w(d)))}),h=i,d&&(h="try{"+h+"}catch(e){"+"e.line=$line;"+"throw e"+"}"),h="'use strict';"+o+q[0]+h+"return new String("+q[3]+")";try{var u=Function("$data",h);return u.prototype=n,u}catch(v){throw v.temp="function anonymous($data) {"+h+"}",v}}}()})(template,this),"function"==typeof define?define(function(a,b,c){c.exports=template}):"undefined"!=typeof exports&&(module.exports=template);
//extgrid.v.1.2.5  
(function($){"use strict";$.dataGrid=function(e){this.init(e)},$.extGrid=$.dataGrid,$.dataGrid.fn={},$.dataGrid.fn.extend=function(e){$.extend($.dataGrid.prototype,e)},$.dataGrid.extend=function(e){$.extend($.dataGrid,e)},$.dataGrid.extend({version:"1.2.5",padding:8,puglins:[],getDefaults:function(e){var t={self:null,init:$.noop,title:"",iconCls:"",toolBars:!1,_toolItem:{text:"",cls:"",callBack:$.noop,disabled:!1},ltText:"",rowNumbersWidth:"0px",rowNumbersExpand:!1,rowNumbers2Row:!0,rowTpl:"",showHeader:!0,headerTpl:"",containerCss:"datagrid-container-border",border:!0,leftBorder:1,rightBorder:1,topBorder:1,bottomBorder:1,padding:$.dataGrid.padding,width:700,height:250,checkBox:!1,checkBoxWidth:"28px",checkBoxTitle:'<input type="checkbox">',checkBoxFit:!1,editColumn:!1,editColumnTitle:"操作",editColumnFit:!0,editCellW:63,columns:[],moveColumnTm:500,moveColumns:!0,_columnMetaData:{field:"",index:"",title:"",width:"120px",minWidth:20,align:"left",_expand:!1,callBack:$.noop,hcls:"",bcls:"",fcls:"",sortable:!1,textLimit:!1,fitColumn:!0,disabled:!1},textLimit:!1,textLimitDef:"...",groupBy:!1,groupList:!1,groupListCallBack:$.noop,_groupListData:[],autoScrollToField:!0,autoScrollToRow:!0,scrollbarSize:!1,sTop:0,sLeft:0,_lTime:0,_lStart:0,_lSize:0,fitColumns:!0,data:[],emptyGridMsg:"",showEmptyGridMsg:!0,pk:"_pk",lockRows:[],lockColumns:[],hideColumns:[],selectRows:[],isCreate:!1,isShow:!1,views:{},method:"post",url:"",loadMsg:"加载中,请稍后...",cache:!0,cacheData:[],pagination:!1,pagerToolBar:!1,pagerMsg:"当前显示 {start} 到 {end} 条，共 {total} 条",pageNumber:1,pageSize:10,dataType:"json",pageList:[10,20,30,40,50],queryParams:{},singleSelect:!1,sortName:"",sortOrder:"asc",rowStyler:"",rowCallBack:$.noop,tpl:{},methodCall:{},template:template,isEscape:!1,noop:$.noop,denyRowEvents:!1,events:{onStart:$.noop,onViewCreate:$.noop,onFinish:$.noop,onBeforeLoad:$.noop,onLoadSuccess:$.noop,onLoadError:$.noop,onClickRow:$.noop,onColumnOver:$.noop,onColumnOut:$.noop,onOverCell:$.noop,onOutCell:$.noop,onOverRow:$.noop,onOutRow:$.noop,onDblClickRow:$.noop,onClickCell:$.noop,onDblClickCell:$.noop,onSortColumn:$.noop,onResizeColumnStart:$.noop,onResizeColumn:$.noop,onResizeColumnStop:$.noop,onAfterResize:$.noop,onSelect:$.noop,onUnselect:$.noop,onSelectAll:$.noop,onUnselectAll:$.noop,onHeaderContextMenu:$.noop,onHeaderCreate:$.noop,onToolBarCreate:$.noop,onRowContextMenu:$.noop,onCellContextMenu:$.noop,onBeforeRefresh:$.noop,onRefresh:$.noop,onChangePageSize:$.noop,onShowGriding:$.noop,onShowGrid:$.noop,onBeforeShowGrid:$.noop,onGetData:$.noop,onPagerCreate:$.noop,onSelectPage:$.noop,onClickRowNumber:$.noop,onSearch:$.noop,onExpandRow:$.noop,onLockColumn:$.noop,onBeforeLockColumn:$.noop,onAfterLockColumn:$.noop,onAfterUnLockColumn:$.noop,onLockRow:$.noop,onBeforeLockRow:$.noop,onAfterLockRow:$.noop,onAfterUnLockRow:$.noop,onBeforeUnlockColumn:$.noop,onBeforeUnlockRow:$.noop,onViewSizeChange:$.noop,onSizeChange:$.noop,onScroll:$.noop,onDataChange:$.noop,onCellEdit:$.noop,onBeforeAddRow:$.noop,onAfterAddRow:$.noop,onBeforeUpdateRow:$.noop,onAfterUpdateRow:$.noop,onBeforeDeleteRow:$.noop,onAfterDeleteRow:$.noop,onAdd:$.noop,onUpdate:$.noop,onDelete:$.noop,onAjaxAdd:$.noop,onAjaxUpdate:$.noop,onAjaxDelete:$.noop,onColumnMove:$.noop,onColumnMoving:$.noop,onColumnValueChange:$.noop}};return $.extend(t,e)},getToGridOptions:function(e){var t={options_from:"data-options",columns_from:"thead th",data_from:"tbody tr"};return $.extend(!0,t,e)},_undef:function(e,t){return e===undefined?t:e},_Tpl:{container:'<div class="datagrid-container <%=(border?containerCss:"")%>" id="<%=id%>" style=" position:relative; overflow:hidden; width:<%=width%>px; height:<%=height%>px;"></div>',title:'<div class="datagrid-title <%=iconCls%>" id="title_<%=id%>"><%=title%></div>',toolbar:'<div class="datagrid-toolbar" id="toolbar_<%=id%>"></div>',grid:'<div class="datagrid-view" id="view_<%=id%>" style="width:<%=width%>px; height:0px;"></div>',group_row:'<tr id="<%=id%>-group-row-<%=gid%>"  datagrid-group-row-id="<%=gid%>" class="datagrid-group-row"><td style="width:<%=w%>px" colspan="<%=colspan%>"><div  class="datagrid-group-cell"><%=html%>(<%=num%>)</div></td></tr>',view1:'<div class="datagrid-view1" id="view1_<%=id%>" style="width:<%=parseFloat(rowNumbersWidth)%>px;height:100%;"><div  class="datagrid-header" id="view1-datagrid-header-<%=id%>" style="width: 100%; z-index:40; position:relative;"><div class="datagrid-header-inner" id="view1-datagrid-header-inner-<%=id%>"><div class="datagrid-header-inner-wraper" id="datagrid-view1-header-inner-wraper-<%=id%>"><table class="datagrid-htable" id="view1-datagrid-header-inner-htable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-inner-htable-tbody-<%=id%>"><tr class="datagrid-header-row"><td align="center" class="datagrid-td-rownumber" style=""><div class="datagrid-header-rownumber" style="width:<%=parseFloat(rowNumbersWidth)%>px;"></div></td></tr></tbody></table></div></div><div class="datagrid-header-outer" id="view1-datagrid-header-outer-<%=id%>"><div class="datagrid-header-outer-wraper" id="datagrid-view1-header-outer-wraper-<%=id%>"><table class="datagrid-locktable" id="view1-datagrid-header-outer-locktable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-outer-locktable-tbody-<%=id%>"></tbody></table></div></div></div><div class="datagrid-body-wrap" id="view1-datagrid-body-wrap-<%=id%>" style="width: 100%; height:0px; overflow:hidden;zoom:1; "><div class="datagrid-body" id="view1-datagrid-body-<%=id%>" style="width: 100%;float:left;z-index:30;position:relative;"><table class="datagrid-btable" id="view1-datagrid-body-btable-<%=id%>" cellspacing="0" cellpadding="0" border="0"><tbody id="view1-datagrid-body-btable-tbody-<%=id%>"></tbody></table></div></div><div class="datagrid-footer" id="view1-datagrid-footer-<%=id%>" style="width: 100%; height:0px; overflow:hidden;position:relative;z-index:31;"></div></div>',view2:'<div class="datagrid-view2" id="view2_<%=id%>" style="width:0px;height:100%;"><div  class="datagrid-header" id="view2-datagrid-header-<%=id%>" style="width: 100%;"><div class="datagrid-header-inner" id="view2-datagrid-header-inner-<%=id%>"><div class="datagrid-header-inner-wraper" id="datagrid-view2-header-inner-wraper-<%=id%>"><table class="datagrid-htable" id="view2-datagrid-header-inner-htable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-inner-htable-tbody-<%=id%>"></tbody></table></div></div><div class="datagrid-header-outer" id="view2-datagrid-header-outer-<%=id%>"><div class="datagrid-header-outer-wraper" id="datagrid-view2-header-outer-wraper-<%=id%>"><table class="datagrid-locktable" id="view2-datagrid-header-outer-locktable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-outer-locktable-tbody-<%=id%>"></tbody></table></div></div></div><div class="datagrid-body" id="view2-datagrid-body-<%=id%>" style="width: 100%;height:0px;"><table class="datagrid-btable" id="view2-datagrid-body-btable-<%=id%>" cellspacing="0" cellpadding="0" border="0"><tbody id="view2-datagrid-body-btable-tbody-<%=id%>"></tbody></table></div><div class="datagrid-footer" id="view2-datagrid-footer-<%=id%>" style="width: 100%; height:0px; overflow:hidden;"></div></div>',pager:'<div class="datagrid-pager pagination" id="<%=id%>_pager"> <table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><select class="pagination-page-list"><% var s = ""; for(var i=0;i<pageList.length;i++) {%><% if(pageList[i] == pageSize) {%><% s="selected";%><% } else {s="";} %><option value="<%=pageList[i]%>" <%=s%> ><%=pageList[i]%></option><% } %></select></td><td><div class="pagination-btn-separator"></div></td><td><a href="javascript:void(0)" class="pagination-first-btn p-plain <%=(pageNumber <= 1 )?"p-btn-disabled":""%>"><span class="pagination-first  p-btn">&nbsp;</span></a></td><td><a href="javascript:void(0)" class="pagination-prev-btn p-plain <%=(pageNumber <= 1 )?"p-btn-disabled":""%>"><span class="pagination-prev  p-btn">&nbsp;</span></a></td><td><div class="pagination-btn-separator"></div></td><td><span style="padding-left:6px;">第</span></td><td><input class="pagination-num" type="text" value="<%=pageNumber%>" size="2"></td><td><span style="padding-right:6px;">页 共 <%=pages%> 页</span></td><td><div class="pagination-btn-separator"></div></td><td><a href="javascript:void(0)" class="pagination-next-btn p-plain <%=(pageNumber >= pages)?"p-btn-disabled":""%>"><span class="pagination-next p-btn">&nbsp;</span></a></td><td><a href="javascript:void(0)" class="pagination-last-btn p-plain <%=(pageNumber >= pages)?"p-btn-disabled":""%>"><span class="pagination-last p-btn ">&nbsp;</span></a></td><td><div class="pagination-btn-separator"></div></td><td><a href="javascript:void(0)" class="pagination-load-btn p-plain"><span class="pagination-load p-btn">&nbsp;</span></a></td><td id="pagination-toolbar-<%=id%>"></td></tr></tbody></table><div class="pagination-info"><%=pagerMsg%></div><div style="clear:both;"></div></div>',view1_header_inner_row:'<tr class="datagrid-header-row"><td align="center" class="datagrid-td-rownumber" style=""><div class="datagrid-header-rownumber" style="width:<%=parseFloat(rowNumbersWidth)%>px;"><%=ltText%></div></td></tr>',view1_header_outer_row:"",view2_header_inner_row:'<tr class="datagrid-header-row"><% var i=0;len = fields.length;  for(;i<len;i++) {%><td field="<%=fields[i]["field"]%>" align="<%=fields[i]["align"]%>"><div class="datagrid-header-wrap" field="<%=fields[i]["field"]%>" ><div class="datagrid-cell datagrid-cell-<%=fields[i]["field"]%> datagrid-cell-header-<%=fields[i]["field"]%> <%=fields[i]["hcls"]%>" ><span><%=fields[i]["title"]%></span><span class="datagrid-sort-icon">&nbsp;</span></div></div></td><% } %></tr>',view2_header_outer_row:"",view1_row:"",view2_row:""}}),$.dataGrid.fn.extend({init:function(e){var t=this;t.initEvents(e),t.configs=$.extend({},$.dataGrid.getDefaults(),e);var n=t.configs;n.self=t,n.template.isEscape=n.isEscape,n.template.helper("parseInt",parseInt),n.template.helper("parseFloat",parseFloat),n.border&&(n.width-=n.leftBorder+n.rightBorder,n.height-=n.topBorder+n.bottomBorder),n.id=n.id||t.getId(),n.gid=n.gid||"#view_"+n.id,n.rowNumbersWidth=parseFloat(n.rowNumbersWidth)>=0?n.rowNumbersWidth:!1,n.rowNumbersWidth===!1&&(n.rowNumbersWidth=n.groupBy==0?!1:"0px"),n.rowNumbersWidth===!1&&(n.rowNumbersWidth=n.lockColumns.length?"0px":!1),n.init.call(t,n),t.sysEvents(),t.fireEvent("onStart",[n]),t.setContainer().setTitle().setToolBar().setGrid().setPager(!0).show()},inArray:function(e,t){if(t){var n=t.length,r=0;for(;r<n;r++)if(r in t&&t[r]==e)return r}return-1},tpl:function(e,t){var n=this,r=n.configs;typeof e=="undefined"&&(e=""),typeof t=="undefined"&&(t={});var i={};typeof r.cacheData["_tpl_"]=="undefined"?(r.cacheData._tpl_={},i=r.cacheData._tpl_):i=r.cacheData._tpl_,template.isEscape=r.isEscape;var s="";if(e in r.tpl&&r.tpl[e])if(r.tpl[e]in i){var o=i[r.tpl[e]];s=o(t)}else{var o=r.template.compile(r.tpl[e]);i[r.tpl[e]]=o,s=o(t)}else if(e in n)s=n[e](t);else if(e in $.dataGrid._Tpl&&$.dataGrid._Tpl[e])if($.dataGrid._Tpl[e]in i){var o=i[$.dataGrid._Tpl[e]];s=o(t)}else{var o=r.template.compile($.dataGrid._Tpl[e]);i[$.dataGrid._Tpl[e]]=o,s=o(t)}else if(e.toString()in i){var o=i[e.toString()];s=o(t)}else{var o=r.template.compile(e.toString());i[e.toString()]=o,s=o(t)}return s},bind:function(e,t,n){if(typeof e=="undefined")return this;var t=t||$.noop,r=this,i=r.configs.events;i[e]=$.dataGrid._undef(i[e],[]),$.isFunction(i[e])&&(i[e]=[]);var s={scope:n?n:r,func:t},o=i[e].push(s);return o-1},unbind:function(e,t){var n=this,r=n.configs.events,t=$.dataGrid._undef(t,!1);return t===!1?r[e]=$.noop:r[e][t]=$.noop,n},fireEvent:function(e,t){var n=this,r=n.configs.events[e],t=$.dataGrid._undef(t,[]),i=!0;if($.isArray(r))for(var s=0;s<r.length;s++){var o=r[s];if($.isPlainObject(o)){i=o.func.apply(o.scope,t);if(i===!1)break}else if($.isFunction(o)){i=o.apply(n,t);if(i===!1)break}}else $.isFunction(r)&&(i=r.apply(n,t));return i},loadPuglins:function(){var e=this;$.each($.dataGrid.puglins,function(t){$.isFunction(this)&&this.call(e)})},initEvents:function(e){var t=this,n=e.events?e.events:{};if($.isPlainObject(n)&&!$.isEmptyObject(n))for(var r in n)$.isFunction(n[r])&&n[r]!==$.noop&&(n[r]=[n[r]])},sysEvents:function(){var e=this,t=e.configs;e.bind("onShowGrid",e.autoExpand),e.bind("onClickRow",e.setExpandEvent),e.bind("onUnselectAll",function(){this.checkCk(!1)}),e.bind("onSelectAll",function(){this.checkCk(!0)}),e.bind("onUnselect",function(){this.checkCk(!1)}),e.bind("onShowGrid",function(){this.checkCk(!1)}),e.bind("onViewCreate",e.onInitFieldWidth),e.bind("onLoadSuccess",e.onLoadSuccess),e.bind("onLoadError",e.onLoadError),e.bind("onSetPk",e.setPk),e.bind("onViewSizeChange",e.onViewSizeChange),e.bind("onSizeChange",e.onSizeChange),e.bind("onSizeChange",e.onFinishFieldWidth),e.bind("onShowGrid",e.resetHeader),e.bind("onShowGrid",e.onLockRow),e.bind("onShowGrid",e.onLockColumn),e.bind("onScroll",e.onScroll),e.bind("onAfterLockRow",e.onAfterLockRow),e.bind("onAfterLockColumn",e.onAfterLockColumn),e.bind("onDataChange",e.onDataChange),e.bind("onOverRow",e.onOverRow),e.bind("onOutRow",e.onOutRow),e.bind("onShowGrid",e.onDisplayField),e.bind("onViewSizeChange",e.isEmptyGrid),e.bind("onHeaderCreate",e.onHeaderCreate),e.bind("onColumnMove",e.onColumnMove),e.bind("onFinish",e.loadPuglins),e.bind("onColumnValueChange",e.onColumnValueChange),e.bind("onBeforeAddRow",e.refreshPager),e.bind("onAfterAddRow",e.checkToRow),e.bind("onAfterDeleteRow",e.refreshPager),e.bind("onSelect",e.addSelectRecode),e.bind("onUnselect",e.removeSelectRecode)},getId:function(){return"datagrid_"+Math.floor(Math.random()*99999)},unique:function(){return"unique_"+Math.floor(Math.random()*100)+"_"+Math.floor(Math.random()*1e6)},isNumber:function(e){return/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)?!0:!1},showLoading:function(e,t){var n=this,r=n.configs,e=typeof e=="undefined"?r.loadMsg:e,t="#"+r.id,i=$("#"+r.id+"_datagrid-mask-wraper");if(i.length){var s=$("#"+r.id+"_datagrid-mask-msg");s.html(e),i.show();var o=s.outerWidth(!0);return s.css("marginLeft",-o/2+"px"),n}var u=$('<div id="'+r.id+'_datagrid-mask-wraper" class="datagrid-mask-wraper"><div id="'+r.id+'_datagrid-mask" class="datagrid-mask"></div><div id="'+r.id+'_datagrid-mask-spacer" class="datagrid-mask-spacer"></div><div id="'+r.id+'_datagrid-mask-msg" class="datagrid-mask-msg" style=" left: 50%;">'+e+"</div><div>");$(t).append(u);var s=$("#"+r.id+"_datagrid-mask-msg"),o=s.outerWidth(!0);return s.css("marginLeft",-o/2+"px"),u.click(function(e){e.stopPropagation(),e.preventDefault()}),n},hideLoading:function(e){var t=this,n=t.configs;return setTimeout(function(){$("#"+n.id+"_datagrid-mask-wraper").hide()},0),t},methodCall:function(e){var e=e||"",t=this,n=t.configs;return e!=""&&e in n.methodCall&&$.isFunction(n.methodCall[e])&&n.methodCall[e].call(t),t},getColumnData:function(e,t,n){var r=this,i=r.configs,e=$.dataGrid._undef(e,!1),t=$.dataGrid._undef(t,!1);if(e===!1)return r;var s=i.columns,o=0,u=s.length;for(;o<u;o++)if(s[o]["field"]==e)return t===!1?s[o]:typeof n=="undefined"?s[o][t]:(s[o][t]=n,i.columns=s,r.fireEvent("onColumnValueChange",[s[o],t,n]),r);return null},setColumnData:function(e,t,n){var r=this;return r.getColumnData(e,t,n)},onColumnValueChange:function(e,t,n){var r=this,i=r.configs;switch(t){case"width":r.setFieldWidth(e.field,n);break;case"title":$(".datagrid-cell-header-"+e.field+" >span:first",$("#"+i.id)).html(n);break;case"field":r.setFieldWidth(n,e[n].width),r.setGridHeader(),r.refreshDataCache();break;default:r.setGridHeader(),r.refreshDataCache()}},getData:function(){var e=this,t=e.configs,n=e.getAsync();return n?t.cacheData.source:t.data},textLimit:function(e,t,n){var r=this,i=r.configs,e=$.dataGrid._undef(e,"");if(e=="")return e;e=new String(e);var s=$("<div style='position:absolute;left:-1000px;'></div>");s.appendTo(document.body),s.css({fontSize:n});var o=e.length,u="",a=0;for(var f=1;f<=o;f++){u=e.substr(0,f),s.html(u+i.textLimitDef);if(!(parseFloat(s.width())<parseFloat(t)))break;a=f}return s.remove(),a==0?e=e.substr(0,1)+i.textLimitDef:a==o?e=e:e=e.substr(0,a)+i.textLimitDef,e.toString()},getTpl:function(e){return e},setContainer:function(e){var e=e||{},t=this,e=t.configs,n=t.tpl("container",e);return e.helper.html(n),t},setTitle:function(e){var t=this,n=t.configs;n.title=typeof e=="undefined"?n.title:e;if(n.title=="")return t;var r=t.tpl("title",n);return t.configs.views.title=$(r),t},getTools:function(e){var t=this,n=t.configs;if($.isPlainObject(e))var e=[e];if(!$.isArray(e)&&!$.isPlainObject(e))return $(e);var r=n._toolItem,i='<table cellspacing="0" cellpadding="0" border="0"><tbody><tr>{$tools}</tr></tbody></table>',s="",o=0,u=e.length;for(;o<u;o++)if($.isPlainObject(e[o])){e[o]=$.extend({},r,e[o]),e[o]["cls"]!=""&&(e[o].cls+=" l-btn-icon-left");var a=e[o].disabled?"l-btn-disabled":"";s+='<td><a href="javascript:void(0)" class="l-btn l-btn-plain '+a+'" indexid="'+o+'"><span class="l-btn-left"><span class="l-btn-text '+e[o].cls+'">'+e[o].text+"</span></span></a></td>"}else e[o]=="|"||e[o]=="-"||e[o]==";"||e[o]==","?s+='<td><div class="datagrid-btn-separator"></div></td>':s+="<td>"+e[o]+"</td>";i=i.replace("{$tools}",s);var i=$(i);return i.find(".l-btn").each(function(n){$(this).click(function(n){var r=$(this).attr("indexid");e[r].callBack.call(t,this,e[r]),n.stopPropagation(),n.preventDefault()})}),i},setToolBar:function(){var e=this,t=e.configs;if(t.toolBars===!1)return e;var n=e.tpl("toolbar",t);e.configs.views.toolbar=$(n);var r=e.getTools(t.toolBars);return r!==!1&&e.configs.views.toolbar.append(r),e.fireEvent("onToolBarCreate",[e.configs.views.toolbar,t.toolBars]),e.methodCall("setToolBar"),e},setGrid:function(){var e=this,t=e.configs,n=t.views;if(!n.grid){var r=e.tpl("grid",t);e.configs.views.grid=$(r)}else{var i=n.grid,s=0;for(var o in n){if(o=="grid")continue;s+=n[o].outerHeight(!0)}i.height(t.height-s)}return e.methodCall("setGrid"),e},autoExpand:function(){var e=this,t=e.configs,n=0,r=t.data.length;for(;n<r;n++)$.isPlainObject(t.data[n])&&"_expand"in t.data[n]&&"_openExpand"in t.data[n]&&t.data[n]._openExpand&&e.expandRow(n,t.data[n]._expand)},checkCk:function(e){var t=this,n=t.configs,r=n.gid,i=r,e=$.dataGrid._undef(e,!1);$("#view2-datagrid-header-inner-htable-tbody-"+n.id).find(">.datagrid-header-row td[field='ck']").find("input:checkbox").each(function(t){this.checked=e?!0:!1})},setExpandEvent:function(e,t,n){var r=this,i=r.configs;if(!$.isPlainObject(n))return;"_expand"in n&&(r.isExpandRowShow(t)?r.hideExpandRow(t):r.expandRow(t,n._expand))},getScrollbarSize:function(){var e=this,t=e.configs;if(!t.scrollbarSize){var n=document.body,r=document.createElement("div");r.style.width=r.style.height="100px",r.style.overflow="scroll",r.style.position="absolute",n.appendChild(r),t.scrollbarSize={width:r.offsetWidth-r.clientWidth,height:r.offsetHeight-r.clientHeight},n.removeChild(r)}return t.scrollbarSize},scrollToField:function(e){var t=this,n=t.configs,r=$("#view2-datagrid-header-"+n.id);if(!r.length)return t;var i=t.getColumnList();if(t.inArray(e,i)==-1)return t;if(t.inArray(e,n.lockColumns)!=-1)return t;if(t.inArray(e,n.hideColumns)!=-1)return t;var s=t.getScrollbarSize(),o=r.offset(),u=r.outerWidth(),a=$("#view2-datagrid-body-"+n.id),f=a.get(0).scrollHeight;f>a.outerHeight()&&(u-=s.width);var l=$(">tr.datagrid-header-row td[field='"+e+"']","#view2-datagrid-header-inner-htable-tbody-"+n.id);if(!l.length)return t;var c=l.offset(),h=l.outerWidth(),p=0;o.left>c.left?p=o.left-c.left:o.left+u<c.left+h&&(p=o.left+u-(c.left+h));var d=0;return d=n.sLeft-p,n.sLeft=d,t.fireEvent("onScroll",[!0]),t},scrollToRow:function(e){var t=this,n=t.configs,r=$("#view2-datagrid-body-"+n.id);if(!r.length)return t;if(t.inArray(e,n.lockRows)!=-1)return t;var i=t.getScrollbarSize(),s=r.offset(),o=r.outerHeight(),u=r.get(0).scrollWidth;u>r.outerWidth()&&(o-=i.height);var a=$("#"+n.id+"-row-"+e);if(!a.length)return t;var f=a.offset(),l=a.outerHeight(),c=0;s.top>f.top?c=s.top-f.top:s.top+o<f.top+l&&(c=s.top+o-(f.top+l));var h=0;return h=n.sTop-c,n.sTop=h,t.fireEvent("onScroll",[!0]),t},refreshPager:function(){var e=this,t=e.configs;e.setPager()},addPagerEvent:function(){var e=this,t=e.configs,n=t.views.pager;return n.find("a.pagination-first-btn").click(function(){if($(this).hasClass("p-btn-disabled"))return;t.pageNumber=1,e.refreshData()}),n.find("a.pagination-prev-btn").click(function(){if($(this).hasClass("p-btn-disabled"))return;var n=t.pageNumber-1;t.pageNumber=n<=0?1:n,e.refreshData()}),n.find("a.pagination-next-btn").click(function(){if($(this).hasClass("p-btn-disabled"))return;var n=t.total||t.data.length,r=Math.ceil(parseInt(n)/parseInt(t.pageSize)),i=t.pageNumber+1;t.pageNumber=i>r?r:i,e.refreshData()}),n.find("a.pagination-last-btn").click(function(){if($(this).hasClass("p-btn-disabled"))return;var n=t.total||t.data.length,r=Math.ceil(parseInt(n)/parseInt(t.pageSize));t.pageNumber=r,e.refreshData()}),n.find("a.pagination-load-btn").click(function(){if($(this).hasClass("p-btn-disabled"))return;e.refreshData()}),n.find(".pagination-page-list").change(function(){var n=t.total||t.data.length,r=$(this).val(),i=Math.ceil(parseInt(n)/parseInt(r));t.pageNumber>i&&(t.pageNumber=i);var s=e.fireEvent("onChangePageSize",[r]);if(s===!1)return!1;t.pageSize=r;var s=e.fireEvent("onSelectPage",[r]);if(s===!1)return!1;e.refreshData()}),n.find(".pagination-num").keydown(function(r){r.keyCode===13&&(t.pageNumber=parseInt(n.find(".pagination-num").val()),t.pageNumber=e.isNumber(t.pageNumber)?t.pageNumber:1,e.refreshData())}),e},setPager:function(e){var t=this,n=t.configs,e=$.dataGrid._undef(e,!1);if(!n.pagination)return t;var r={};r.id=n.id,r.total=n.total||n.data.length,r.pageSize=n.pageSize,r.pageNumber=n.pageNumber,r.pageList=n.pageList,r.pages=Math.ceil(parseInt(r.total)/parseInt(r.pageSize)),n.pageNumber=n.pageNumber>r.pages?r.pages:n.pageNumber,n.pageNumber=n.pageNumber<=0?1:n.pageNumber,r.pageNumber=n.pageNumber,r.start=r.pageNumber*r.pageSize-r.pageSize+1<0?0:r.pageNumber*r.pageSize-r.pageSize+1,r.end=r.pageNumber*r.pageSize,r.pagerMsg=n.pagerMsg.replace("{start}",r.start).replace("{end}",r.end).replace("{total}",r.total);var i=$("#"+n.id+"_pager"),s=t.tpl("pager",r);return i.size()?(n.views.pager=$(s),i.after(n.views.pager),i.remove()):n.views.pager=$(s),e?t:(t.addPagerEvent(),$.isArray(n.pagerToolBar)&&n.pagerToolBar.length&&$("#pagination-toolbar-"+n.id).append(t.getTools(n.pagerToolBar)),t.fireEvent("onPagerCreate",[n.views.pager]),t.methodCall("setPager"),t)},onSizeChange:function(e,t){var n=this,r=n.configs;r.width=$.dataGrid._undef(e,r.width),r.height=$.dataGrid._undef(t,r.height),r.border&&(r.width-=r.leftBorder+r.rightBorder,r.height-=r.topBorder+r.bottomBorder),$("#"+r.id).css({width:r.width,height:r.height}),$("#view_"+r.id).css({width:r.width});var i=r.views,s=i.grid,o=0;for(var u in i){if(u=="grid")continue;o+=i[u].outerHeight(!0)}s.height(r.height-o),n.fireEvent("onViewSizeChange",[])},onViewSizeChange:function(){var e=this,t=e.configs,n=t.gid,r=$(n).width(),i=$(n).height();if(t.helper.is(":hidden")){var s=$("<div></div>").appendTo(document.body);s.css({position:"absolute",top:9999}),s.append($("#"+t.id))}var o=$("#view1_"+t.id),u=$("#view2_"+t.id),a=$("#view1-datagrid-header-inner-htable-"+t.id).outerWidth();o.width(a),u.width(r-parseFloat(a));var f=$("#view2-datagrid-header-inner-htable-"+t.id).outerHeight();$("#view1-datagrid-header-inner-htable-"+t.id).height(f),f=parseFloat(f)-1,t.showHeader||(f=0),$("#view1-datagrid-header-inner-"+t.id).height(f),$("#view2-datagrid-header-inner-"+t.id).height(f);var l=$("#view2-datagrid-header-outer-locktable-"+t.id).outerHeight();$("#view1-datagrid-header-outer-"+t.id).height(l),$("#view2-datagrid-header-outer-"+t.id).height(l);var c=parseFloat($("#view2-datagrid-header-inner-"+t.id).outerHeight())+parseFloat($("#view2-datagrid-header-outer-"+t.id).outerHeight());$("#view1-datagrid-header-"+t.id).height(c),$("#view2-datagrid-header-"+t.id).height(c);var h=u.height()-t.gheader.height()-t.gfooter.height();t.gbody.height(h),$("#view1-datagrid-body-wrap-"+t.id).height(h),e.fireEvent("onScroll",[]),t.helper.is(":hidden")&&(t.helper.append($("#"+t.id)),s.remove())},array_sort:function(e,t,n,r){if(t==n)return e;var i=e;e=[];var s=0,o=i.length;for(;s<o;s++){var u=e.push(s);s==t?t=u-1:s==n&&(n=u-1)}var a=e[t];if(t>n){r||n++;for(var f=t;f>=0;f--){if(f==n){e[f]=a;break}e[f]=e[f-1]}}else if(t<n){r&&n--;for(var f=t;f<=n;f++)f==n?e[f]=a:e[f]=e[f+1]}var l=[],c=0,o=e.length;for(;c<o;c++)l.push(i[e[c]]);return e=l,e},onColumnMove:function(e){var t=this,e=t.configs,n=e.columns,r=0,i=0,s=e.moveToFieldPos;if(e.moveField==e.moveToField)return;if(t.inArray(e.moveField,e.lockColumns)!=-1)return;if(t.inArray(e.moveToField,e.lockColumns)!=-1)return;var o=0,u=n.length;for(;o<u;o++)n[o]["field"]==e.moveField&&(r=o),n[o]["field"]==e.moveToField&&(i=o);n=e.columns=t.array_sort(n,r,i,s);if(s){var r=$("#view2-datagrid-header-inner-htable-tbody-"+e.id).find("td[field='"+e.moveField+"']"),i=$("#view2-datagrid-header-inner-htable-tbody-"+e.id).find("td[field='"+e.moveToField+"']");i.before(r);var a=0,u=e.data.length;for(;a<u;a++)r=$("#"+e.id+"-row-"+a).find("td[field='"+e.moveField+"']"),i=$("#"+e.id+"-row-"+a).find("td[field='"+e.moveToField+"']"),i.before(r)}else{var r=$("#view2-datagrid-header-inner-htable-tbody-"+e.id).find("td[field='"+e.moveField+"']"),i=$("#view2-datagrid-header-inner-htable-tbody-"+e.id).find("td[field='"+e.moveToField+"']");i.after(r);var a=0,u=e.data.length;for(;a<u;a++)r=$("#"+e.id+"-row-"+a).find("td[field='"+e.moveField+"']"),i=$("#"+e.id+"-row-"+a).find("td[field='"+e.moveToField+"']"),i.after(r)}},setView:function(){var e=this,t=e.configs,n=e.tpl(e.getTpl("view1"),t),r=e.tpl(e.getTpl("view2"),t),i=t.gid;$(i).html(""),$(n).appendTo(i),$(r).appendTo(i),t.gheader=$("#view2-datagrid-header-"+t.id),t.gbody=$("#view2-datagrid-body-"+t.id),t.gfooter=$("#view2-datagrid-footer-"+t.id),t.gbody.scroll(function(){e.fireEvent("onScroll",[])})},getRowData:function(e,t){var n=this,r=n.configs,t=$.dataGrid._undef(t,!1),i=t?n.getData():r.data;if(!t)return $("#"+r.id+"-row-"+e).data("rowData");var s=r.pk,o=0,u=i.length;for(;o<u;o++)if(i[o][s]==e)return i[o];return!1},setRowData:function(e,t,n){var r=this,i=r.configs,s=$("#"+i.id+"-row-"+e).data("rowData");if(!s)return!1;s[t]=n;var o=!1;return typeof s[i.pk]!="undefined"&&(o=r.getRowData(s[i.pk],!0),o&&(o[t]=n)),!0},getRealField:function(e){var t=this,n=t.configs;if(typeof e=="undefined")return null;var r=e,e=t.getColumnData(e,"index");return e=e==""?r:e,e},getFieldValue:function(e,t){var n=this,r=n.configs;t=n.getRealField(t);var i=this.getRowData(e);return typeof i=="undefined"?"":typeof i[t]=="undefined"?"":i[t]},setFieldValue:function(e,t,n){var r=this,i=r.configs,s=i.gid,o=r.getRealField(t),u=r.getRowData(e);if(!u)return!1;if(u[o]==n)return!1;var a="#"+i.id+"-row-"+e+",#"+i.id+"-view1-row-"+e,f=$(a).find("td[field='"+t+"'] div.datagrid-cell");f.html(n).addClass("datagrid-cell-edit");var l=r.getColumnData(t,"callBack");return l!=null&&$.isFunction(l)&&l!=i.noop&&l.call(r,f,e,t,u),r.setRowData(e,o,n),r.fireEvent("onCellEdit",[f,e,t,n,u]),u},getSlectRows:function(e){var t=this,n=t.configs,r=n.gid,i=[],e=$.dataGrid._undef(e,!1);$("#view2_"+n.id).find("tr.datagrid-row[datagrid-row-select='1']").each(function(e){i.push($(this).attr("datagrid-row-index"))});var s=[];if(e){var o=0,u=i.length;for(;o<u;o++)s.push(n.data[i[o]]);return s}return i},onLockRow:function(){var e=this,t=e.configs,n=t.lockRows,r=0,i=n.length;for(;r<i;r++){if(n[r]==null)continue;e.lockRow(n[r])}},onAfterLockRow:function(e){var t=this,n=t.configs,r=t.getRowData(e);if($("#"+n.id+"-expand-row-"+e).size()){var i=$("#"+n.id+"-expand-row-"+e).is(":hidden");t.expandRow(e,r._expand),i&&t.hideExpandRow(e)}if(n.groupBy){var s=$("#view2-datagrid-body-btable-tbody-"+n.id);s.find("tr.datagrid-group-row").each(function(e){var t=$(this).attr("datagrid-group-row-id"),n=s.find("tr[datagrid-group-id='"+t+"']").first();$(this).insertBefore(n)});var o=$("#view1-datagrid-body-btable-tbody-"+n.id);o.find("tr.datagrid-group-row-view1").each(function(e){var t=$(this).attr("datagrid-group-row-id"),n=o.find("tr[datagrid-group-id='"+t+"']").first();$(this).insertBefore(n)})}t.changeExpandPos()},onLockColumn:function(){var e=this,t=e.configs,n=t.lockColumns;setTimeout(function(){var t=0,r=n.length;for(;t<r;t++)e.lockColumn(n[t])},0)},onAfterLockColumn:function(e){var t=this,n=t.configs,r=n.gid;$("#view2_"+n.id).find("tr.datagrid-row-expand").each(function(e){var r=$(this).attr("datagrid-expand-row-index"),i=$(this).is(":hidden"),s=t.getRowData(r);$("#"+n.id+"-expand-row-"+r).size()&&(t.expandRow(r,s._expand),i&&t.hideExpandRow(r))}),t.setExpandRowSize(),t.addGroupRow()},lockRow:function(e){var t=this,n=t.configs;t._lockRow(e)&&(t.inArray(e,n.lockRows)==-1&&n.lockRows.push(e),t.fireEvent("onAfterLockRow",[e]),t.fireEvent("onViewSizeChange",[]))},unLockRow:function(e){var t=this,n=t.configs;if(t._unLockRow(e)){var r=0,i=n.lockRows.length;for(;r<i;r++)n.lockRows[r]==e&&(n.lockRows[r]=null);var s=[],o=0,i=n.lockRows.length;for(;o<i;o++)n.lockRows[o]!==null&&s.push(n.lockRows[o]);n.lockRows=s,t.onAfterLockRow(e),t.fireEvent("onAfterUnLockRow",[e]),t.fireEvent("onViewSizeChange",[])}},unLockColumn:function(e){var t=this,n=t.configs;if(t._unLockColumn(e)){var r=0,i=n.lockColumns.length;for(;r<i;r++)n.lockColumns[r]==e&&(n.lockColumns[r]=null);var s=[],o=0,i=n.lockColumns.length;for(;o<i;o++)n.lockColumns[o]!==null&&s.push(n.lockColumns[o]);n.lockColumns=s,t.onAfterLockColumn(e),t.fireEvent("onAfterUnLockColumn",[e]),t.fireEvent("onViewSizeChange",[])}},lockColumn:function(e){var t=this,n=t.configs;t._lockColumn(e)&&(t.inArray(e,n.lockColumns)==-1&&n.lockColumns.push(e),t.fireEvent("onAfterLockColumn",[e]),t.fireEvent("onViewSizeChange",[]))},_lockRow:function(e){var t=this,n=t.configs,r=n.gid,i=r,s=t.fireEvent("onBeforeLockRow",[e]);if(s===!1)return!1;var o=$("#"+n.id+"-row-"+e),u=$("#"+n.id+"-view1-row-"+e);return o.length?($("#view2-datagrid-header-outer-locktable-tbody-"+n.id).append(o),$("#view1-datagrid-header-outer-locktable-tbody-"+n.id).append(u),!0):!1},_unLockRow:function(e){var t=this,n=t.configs,r=n.gid,i=r,s=t.fireEvent("onBeforeUnlockRow",[e]);if(s===!1)return!1;var o=$("#"+n.id+"-row-"+e),u=$("#"+n.id+"-view1-row-"+e);if(!o.length)return!1;if(t.inArray(e,n.lockRows)==-1)return!1;var a=n.data;for(var f=e-1;f>=-1;f--)if(t.inArray(f,n.lockRows)==-1&&$("#"+n.id+"-row-"+f).size())break;return e=f,e>=0?(o.insertAfter("#"+n.id+"-row-"+e),u.insertAfter("#"+n.id+"-view1-row-"+e)):($("#view2-datagrid-body-btable-tbody-"+n.id).prepend(o),$("#view1-datagrid-body-btable-tbody-"+n.id).prepend(u)),!0},_getRowNumber:function(e){var t=this,n=t.configs,r=n.data,i=n.gid,s=$("#"+n.id+"-view1-row-"+e),o=!1,u={};if(!s.size()){o=!0;var a=t.getTpl("view1_row");u={i:e,id:n.id,rowNumbersExpand:n.rowNumbersExpand?n.rowNumbersExpand:!1,data:r[e],groupBy:n.groupBy,rowNumbersWidth:n.rowNumbersWidth,opt:n};var f=$(t.tpl(a,u));t.bindRowEvent(!1,f),s=f}return{isNew:o,node:s}},_lockColumn:function(e){var t=this,n=t.configs,r=n.data,i=n.gid,s=i;if(n.rowNumbersWidth===!1)return!1;var o=t.fireEvent("onBeforeLockColumn",[e]);if(o===!1)return!1;var u=t.getColumnList(),e=$.isArray(e)?e:[e],a="#view1-datagrid-header-inner-htable-tbody-"+n.id,f="#view1-datagrid-header-outer-locktable-tbody-"+n.id,l=0,c=e.length;for(;l<c;l++){if(e[l]==null)continue;if(t.inArray(e[l],u)==-1)continue;var h=$("#view2-datagrid-header-inner-htable-tbody-"+n.id).find(">tr.datagrid-header-row td[field='"+e[l]+"']");$(a).find(">tr.datagrid-header-row").append(h),$("#view2-datagrid-header-outer-locktable-tbody-"+n.id).find(">tr.datagrid-row td[field='"+e[l]+"']").each(function(e){var r=$(this).parent().attr("datagrid-row-index"),i=t._getRowNumber(r);i.isNew&&$("#view1-datagrid-header-outer-locktable-tbody-"+n.id).append(i.node),$(this).appendTo(i.node)}),$("#view2-datagrid-body-btable-tbody-"+n.id).find(">tr.datagrid-row td[field='"+e[l]+"']").each(function(e){var r=$(this).parent().attr("datagrid-row-index"),i=t._getRowNumber(r);i.isNew&&$("#view1-datagrid-body-btable-tbody-"+n.id).append(i.node),$(this).appendTo(i.node)}),$("#view2-datagrid-footer-btable-tbody-"+n.id).find(">tr.datagrid-footer-row td[field='"+e[l]+"']").each(function(e){var r=$(this).parent().attr("datagrid-row-index"),i=t._getRowNumber(r);i.isNew&&$("#view1-datagrid-footer-btable-tbody-"+n.id).append(i.node),$(this).appendTo(i.node)})}return!0},_unLockColumn:function(e){var t=this,n=t.configs,r=n.gid,i=r,s=t.fireEvent("onBeforeUnlockColumn"
,[e]);if(s===!1)return!1;var o=t.getColumns(),u=!1,a=0,f=o.length;for(;a<f;a++)if(o[a]["field"]==e){u=!0;break}if(!u)return!1;if(t.inArray(e,n.lockColumns)==-1)return!1;var l=$("#view1-datagrid-header-inner-htable-tbody-"+n.id).find(">tr.datagrid-header-row td[field='"+e+"']"),c=$(r),h=$("#view1_"+n.id),p=$("#view2_"+n.id),d=a,v=0,f=o.length;for(;v<f;v++)if(o[v]["field"]==e)break;for(v-=1;v>=-1;v--){if(v<0)break;var m=o[v].field;if(t.inArray(m,n.lockColumns)==-1)break}return d=v,d<0?l.prependTo($("#view2-datagrid-header-inner-htable-tbody-"+n.id).find(">tr.datagrid-header-row")):l.insertAfter($("#view2-datagrid-header-inner-htable-tbody-"+n.id).find(">tr.datagrid-header-row").find("td[field]").eq(d)),$("#view1-datagrid-header-outer-locktable-tbody-"+n.id).find(">tr.datagrid-row td[field='"+e+"']").each(function(e){var t=$(this).parent(),r=t.attr("datagrid-row-index"),i=$("#"+n.id+"-row-"+r);d<0?i.prepend($(this)):i.find(">td").eq(d).after($(this))}),$("#view1-datagrid-body-btable-tbody-"+n.id).find(">tr.datagrid-row td[field='"+e+"']").each(function(e){var t=$(this).parent(),r=t.attr("datagrid-row-index"),i=$("#"+n.id+"-row-"+r);d<0?i.prepend($(this)):i.find(">td").eq(d).after($(this))}),$("#view1-datagrid-footer-btable-tbody-"+n.id).find(">tr.datagrid-row td[field='"+e+"']").each(function(e){var t=$(this).parent(),r=t.attr("datagrid-row-index"),i=$("#"+n.id+"-row-"+r);d<0?i.prepend($(this)):i.find(">td").eq(d).after($(this))}),!0},getCheckBoxColumn:function(e){var t=this,n=t.configs,r=$.extend({},n._columnMetaData);return r.field="ck",r.title=n.checkBoxTitle,r._expand='<input type="checkbox">',r.hcls="datagrid-header-check",r.bcls="datagrid-cell-check",r.width=n.checkBoxWidth,r.fitColumn=n.checkBoxFit,r.align="center",r.callBack=function(e,t,n,r){var i=this;$(e).find("input:checkbox").click(function(e){this.checked?i.selectRow(t):i.unselectRow(t),e.stopPropagation()})},r},geteditColumn:function(e){var t=this,n=t.configs,r=$.extend({},n._columnMetaData),i=0,s=0;$.isArray(n.editColumn)?$.each(n.editColumn,function(e,t){$.isPlainObject(this)?(n.editColumn[e]=$.extend({},n._toolItem,n.editColumn[e]),i++):s++}):n.editColumn=[];var o="";return r.field="ed",r.title=n.editColumnTitle==""||n.editColumnTitle===!1?" ":n.editColumnTitle,r._expand=o,r.hcls="datagrid-header-edit",r.bcls="datagrid-cell-edit",r.width=i*n.editCellW+s*4+"px",r.fitColumn=n.editColumnFit,r.align="center",r.callBack=function(e,t,r,i){var s=this,o=n._toolItem,u=[],a={},f=0,l=n.editColumn.length;for(;f<l;f++)$.isPlainObject(n.editColumn[f])?(a=$.extend(!0,{},o,n.editColumn[f]),a.callBack=function(e,o){var u=$(e).attr("indexid");n.editColumn[u].callBack.call(s,e,t,r,i,o)},u.push(a)):u.push(n.editColumn[f]);var c=s.getTools(u);e.append(c)},r},onInitFieldWidth:function(){var e=this,t=e.configs;return e._initFieldWidth(),e},onFinishFieldWidth:function(){var e=this,t=e.configs,n=t.columns;return $.each(n,function(t,n){n.width.toString().indexOf("%")!=-1&&e.setFieldWidth(n.field,n.width)}),e},_initFieldWidth:function(){var e=this,t=e.configs,n=e.getColumns(),r=0,i=$("#"+t.id).width(),s=$("#view1-datagrid-header-inner-htable-"+t.id).outerWidth();r=i-parseFloat(s),$("#"+t.id+"_css").remove();var o=[];o.push('<style type="text/css" id="'+t.id+'_css">');for(var u=0;u<n.length;u++){var a=n[u].width;a.toString().indexOf("%")!=-1?a=parseFloat(a)*r/100:a=parseFloat(a),a-=t.padding,a=Math.floor(a);var f="#"+t.id+" .datagrid-cell-"+n[u].field+"{width:"+a+"px;}";o.push(f)}return o.push("</style>"),o=o.join("\n"),$("#"+t.id).before(o),e},setFieldWidth:function(e,t,n){var r=this,i=r.configs,n=$.dataGrid._undef(n,!1),t=$.dataGrid._undef(t,120);if(t.toString().indexOf("%")!=-1){var s=0,o=r.getScrollbarSize(),u=$("#view2-datagrid-body-"+i.id);s=u.outerWidth();var a=u.get(0).scrollHeight;a>u.outerHeight()&&(s-=o.width),t=parseFloat(t)*s/100}else t=parseFloat(t);var f=parseFloat(r.getColumnData(e,"minWidth"));t=t>=f?t:f,n||(t-=i.padding),t=Math.floor(t);var l="#"+i.id+" .datagrid-cell-"+e,c=$("#"+i.id+"_css").get(0);if(!c)return!1;var h=c.styleSheet?c.styleSheet:c.sheet||document.styleSheets[document.styleSheets.length-1],p=h.cssRules||h.rules,d=!1;for(var v=0;v<p.length;v++)if(p[v].selectorText.toLowerCase()==l.toLowerCase()){p[v].style.width=t+"px",d=!0;break}if(!d){var m=h.addRule||h.insertRule;h.addRule?h.addRule(l,"width:"+t+"px"):h.insertRule(l+"{width:"+t+"px}",p.length)}return r.fireEvent("onScroll",[!0]),r.setGridHeaderTextLimit(),r.setGridBodyTextLimit(e),r.fireEvent("onViewSizeChange",[]),r.setGroupRowSize(),r.setExpandRowSize(),r},getColumns:function(e){var t=this,n=t.configs,r=n.columns,e=$.dataGrid._undef(e,!1);n.cacheData.columns=$.dataGrid._undef(n.cacheData.columns,r);if(e)return n.cacheData.columns;if(r.length<=0&&n.data.length>0&&$.isPlainObject(n.data[0]))for(var i in n.data[0])r.push({field:i});var s=[],o=!1,u=!1,i=0,a=r.length;for(;i<a;i++){r[i]=$.extend({},n._columnMetaData,r[i]);if(r[i].disabled===!0)continue;r[i].title=r[i]["title"]==""?r[i].field:r[i].title,r[i].index=r[i]["index"]==""?r[i].field:r[i].index,n.checkBox!==!1&&r[i]["field"]=="ck"&&o===!1&&(r[i]=t.getCheckBoxColumn(r),o=!0),n.editColumn!==!1&&r[i]["field"]=="ed"&&u===!1&&(r[i]=t.geteditColumn(r),u=!0),s.push(r[i])}n.columns=r=s;var f=[],l=[];return n.checkBox!==!1&&o===!1&&t.getCheckBoxColumn(r)!==!1&&(f=[t.getCheckBoxColumn(r)],$.merge(f,r),r=f),n.editColumn!==!1&&u===!1&&t.geteditColumn(r)!==!1&&(l=[t.geteditColumn(r)],$.merge(r,l)),n.columns=r,n.columns},getColumnList:function(){var e=this,t=e.configs,n=t.gid,r=t.columns,i=[],s=0,o=r.length;for(;s<o;s++)i.push(r[s].field);return i},onDisplayField:function(){var e=this,t=e.configs,n=t.hideColumns,r=t.gid;if(n.length<=0)return;var i=0,s=n.length;for(;i<s;i++){if(n[i]==null)continue;e.hideColumn(n[i])}},displayColumn:function(e,t){var n=this,r=n.configs,i=r.hideColumns,s=r.gid,o=n.getColumnList();if(n.inArray(e,o)==-1)return!1;var u=t=="show"?!0:!1;if(u){var a=0,f=i.length;for(;a<f;a++)i[a]==e&&(i[a]=null)}else n.inArray(e,i)==-1&&i.push(e);return $(s).find("td[field='"+e+"']")[t](),n.fireEvent("onViewSizeChange"),n.setGroupRowSize(),n.setExpandRowSize(),!0},showColumn:function(e){var t=this;return t.displayColumn(e,"show")},hideColumn:function(e){var t=this;return t.displayColumn(e,"hide")},sortColumn:function(e){var t=this,n=t.configs,r=n.gid,e=e||!1;if(e==0)return;var i="#view2-datagrid-header-inner-htable-tbody-"+n.id;$(i).find("td[field='"+e+"']").find("div.datagrid-cell").click(function(e){var r=$(this).parent().attr("field");n.sortName=r;var s=t.fireEvent("onSortColumn",[r]);if(s===!1)return;$(this).hasClass("datagrid-sort-asc")?($(i).find("div.datagrid-cell").removeClass("datagrid-sort-asc").removeClass("datagrid-sort-desc"),$(this).removeClass("datagrid-sort-asc"),$(this).addClass("datagrid-sort-desc"),n.sortOrder="desc"):($(i).find("div.datagrid-cell").removeClass("datagrid-sort-asc").removeClass("datagrid-sort-desc"),$(this).removeClass("datagrid-sort-desc"),$(this).addClass("datagrid-sort-asc"),n.sortOrder="asc"),t.refreshData()})},showHeader:function(){var e=this,t=e.configs;t.showHeader=!0,e.fireEvent("onViewSizeChange",[])},hideHeader:function(){var e=this,t=e.configs;t.showHeader=!1,e.fireEvent("onViewSizeChange",[])},setGridHeaderEvent:function(e,t){var n=this,r=n.configs,i=r.gid,s=r.columns;if(r.fitColumns){var o=$.extend({},r);o.self=n,o.stop=function(e,t){var r=n.fireEvent("onResizeColumnStop",[t]);if(r===!1)return r;n.cStop(t)}}var u=e.find("td[field]").each(function(){var e=$(this).attr("field");if(r.fitColumns){var t=n.getColumnData(e,"fitColumn");t&&$("div.datagrid-cell",this)._resize(o)}var i=n.getColumnData(e,"sortable");i?n.sortColumn(e):$("div.datagrid-cell >.datagrid-sort-icon",this).hide(),r.sortName&&r.sortName==e&&$("div.datagrid-cell",this).addClass("datagrid-sort-"+r.sortOrder.toLowerCase())});r.moveColumns&&u.moveColumn(r),u.bind("click",function(e){var t=$(this).attr("field");r.autoScrollToField&&n.scrollToField(t)}),u.hover(function(e){$(this).addClass("datagrid-header-over"),n.fireEvent("onColumnOver",[this,e])},function(e){$(this).removeClass("datagrid-header-over"),n.fireEvent("onColumnOut",[this,e])}),e.bind("contextmenu",function(e){var t=n.fireEvent("onHeaderContextMenu",[this,e]);if(t==0)return!1}),n.setGridHeaderTextLimit();if(r.checkBox){var a=e.find("td[field='ck']");a.find(".datagrid-sort-icon").hide(),a.find("input:checkbox").click(function(){if(r.singleSelect)return this.checked=!1,!1;this.checked?n.selectAllRows():n.unselectAllRows()})}},setGridHeaderTextLimit:function(){var e=this,t=e.configs,n=t.gid,r=n;if(!t.textLimit)return!1;var i=t.columns,s=0,o=i.length;for(;s<o;s++){if(i[s].textLimit===!1)continue;var u=$(r).find(".datagrid-header-row td[field='"+i[s].field+"']").find("div.datagrid-cell"),a=u.width(),f=u.css("fontSize"),l=e.getColumnData(i[s].field,"title");l=e.textLimit(l,a,f),u.find("span").first().html(l)}},setGridHeader:function(){var e=this,t=e.configs,n=t.gid,r=e.getColumns(),i=e.getTpl("view1_header_inner_row"),s=t.headerTpl?t.headerTpl:e.getTpl("view2_header_inner_row"),o=$("#datagrid-view2-header-inner-wraper-"+t.id),u=$("#datagrid-view1-header-inner-wraper-"+t.id),a=$("#datagrid-view2-header-outer-wraper-"+t.id),f=$("#datagrid-view1-header-outer-wraper-"+t.id),l=['<table class="datagrid-htable" id="view1-datagrid-header-inner-htable-'+t.id+'" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-inner-htable-tbody-'+t.id+'">'],c=['<table class="datagrid-htable" id="view2-datagrid-header-inner-htable-'+t.id+'" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-inner-htable-tbody-'+t.id+'">'],h=['<table class="datagrid-locktable" id="view1-datagrid-header-outer-locktable-'+t.id+'" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-outer-locktable-tbody-'+t.id+'"></tbody></table>'],p=['<table class="datagrid-locktable" id="view2-datagrid-header-outer-locktable-'+t.id+'" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-outer-locktable-tbody-'+t.id+'"></tbody></table>'],d=e.tpl(i,t),v=e.tpl(s,{fields:r,opt:t});return l.push(d),c.push(v),l.push("</tbody></table>"),c.push("</tbody></table>"),u.html(l.join("")),o.html(c.join("")),f.html(h.join("")),a.html(p.join("")),e.fireEvent("onHeaderCreate",[]),d=$("> tr.datagrid-header-row","#view1-datagrid-header-inner-htable-tbody-"+t.id),v=$("> tr.datagrid-header-row","#view2-datagrid-header-inner-htable-tbody-"+t.id),e.setGridHeaderEvent(v,d),e.methodCall("setGridHeader"),!0},onHeaderCreate:function(){var self=this,opt=self.configs,gid=opt.gid;if(!opt.headerTpl)return-1;var fields=opt.columns,headerBody=$("#view2-datagrid-header-inner-htable-tbody-"+opt.id),_columns=[],_thex=$.dataGrid.getToGridOptions();return headerBody.find(">tr td[field],>tr th[field],>tr td["+_thex.options_from+"],>tr th["+_thex.options_from+"]").each(function(i){var field=$(this).attr("field"),_d=$(this).attr(_thex.options_from);_d?_d=eval("({"+_d+"})"):_d={},field||(field=_d.field?_d.field:"field_"+Math.floor(Math.random()*999999));var _d2={};_d2.title=$(this).html();var _d3={},j=0,len=fields.length;for(;j<len;j++)if(fields[j]["field"]==field){_d3=fields[j];break}$.isEmptyObject(_d3)&&(_d3.field=field),_d.width=_d.width?_d.width:$(this).width();var _d4=$.extend(!0,{},_d,_d2,_d3);_d4.align=_d4.align?_d4.align:$(this).attr("align")?$(this).attr("align"):opt._columnMetaData.align,_d4.hcls=_d4.hcls?_d4.hcls:opt._columnMetaData.hcls;var $this=this;$(this).is("th")?($this=$('<td field="'+_d4.field+'" align="'+_d4.align+'"></td>'),$(this).replaceWith($this)):($(this).attr("field",_d4.field),$(this).attr("align",_d4.align)),$($this).html('<div class="datagrid-header-wrap" field="'+_d4.field+'"><div class="datagrid-cell datagrid-cell-'+_d4.field+" datagrid-cell-header-"+_d4.field+" "+_d4.hcls+'" ><span>'+_d4.title+'</span><span class="datagrid-sort-icon">&nbsp;</span></div></div>'),_columns.push(_d4)}),opt.columns=_columns,headerBody.find(">tr").addClass("datagrid-header-row"),headerBody.find(">tr")},setColumnValue:function(e,t,n){var r=this,i=r.getColumns(),s=0,o=i.length;for(;s<o;s++)if(i[s]["field"]==e){i[s][t]=n;continue}},cStop:function(e){var t=this,n=t.configs,r=n.gid,i=$(r).find("td[field='"+e.field+"']:first").find("div.datagrid-cell");if(!i.size())return;var s=parseFloat(i.width());s+=e.offsetX,s+=n.padding,t.setColumnValue(e.field,"width",s),t.setFieldWidth(e.field,s),t.fireEvent("onAfterResize",[e])},setGroupRowSize:function(){var e=this,t=e.configs,n=t.gid;if(!t.groupBy)return;var r=n+" .datagrid-view2",i=$(r).find(".datagrid-header-row").first().width();$(r).find(".datagrid-group-row td").width(i)},changeExpandPos:function(){var e=this,t=e.configs,n=t.gid;$("#view2-datagrid-body-btable-tbody-"+t.id).find(".datagrid-row-expand").each(function(t){if(!$(this).is(":hidden")){var n=$(this).attr("datagrid-expand-row-index");e.expandRow(n,"")}})},setExpandRowSize:function(){var e=this,t=e.configs,n=t.gid,r=n+" .datagrid-view2";$(r).find(".datagrid-row-expand").each(function(e){var n=$(this).attr("datagrid-expand-row-index"),r=$("#"+t.id+"-row-"+n),i=0;r.find(">td >.datagrid-cell").each(function(e){$(this).is(":hidden")||(i+=$(this).width())}),$(this).find(".datagrid-cell-expand").width(i)})},isRowHidden:function(e){var t=this,n=t.configs,r=n.gid;return e===undefined?!0:$("#"+n.id+"-row-"+e).size()&&!$("#"+n.id+"-row-"+e).is(":hidden")?!1:!0},isExpandRowShow:function(e){var t=this,n=t.configs,r=n.gid,i=n.id+"-expand-row-"+e;return $("#"+i).size()&&!$("#"+i).is(":hidden")?!0:!1},expandRow:function(e,t){var n=this,r=n.configs,i=r.gid,s=r.events,e=typeof e=="undefined"?!1:e;if(e===!1)return n;var t=typeof t=="undefined"?"":t,o=n.getRowData(e);t=n.tpl(t,o);var u=$("#"+r.id+"-row-"+e),a=$("#"+r.id+"-view1-row-"+e);if(u.size()<=0)return n;var f=r.id+"-expand-row-"+e;if($("#"+f).size())u.after($("#"+f));else{var l=0;u.find(">td >.datagrid-cell").each(function(e){$(this).is(":hidden")||(l+=$(this).width())});var c=$("<tr id='"+f+"' class='datagrid-row-expand' datagrid-expand-row-index='"+e+"'><td colspan='"+r.columns.length+"'><div class=' datagrid-cell-expand' style='overflow:hidden;width:"+l+"px'></div></td></tr>");try{$(t).size()?c.find("div.datagrid-cell-expand").append($(t).show()):c.find("div.datagrid-cell-expand").html(t)}catch(s){c.find("div.datagrid-cell-expand").html(t)}u.after(c)}var h=r.id+"-expand-view1-row-"+e;if(r.rowNumbersWidth!==!1||r.lockColumns.length){$("#"+h).remove();var p=0,d="";if(r.lockColumns.length){var v=0,m=r.lockColumns.length;for(;v<m;v++)r.lockColumns[v]!=null&&p++}p&&(d='<td colspan="'+p+'" class="datagrid-cell-rownumber-expand"></td>');var g=$("<tr id='"+h+"' style='overflow:hidden;'  class='datagrid-row datagrid-row-view1' datagrid-expand-row-index='"+e+"'><td class='datagrid-td-rownumber'><div class='datagrid-cell-view1-expand'></div></td>"+d+"</tr>");a.after(g);var y=$("#"+f).height();$("#"+h).height(y);if(y!=$("#"+h).height()){var y=$("#"+h).height();$("#"+h).height(y-1)}}var c=$.dataGrid._undef(c,$("#"+f)),g=$.dataGrid._undef(g,$("#"+h));n.isRowHidden(e)?(c.hide(),g.hide()):(c.show(),g.show());var y=c.height();g.css({height:y}),n.fireEvent("onExpandRow",[e]),n.fireEvent("onViewSizeChange",[])},hideExpandRow:function(e){var t=this,n=t.configs,r=n.gid,e=typeof e=="undefined"?!1:e;if(e===!1)return t;var i=n.id+"-expand-row-"+e,s=n.id+"-expand-view1-row-"+e;$("#"+i).hide(),$("#"+s).hide(),t.fireEvent("onViewSizeChange",[])},destroyExpandRow:function(e){var t=this,n=t.configs,r=n.gid,e=typeof e=="undefined"?!1:e;if(e===!1)return t;var i=n.id+"-expand-row-"+e,s=n.id+"-expand-view1-row-"+e;$("#"+i).remove(),$("#"+s).remove(),t.fireEvent("onViewSizeChange",[])},updateExpandRow:function(e,t){var n=this;n.destroyExpandRow(e),n.expandRow(e,t)},selectAllRows:function(){var e=this,t=e.configs,n=t.gid,r=t.events;if(t.singleSelect)return e;var i=e.fireEvent("onSelectAll",[]);if(i===!1)return e;var s=0,o=t.data.length;for(;s<o;s++)e.selectRow(s);return e},unselectAllRows:function(){var e=this,t=e.configs,n=t.gid,r=t.events,i=e.fireEvent("onUnselectAll",[]);if(i===!1)return e;var s=e.getSlectRows(),o=0,u=s.length;for(;o<u;o++)e.unselectRow(s[o]);return e},addSelectRecode:function(){},removeSelectRecode:function(){},selectRow:function(e){var t=this,n=t.configs,r=n.gid,i=n.events,s=r,e=typeof e=="undefined"?!1:e;if(e===!1)return t;var o=t.getRowData(e),u=$("#"+n.id+"-row-"+e),a=$("#"+n.id+"-view1-row-"+e),f=$(u).add(a);if(f.size()<=0)return t;var l=t.fireEvent("onSelect",[f,e,o]);if(l===!1)return l;u.attr("datagrid-row-select","1").addClass("datagrid-row-selected"),a.attr("datagrid-row-select","1").addClass("datagrid-row-selected");if(n.checkBox){var c=f.find("td[field='ck'] .datagrid-cell-check input:checkbox");c.length&&(c.get(0).checked=!0)}if(n.singleSelect){var h=t.getSlectRows(),p=h.length;if(p)for(var d=0;d<p;d++){if(h[d]==e)continue;t.unselectRow(h[d])}}return t},unselectRow:function(e){var t=this,n=t.configs,r=n.gid,i=n.events,s=r,e=typeof e=="undefined"?!1:e;if(e===!1)return t;var o=t.getRowData(e),u=$("#"+n.id+"-row-"+e),a=$("#"+n.id+"-view1-row-"+e),f=$(u).add(a);if(f.size()<=0)return t;var l=t.fireEvent("onUnselect",[f,e,o]);if(l===!1)return l;u.attr("datagrid-row-select","0").removeClass("datagrid-row-selected"),a.attr("datagrid-row-select","0").removeClass("datagrid-row-selected");if(n.checkBox){var c=f.find("td[field='ck'] .datagrid-cell-check input:checkbox");c.length&&(c.get(0).checked=!1)}return t},showGroup:function(e,t){var n=this,r=n.configs,i=r.gid,s=i+" .datagrid-view2",o=i+" .datagrid-view1",t=$.dataGrid._undef(t,"show");if(typeof e=="undefined")return n;var u=$(s).find("tr[datagrid-group-id='"+e+"']"),a=$(o).find("tr[datagrid-group-id='"+e+"']");return u[t](),a[t](),u.each(function(e){var r=$(this).attr("datagrid-row-index"),i=n.getRowData(r);i._openExpand=$.dataGrid._undef(i._openExpand,!1),i._openExpand&&n.expandRow(r,i._expand),t=="hide"&&n.hideExpandRow(r)}),t=="show"?($(s).find("#"+r.id+"-group-row-"+e).find("div.datagrid-group-cell").addClass("datagrid-group-cell-select"),$(o).find("#"+r.id+"-group-view1-row-"+e).find("div.datagrid-group-cell-rownumber").addClass("datagrid-group-cell-rownumber-select")):($(s).find("#"+r.id+"-group-row-"+e).find("div.datagrid-group-cell").removeClass("datagrid-group-cell-select"),$(o).find("#"+r.id+"-group-view1-row-"+e).find("div.datagrid-group-cell-rownumber").removeClass("datagrid-group-cell-rownumber-select")),n.fireEvent("onScroll",[!0]),n.fireEvent("onViewSizeChange",[]),n},hideGroup:function(e){var t=this;return t.showGroup(e,"hide")},addGroupRow:function(e){var t=this,n=t.configs,r=n.gid,i=r+" .datagrid-view2",s=r+" .datagrid-view1";if(!n.groupBy)return!1;var e=$.dataGrid._undef(e,!1);e&&($("#view2-datagrid-body-btable-tbody-"+n.id).find("> tr").hide(),$("#view1-datagrid-body-btable-tbody-"+n.id).find("> tr").hide());var o=$(i).find(".datagrid-header-row").width(),u="";n.rowNumbersWidth!==!1&&(u="datagrid-group-cell-rownumber");var a=n.lockColumns,f=0,l=0,c=a.length;for(;l<c;l++)a[l]!=null&&f++;var l=0,c=n.groupList.length;for(;l<c;l++){n._groupListData[l]=$.dataGrid._undef(n._groupListData[l],[]);var h=t.tpl(t.getTpl("group_row"),{gid:l,w:parseFloat(o),id:n.id,colspan:n.columns.length-f,html:n.groupList[l],num:n._groupListData[l].length}),p=$(i).find(".datagrid-body tr[datagrid-group-id='"+l+"']");p.size()<=0&&(p=$(i).find(".datagrid-header .datagrid-header-outer .datagrid-locktable tr[datagrid-group-id='"+l+"']"));var d=$(s).find("tr[datagrid-group-id='"+l+"']"),v="<tr id='"+n.id+"-group-view1-row-"+l+"' datagrid-group-row-id='"+l+"' class='datagrid-group-row-view1'><td colspan='"+(f+1)+"'><div class='"+u+"'></div></td></tr>",m=$(h),g=$(v);if($("#"+n.id+"-group-row-"+l).size())$("#"+n.id+"-group-row-"+l).replaceWith(m),$("#"+n.id+"-group-view1-row-"+l).replaceWith(g),p.first().is(":hidden")||g.find("div.datagrid-group-cell-rownumber").addClass("datagrid-group-cell-rownumber-select");else if(p.size())m.insertBefore(p.first()),g.insertBefore(d.first()),p.first().is(":hidden")||g.find("div.datagrid-group-cell-rownumber").addClass("datagrid-group-cell-rownumber-select");else{for(var y=l-1;y>=0;y--){var b=$(i).find("tr[datagrid-group-id='"+l+"']"),w=$(s).find("tr[datagrid-group-id='"+l+"']");if(b.size()){m.insertAfter(b.last()),g.insertAfter(w.first());break}}y<0&&(m.appendTo($(i).find(".datagrid-body .datagrid-btable tbody")),g.appendTo($(s).find(".datagrid-body .datagrid-btable tbody")))}var E=m.height();g.height(E),E!=g.height()&&g.height(E-1),n.groupListCallBack.call(t,m.find(".datagrid-group-cell"),n.groupList[l],n._groupListData[l])}t.setGroupEvent()},setGroupEvent:function(){var e=this,t=e.configs,n=t.gid,r=n+" .datagrid-view2",i=n+" .datagrid-view1",s=0,o=t.groupList.length;for(;s<o;s++)$(r).find("#"+t.id+"-group-row-"+s).click(function(){var t=$(this).attr("datagrid-group-row-id"),n=$(this).find(".datagrid-group-cell");n.hasClass("datagrid-group-cell-select")?e.hideGroup(t):e.showGroup(t)}),$(i).find("#"+t.id+"-group-view1-row-"+s).click(function(){var t=$(this).attr("datagrid-group-row-id"),n=$(this).find(".datagrid-group-cell-rownumber");n.hasClass("datagrid-group-cell-rownumber-select")?e.hideGroup(t):e.showGroup(t)})},groupByField:function(e,t,n){var r=this,i=r.configs,s=i.gid,e=$.dataGrid._undef(e,i.groupBy),t=$.dataGrid._undef(t,i.data),n=$.dataGrid._undef(n,i.groupList);i._groupList=$.dataGrid._undef(i._groupList,i.groupList);if(e===!1)return r;var o=i.columns,u=!1,a=!1;for(var f=0;f<o.length;f++)if(o[f]["field"]==e){a=e,u=o[f].index;break}if(a===!1)return i.groupBy=a,r;e=a,i.groupBy=e;var l=[];if(i._groupList===!1){n=[];var c=t.length;for(var f=0;f<c;f++)r.inArray(t[f][u],n)===-1&&n.push(t[f][u])}i.groupList=n;var h=n.length,p=t.length;for(var d=0;d<h;d++){var v=[];for(var m=0;m<p;m++)t[m][u]==n[d]&&(t[m]._groupid_=d,v.push(t[m]));l[d]=v,v=[]}i._groupListData=l,t=[];var g=0,y=l.length;for(;g<y;g++){var b=l[g].length;for(var w=0;w<b;w++)t.push(l[g][w])}return i.data=t,r},searchData:function(e,t,n,r){var i=this,s=i.configs,o=s.gid,e=$.dataGrid._undef(e,null);if(e==null)return i;i.clearSearch(!1);var t=$.dataGrid._undef(t,!1),u=t,a=s.columns;if(t!==!1){var f=!1,l=a.length;for(var c=0;c<l;c++)if(a[c]["field"]==t){f=t,u=a[c].index;break}t=f}if(typeof n=="undefined")var n=i.getAsync();s.cacheData.searchAsync=n;var r=$.dataGrid._undef(r,s.cacheData.searchData||s.cacheData.source||s.data);s.cacheData.searchData=s.cacheData.searchData||r;if(n){s.cacheData["searched"]!=1&&(s.cacheData._url=s.url,s.cacheData._pageNumber=s.pageNumber,s.cacheData._data=s.data,s.url="",s.pageNumber=1);var h=[],p=r.length;for(var c=0;c<p;c++)if(t!==!1)r[c][u].toString().indexOf(e)!=-1&&h.push(r[c]);else{var d=a.length;for(var v=0;v<d;v++){u=a[v].index;if(r[c][a[v]["index"]].toString().indexOf(e)!=-1){h.push(r[c]);break}}}i.setGridData(h,!0),i.showGrid(function(){i.fireEvent("onSearch",[h]),i.setGridBody()},$.noop,!0)}else s.cacheData["searched"]!=1&&(s.cacheData._pageNumber=s.pageNumber,s.pageNumber=1),s.queryParams.searchText=e,s.queryParams.searchField=u,i.showGrid(function(){i.fireEvent("onSearch",[s.data]),i.setGridBody()});return s.cacheData.searched=!0,i},clearSearch:function(e){var t=this,n=t.configs,r=n.gid;if(n.cacheData.searched!==!0)return t;var e=$.dataGrid._undef(e,!0);n.cacheData.searched=!1,t.setGridData(n.cacheData.searchData),n.url=n.cacheData._url||n.url,n.pageNumber=n.cacheData._pageNumber||n.pageNumber,n.data=n.cacheData._data||n.data;try{delete n.cacheData._url}catch(i){}try{delete n.cacheData._pageNumber}catch(i){}try{delete n.cacheData.searchData}catch(i){}try{delete n.cacheData._data}catch(i){}try{delete n.queryParams.searchText}catch(i){}try{delete n.queryParams.searchField}catch(i){}return n.cacheData.searchAsync||delete n.cacheData.source,e&&(n.cacheData.searchAsync?t.refreshDataCache():t.refreshData()),delete n.cacheData.searchAsync,t},onOverRow:function(e){var t=this,n=t.configs,r=n.gid;$("#"+n.id+"-view1-row-"+e).addClass("datagrid-row-over"),$("#"+n.id+"-row-"+e).addClass("datagrid-row-over")},onOutRow:function(e){var t=this,n=t.configs,r=n.gid;$("#"+n.id+"-view1-row-"+e).removeClass("datagrid-row-over"),$("#"+n.id+"-row-"+e).removeClass("datagrid-row-over")},setGridBodyTextLimit:function(e,t){var n=this,r=n.configs,i=r.gid,s=i;if(!r.textLimit)return!1;if(typeof e=="undefined"){var t=r.data,o=r.columns,u=0,a=o.length;for(;u<a;u++){if(o[u].textLimit===!1)continue;var f=$(s).find(".datagrid-view2 .datagrid-body td[field='"+o[u].field+"']");f.each(function(e){var t=$(this).parent().attr("datagrid-row-index"),r=n.getRowData(t),i=$(this).find("div.datagrid-cell").html();typeof r[o[u]["index"]]=="undefined"&&n.setRowData(t,o[u].index,i),i=r[o[u].index];var s=$(this).find("div.datagrid-cell").width(),a=$(this).find("div.datagrid-cell").css("fontSize"),f=i;f=n.textLimit(f,s,a),$(this).find("div.datagrid-cell").html(f)})}}else if(arguments.length==2){var l=e,o=r.columns,c=[],h=l.attr("datagrid-row-index"),t=t,p="",u=0,a=o.length;for(;u<a;u++){if(o[u].textLimit===!1)continue;p=$.dataGrid._undef(t[o[u].index],"");if(p=="")continue;var d=l.find("td[field='"+o[u].field+"'] div.datagrid-cell"),v=d.width(),m=d.css("fontSize"),g=p;g=n.textLimit(g,v,m),d.html(g)}}else{var y=n.getColumnData(e,"textLimit");if(y){var f=$(s).find("tr.datagrid-row td[field='"+e+"']"),b=n.getColumnData(e,"index");f.each(function(e){var t=$(this).parent().attr("datagrid-row-index"),r=n.getRowData(t),i=$(this).find("div.datagrid-cell").html();typeof r[b]=="undefined"&&n.setRowData(t,b,i),i=r[b];var s=$(this).find("div.datagrid-cell").width(),o=$(this).find("div.datagrid-cell").css("fontSize"),u=i;u=n.textLimit(u,s,o),$(this).find("div.datagrid-cell").html(u)})}}},bindRowEvent:function(e,t){var n=this,r=n.configs,i=r.data,s=r.gid;typeof e=="undefined"&&(e=!1),typeof t=="undefined"&&(t=!1);var o=r.columns,u={click:function(e){var t=$(this).attr("datagrid-row-index"),i=n.getRowData(t);r.autoScrollToRow&&n.scrollToRow(t);var s=n.cellEvents(t,e);if(s===!1)return!1;var o=n.fireEvent("onClickRow",[this,t,i,e]);if(o===!1)return!1;var u=$(this).attr("datagrid-row-select"),a=n.getSlectRows();u=="1"?r.singleSelect?a.length==1&&a[0]!=t&&n.unselectRow(t):n.unselectRow(t):n.selectRow(t)},mouseover:function(e){var t=$(this).attr("datagrid-row-index"),r=n.cellEvents(t,e);if(r===!1)return!1;n.fireEvent("onOverRow",[t,e])},mouseout:function(e){var t=$(this).attr("datagrid-row-index"),r=n.cellEvents(t,e);if(r===!1)return!1;n.fireEvent("onOutRow",[t,e])},dblclick:function(e){var t=$(this).attr("datagrid-row-index"),r=n.getRowData(t),i=n.cellEvents(t,e);if(i===!1)return!1;var s=n.fireEvent("onDblClickRow",[this,t,r,e]);if(s==0)return!1},contextmenu:function(e){var t=$(this).attr("datagrid-row-index"),r=n.getRowData(t),i=n.cellEvents(t,e);if(i===!1)return!1;var s=n.fireEvent("onRowContextMenu",[this,t,r,e]);if(s==0)return!1}};e&&(e.bind(u),e.each(function(){var e=$(this),t=$(this).attr("datagrid-row-index"),i=n.getRowData(t);$.isFunction(r.rowCallBack)&&r.rowCallBack!=$.noop&&r.rowCallBack.call(n,e,t,i);if(r.rowStyler)if($.isFunction(r.rowStyler)){var s=r.rowStyler.call(n,e,t,i);typeof s=="string"&&e.addClass(s)}else typeof r.rowStyler=="string"&&e.addClass(r.rowStyler);var u=[],a=0,f=o.length;for(;a<f;a++){u=o[a];if(!$.isFunction(u.callBack)||u["callBack"]==r.noop)continue;var l=$("#"+r.id+"_"+u.field+"_row_"+t+"_cell");u.callBack.call(n,l,t,u,i)}n.setGridBodyTextLimit(e,i)}));if(t){var a={click:function(e){var t=$(this).attr("datagrid-row-index"),i=t,s=e.srcElement?e.srcElement:e.target,o=n.cellEvents(t,e);if(o===!1)return!1;n.fireEvent("onClickRowNumber",[i,e]),r.rowNumbers2Row!==!1&&$("#"+r.id+"-row-"+i).trigger("click")},mouseover:function(e){var t=$(this).attr("datagrid-row-index"),r=n.cellEvents(t,e);if(r===!1)return!1;n.fireEvent("onOverRow",[t,e])},mouseout:function(e){var t=$(this).attr("datagrid-row-index"),r=n.cellEvents(t,e);if(r===!1)return!1;n.fireEvent("onOutRow",[t,e])},dblclick:function(e){var t=n.cellEvents(rowId,e);if(t===!1)return!1;r.rowNumbers2Row!==!1&&$("#"+r.id+"-row-"+rid).trigger("dblclick")},contextmenu:function(e){}};t.bind(a)}},isCell:function(e){if(!$(e).length)return!1;if($(e).is("td")&&$(e).hasClass("datagrid-td-rownumber"))return!1;if($(e).is("tr")&&$(e).hasClass("datagrid-row"))return!1;if(!$(e).hasClass("datagrid-cell")){var t=$(e).closest("tr.datagrid-row div.datagrid-cell");if(!t.length)return!1}return!0},cellEvents:function(e,t){var n=this,r=n.configs,i=t.srcElement?t.srcElement:t.target;if(!n.isCell(i))return!0;var s=$(i),o=s.parent("td").attr("field"),u=n.getFieldValue(e,o),a=!0;switch(t.type){case"click":r.autoScrollToField&&n.scrollToField(o),a=n.fireEvent("onClickCell",[s.eq(0),e,o,u,t]);break;case"dblclick":a=n.fireEvent("onDblClickCell",[s.eq(0),e,o,u,t]);break;case"mouseover":a=n.fireEvent("onOverCell",[s.eq(0),e,o,u,t]);break;case"mouseout":a=n.fireEvent("onOutCell",[s.eq(0),e,o,u,t]);break;case"contextmenu":a=n.fireEvent("onCellContextMenu",[s.eq(0),e,o,u,t])}return a},checkToRow:function(e){var t=this,n=t.configs;t.inArray(e,n.lockRows)!=-1&&t.lockRow(e)},_insert:function(e,t,n){var r=this,i=r.configs,s=i.data,o=i.gid,u=i.columns,e=$.dataGrid._undef(e,0);if($("#"+i.id+"-row-"+e).size())return!1;var a=e,n=$.dataGrid._undef(n,!0),t=$.dataGrid._undef(t,{}),f=r.getTpl("view1_row"),l=i.rowTpl?i.rowTpl:r.getTpl("view2_row"),c=$("#view2-datagrid-body-btable-tbody-"+i.id),h=$("#view1-datagrid-body-btable-tbody-"+i.id),p={i:a,id:i.id,fields:u,rowNumbersExpand:i.rowNumbersExpand?i.rowNumbersExpand:!1,data:t,isCreate:i.isCreate,groupBy:i.groupBy,rowNumbersWidth:i.rowNumbersWidth,opt:i},d=$(r.tpl(l,p)),v=!1;i.rowNumbersWidth!==!1&&(v=$(r.tpl(f,p)));if(n)c.append(d),v!==!1&&h.append(v);else{var m=$(">tr.datagrid-row","#view2-datagrid-body-btable-tbody-"+i.id),g=[];m.each(function(e,t){g.push(Number($(t).attr("datagrid-row-index")))}),g.push(e),g.sort(function(e,t){return e>=t?1:-1});var y=r.inArray(e,g);if(!y)c.append(d),v!==!1&&h.append(v);else{var b=g[y-1];$("#"+i.id+"-row-"+b).after(d),v!==!1&&$("#"+i.id+"-view1-row-"+b).after(v)}}return i.rowTpl&&r.parseRowTpl(d,e,t),d.data("rowData",t),r.fireEvent("onAfterAddRow",[e,t]),{tr:d,ltr:v}},addRow:function(e,t){var n=this,r=n.configs,i=r.data,s=r.gid,o=r.columns,u=n.getTpl("view1_row"),a=r.rowTpl?r.rowTpl:n.getTpl("view2_row"),f=$("#view2-datagrid-body-btable-tbody-"+r.id),l=$("#view1-datagrid-body-btable-tbody-"+r.id),c=i.length,h=c,t=$.dataGrid._undef(t,!0),e=$.dataGrid._undef(e,{});if(n.getAsync()){i.push(e);var p=n.getData();p.push(e)}else i.push(e);r.total++;var d=r.pk;e[d]||(e[d]=n.unique());var v=n.fireEvent("onBeforeAddRow",[e]);if(v===!1)return!1;if(t&&c>=r.pageSize)return!0;var m=n._insert(c,e);return r.denyRowEvents===!1?n.bindRowEvent(m.tr,m.ltr):$.isFunction(r.denyRowEvents)&&r.denyRowEvents.call(n,m.tr,m.ltr),c},updateRow:function(e,t){var n=this,r=n.configs,i=r.data,s=r.gid,t=$.dataGrid._undef(t,{}),o=n.fireEvent("onBeforeUpdateRow",[e,t]);if(o===!1)return!1;var u=n.getColumnList(),a=[];for(var f in t)if(n.inArray(f,u)!=-1){var l=n.setFieldValue(e,f,t[f]);l!==!1&&a.push(f)}return n.fireEvent("onAfterUpdateRow",[e,t,a]),!0},deleteRow:function(e){var t=this,n=t.configs,r=n.data,i=n.gid,s=t.fireEvent("onBeforeDeleteRow",[e]);if(s===!1)return!1;var o=$("#"+n.id+"-row-"+e);if(!o.size())return!1;var u=$("#"+n.id+"-view1-row-"+e),r=o.data("rowData");if(!r)return!1;if(!r[n.pk])return!1;for(var a=0;a<n.data;a++)n.data[n.pk]==r[n.pk]&&n.data.splice(a,1);if(t.getAsync()){var f=t.getData();for(var a=0;a<f.length;a++)if(f[a][n.pk]==r[n.pk]){f.splice(a,1);break}}return n.total--,$("#"+n.id+"-row-"+e).remove(),$("#"+n.id+"-view1-row-"+e).remove(),t.destroyExpandRow(e),t.fireEvent("onAfterDeleteRow",[e]),!0},parseRowTpl:function(e,t,n){var r=this,i=r.configs,s=i.data,o=i.gid,u=i.columns,a=t,f=t,n=$.dataGrid._undef(n,!1);n||(n=s[a]?s[a]:{}),e.find(">td,>th").each(function(e){var t=i.id+"_"+u[e].field+"_row_"+f+"_td",n=i.id+"_"+u[e].field+"_row_"+f+"_cell",r=this;$(this).is("th")?(r=$("<td id='"+t+"' field='"+u[e].field+"' align='"+u[e].align+"'><div  id='"+n+"'  class='datagrid-cell datagrid-cell-"+u[e].field+" datagrid-cell-c1-"+u[e].field+" ' >"+$(this).html()+"</div></td>"),$(this).replaceWith(r)):$(this).attr("field",u[e].field).attr("align",u[e].align).attr("id",t).html("<div  id='"+n+"' class='datagrid-cell datagrid-cell-"+u[e].field+" datagrid-cell-c1-"+u[e].field+" ' >"+$(this).html()+"</div>")}),e.addClass("datagrid-row").attr("id",i.id+"-row-"+a).attr("datagrid-row-index",a).attr("datagrid-row-select",0),typeof n["_groupid_"]!="undefined"&&e.attr("datagrid-group-id",n._groupid_)},setRow:function(e,t){var n=this,r=n.configs,i=r.data,s=r.gid,o=r.columns,u=n.getTpl
("view1_row"),a=r.rowTpl?r.rowTpl:n.getTpl("view2_row"),f={},l=$("#view2-datagrid-body-"+r.id),c=$("#view1-datagrid-body-"+r.id),t=$.dataGrid._undef(t,$.noop),e=$.dataGrid._undef(e,0),h=r._lSize,p=1,d=['<table class="datagrid-btable" id="view1-datagrid-body-btable-'+r.id+'" cellspacing="0" cellpadding="0" border="0"><tbody id="view1-datagrid-body-btable-tbody-'+r.id+'">'],v=['<table class="datagrid-btable" id="view2-datagrid-body-btable-'+r.id+'" cellspacing="0" cellpadding="0" border="0"><tbody id="view2-datagrid-body-btable-tbody-'+r.id+'">'],m=[];$.isArray(i)||(i=[]);var g=i.length;for(var y=e;y<g;y++){if(h>0){if(p>h)break;p++,r._lStart=p}m.push(y),f={i:y,id:r.id,fields:o,rowNumbersExpand:r.rowNumbersExpand?r.rowNumbersExpand:!1,data:i[y],isCreate:r.isCreate,groupBy:r.groupBy,rowNumbersWidth:r.rowNumbersWidth,opt:r};var b=n.tpl(a,f);v.push(b);var w=!1;r.rowNumbersWidth!==!1&&(w=n.tpl(u,f),d.push(w))}v.push("</tbody></table>"),d.push("</tbody></table>"),l.html(v.join("")),c.html(d.join(""));var b=!1,w=!1;r.rowTpl?(b=$(">tr","#view2-datagrid-body-btable-tbody-"+r.id),b.each(function(e){var t=$(this),r=m[e],i=r;n.parseRowTpl(t,r)})):b=$(">tr.datagrid-row","#view2-datagrid-body-btable-tbody-"+r.id),b.each(function(e){var t=$(this).attr("datagrid-row-index");$(this).data("rowData",i[t])}),r.rowNumbersWidth!==!1&&(w=$(">tr.datagrid-row","#view1-datagrid-body-btable-tbody-"+r.id)),r.denyRowEvents===!1?n.bindRowEvent(b,w):$.isFunction(r.denyRowEvents)&&r.denyRowEvents.call(n,b,w),t(),n.afterGridShow()},view2_row:function(e){if(!e)return"";var t=this,n=t.configs,r=n.data,i=n.gid;typeof e.data[n.pk]=="undefined"&&(e.data[n.pk]=t.unique());var s=[];typeof e.data["_groupid_"]!="undefined"&&(s.push("datagrid-group-id="),s.push(e.data._groupid_)),s=s.join("");var o=(e.i+1)%2?"datagrid-row-single":"datagrid-row-double",u=[];u.push('<tr id="'),u.push(e.id),u.push("-row-"),u.push(e.i),u.push('" '),u.push(s),u.push(' datagrid-row-index="'),u.push(e.i),u.push('" datagrid-row-select="0" class="datagrid-row '),u.push(o),u.push('">');var a=0,f=e.fields.length;for(;a<f;a++){var l=[];l.push(n.id),l.push("_"),l.push(e.fields[a].field),l.push("_row_"),l.push(e.i),l.push("_td"),l=l.join("");var c=[];c.push(n.id),c.push("_"),c.push(e.fields[a].field),c.push("_row_"),c.push(e.i),c.push("_cell"),c=c.join("");var h=e.fields[a].field,p=e.fields[a].index,d=e.fields[a]._expand!==!1?n.self.tpl(e.fields[a]._expand,e.data):e.data[p];u.push('<td field="'),u.push(h),u.push('" id="'),u.push(l),u.push('" align="'),u.push(e.fields[a].align),u.push('">'),u.push('<div id="'),u.push(c),u.push('" class="datagrid-cell datagrid-cell-'),u.push(h),u.push(" datagrid-cell-c1-"),u.push(h),u.push(" "),u.push(e.fields[a].bcls),u.push('" >'),u.push(d),u.push("</div></td>")}return u.push("</tr>"),u.join("")},view1_row:function(e){if(!e)return"";var t=this,n=t.configs,r=n.data,i=n.gid,s=[];typeof e.data["_groupid_"]!="undefined"&&(s.push("datagrid-group-id="),s.push(e.data._groupid_)),s=s.join("");var o=(e.i+1)%2?"datagrid-row-single":"datagrid-row-double",u=[];u.push(n.id),u.push("_row_"),u.push(e.i),u.push("_td_rownumber"),u=u.join("");var a=[];a.push(n.id),a.push("_row_"),a.push(e.i),a.push("_cell_rownumber"),a=a.join("");var f=[];f.push('<tr id="'),f.push(e.id),f.push("-view1-row-"),f.push(e.i),f.push('" '),f.push(s),f.push(' datagrid-row-index="'),f.push(e.i),f.push('" datagrid-row-select="0" class="datagrid-row datagrid-row-view1 '),f.push(o),f.push('">'),f.push('<td id="'),f.push(u),f.push('" align="center" class="datagrid-td-rownumber"><div id="'),f.push(a),f.push('" class="datagrid-cell-rownumber" style="width:'),f.push(parseFloat(e.rowNumbersWidth)),f.push('px;">');var l="";return e.rowNumbersExpand===!1?l=(n.pageNumber-1)*n.pageSize+ ++e.i:e.rowNumbersExpand=="auto"?l=++e.i:$.isFunction(e.rowNumbersExpand)?l=e.rowNumbersExpand.call(t,e.data):l=n.self.tpl(e.rowNumbersExpand,e.data),f.push(l),f.push("</div></td>"),f.push("</tr>"),f.join("")},resetHeader:function(){var e=this,t=e.configs,n=t.gid;if(t.lockColumns.length){var r=0,i=t.lockColumns.length;for(;r<i;r++)if(t.lockColumns[r]!=null){e.setGridHeader();return}}if(t.lockRows.length){var r=0,i=t.lockRows.length;for(;r<i;r++)if(t.lockRows[r]!=null){e.setGridHeader();return}}},setGridBody:function(e,t){var n=this,r=n.configs,i=r.gid;n.showLoading(),n.getColumns();var t=t||$.noop;return n.fireEvent("onBeforeShowGrid",[]),setTimeout(function(){n.groupByField();var e=r.data;n.setPager();var i=r.sLeft,s=r.sTop;n.setRow(0,function(){t(),r.sLeft=i,r.sTop=s}),n.hideLoading()},0),!0},afterGridShow:function(){var e=this,t=e.configs,n=t.gid;e.addGroupRow(!0),e.fireEvent("onScroll",[!0]),e.methodCall("setGridBody"),e.fireEvent("onViewSizeChange",[]),e.fireEvent("onShowGrid",[]),e.onFinishDone=e.onFinishDone||!1,e.onFinishDone||(e.onFinishDone=!0,e.fireEvent("onFinish"))},isEmptyGrid:function(){var e=this,t=e.configs,n=t.gid;if(!t.showEmptyGridMsg)return;t.showHeader||$("#"+t.id+"_empty-grid-msg").remove();if(t.data.length>=1||!t.showHeader)return;var r=$("#view2-datagrid-header-inner-htable-"+t.id).outerWidth(),i=$("#"+t.id+"_empty-grid-msg");if(i.size()){i.width(r);return}var s=$('<div class="empty-grid-msg" id="'+t.id+'_empty-grid-msg" style="height:100%;">'+e.tpl(t.emptyGridMsg,t)+"</div>").width(r);$("#view2-datagrid-body-"+t.id).empty().append(s)},setGridFooter:function(){var e=this,t=e.configs,n=t.gid;return!0},onScroll:function(e){var t=this,n=t.configs,r=n.gid,i=i||r+" .datagrid-view2",s=r+" .datagrid-view1";e=$.dataGrid._undef(e,!1),e&&(n.sLeft>=0&&n.gbody.scrollLeft(n.sLeft),n.sTop>=0&&n.gbody.scrollTop(n.sTop)),e||(n.sLeft=n.gbody._scrollLeft(),n.sTop=n.gbody._scrollTop()),$("#view2-datagrid-header-inner-"+n.id).find(">.datagrid-header-inner-wraper")._scrollLeft(n.sLeft),$("#view2-datagrid-header-outer-"+n.id).find(">.datagrid-header-outer-wraper")._scrollLeft(n.sLeft),$("#view1-datagrid-body-"+n.id)._scrollTop(n.sTop)},showGrid:function(e,t,n){var r=this,i=r.configs,s=i.gid,o=o||s+" .datagrid-view2",e=e||$.noop,t=t||$.noop,n=$.dataGrid._undef(n,!1);r.getGridData(function(){r.fireEvent("onGetData",[i.data]),e.apply(this,arguments)},function(){t.apply(this,arguments)},n)},refreshData:function(){var e=this.configs.events,t=this,n=t.configs,r=n.gid,i=i||r+" .datagrid-view2";t.fireEvent("onBeforeRefresh"),t.showGrid(function(){t.setGridBody(i,function(){t.fireEvent("onRefresh")})})},updateGrid:function(e){var t=this,n=t.configs;t.setGridData(e,!1,!0)},refreshDataCache:function(){var e=this;e.setGridBody()},clearCache:function(){var e=this.configs;e.views=[],e.isCreate=!1,this.onFinishDone=!1,e.isShow=!1,e.pki=0},clearDataCache:function(){var e=this.configs;return e.cacheData=[],this},reLoadGrid:function(e,t){this.clearCache(),this.clearDataCache();var n=[];e.data&&(n=e.data,e.data=[]);var r=$.extend(!0,{},e);r.data=n,$.dataGrid.call(this,r)},setWH:function(e,t){var n=this;return n.fireEvent("onSizeChange",[e,t]),n},C:function(e,t){return typeof e=="undefined"?this.configs:typeof t=="undefined"?this.configs[e]:(this.configs[e]=t,this)},createGrid:function(e){var t=this,n=t.configs,r=n.gid,e=e||r+" .datagrid-view2";return t.setGridHeader(e),t.showGrid(function(){t.setGridBody(e)}),t.setGridFooter(e),t.methodCall("createGrid"),t},sortData:function(e,t,n){var r=this,i=r.configs,s=i.gid,e=$.dataGrid._undef(e,i.sortName);if(e=="")return r;var o=i.columns,u=!1,a=!1;for(var f=0;f<o.length;f++)if(o[f]["field"]==e){u=e,a=o[f].index;break}if(u===!1)return r;i.cacheData.source=i.cacheData.source||i.data;var t=$.dataGrid._undef(t,i.cacheData.source),n=$.dataGrid._undef(n,i.sortOrder),l=n=="asc"?!0:!1;return t.sort(function(e,t){return e[a]=$.dataGrid._undef(e[a],""),t[a]=$.dataGrid._undef(t[a],""),e[a]>=t[a]?l?1:-1:l?-1:1}),t},onDataChange:function(e){var t=this,n=t.configs;t.refreshData()},addData:function(e){var t=this,n=t.configs,r=t.getAsync(),i=$.dataGrid._undef(i,[]);i=$.isPlainObject(i)?[i]:i;var s=n.pk;if(r){var o=t.getData(),u=i.length;for(var a=0;a<u;a++){var e=i[a];e[s]=$.dataGrid._undef(e[s],t.unique()),o.push(e)}t.fireEvent("onAdd",[i,!0]),t.fireEvent("onDataChange",t,[i])}else t.fireEvent("onAjaxAdd",[i,function(){t.onDataChange(i)}])},updateData:function(e){var t=this,n=t.configs,r=t.getAsync(),e=$.dataGrid._undef(e,[]);e=$.isPlainObject(e)?[e]:e;var i=n.pk,s=!1;if(r){var o=e.length;for(var u=0;u<o;u++){var a=e[u];if(!$.isPlainObject(a))continue;s=$.dataGrid._undef(a[i],!1);if(s===!1)continue;var f=t.getData(),l=0,c=f.length;for(;l<c;l++)if(f[l][i]==a[i]){f[l]=a;break}}t.fireEvent("onUpdate",[e,!0]),t.fireEvent("onDataChange",[e])}else t.fireEvent("onAjaxUpdate",[e,function(){t.onDataChange(e)}])},deleteData:function(e){var t=this,n=t.configs,r=t.getAsync(),e=$.dataGrid._undef(e,[]);e=$.isPlainObject(e)?[e]:e;var i=n.pk,s=!1;if(r){var o=t.getData(),u=e.length;for(var a=0;a<u;a++){var f=e[a];if(!$.isPlainObject(f))continue;s=$.dataGrid._undef(f[i],!1);if(s===!1)continue;var l=0,u=o.length;for(;l<u;l++)if(o[l][i]==f[i])break;var c=0,h=[];for(;c<u;c++){if(l==c)continue;h.push(o[c])}o=h}t.fireEvent("onDelete",[e,!0]),t.fireEvent("onDataChange",[e])}else t.fireEvent("onAjaxDelete",[e,function(){t.onDataChange(e)}])},getAsync:function(){var e=this,t=e.configs,n=t.gid;return t.url==""||t.url===!1?!0:!1},setGridData:function(e,t,n){var r=this,i=r.configs,s=i.gid,t=$.dataGrid._undef(t,null),n=$.dataGrid._undef(n,!1);t==null&&(t=r.getAsync()),t?i.cacheData.source=e:i.data=e,i.pk=="_pk"&&r.fireEvent("onSetPk",[e]),n&&(t?r.showGrid(function(){r.setGridBody()},$.noop,!0):r.refreshDataCache())},jsonFilter:function(e){return e},metaData:function(e,t){var n=this,r=n.configs,i=e||{},t=$.dataGrid._undef(t,!1);i.rows=i.rows||[],r.data=i.rows,r.total=i.total||i.rows.length,r.pageSize=n.isNumber(i.pageSize)?i.pageSize:r.pageSize,r.pageNumber=n.isNumber(i.pageNumber)?i.pageNumber:r.pageNumber,i.columns&&(r.columns=i.columns,n.setGridHeader()),t&&n.refreshDataCache()},onLoadSuccess:function(e,t){var n=this,r=n.configs,i=r.gid,s=r.dataType.toLowerCase(),o=s+"Filter",e=e;o in n&&$.isFunction(n[o])&&(e=n[o].call(n,e)),n.metaData(e)},onLoadError:function(e,t,n){var r=this,i=r.configs,s=i.gid;r.showLoading(e),setTimeout(function(){r.hideLoading(),r.refreshDataCache()},2e3)},getGridData:function(e,t,n){var r=this,i=r.configs,s=i.gid,e=e||$.noop,t=t||$.noop,o=s+" .datagrid-view2",n=$.dataGrid._undef(n,!1);n==0&&(n=r.getAsync()),r.methodCall("getGridData");if(n){i.cacheData.source=i.cacheData.source||i.data,r.fireEvent("onSetPk",[i.cacheData.source]),i.sortName!=""&&(i.cacheData.source=r.sortData()),i.total=i.cacheData.source.length;var u=(i.pageNumber-1)*i.pageSize,a=i.pageSize*i.pageNumber;a=a>i.total?i.total:a;var f=[];for(var l=u;l<a;l++)i.cacheData.source[l]&&f.push(i.cacheData.source[l]);i.data=f,e.call(r,o);return}i.queryParams.pageNumber=i.pageNumber,i.queryParams.pageSize=i.pageSize,i.sortName!=""&&(i.queryParams.sortName=r.getColumnData(i.sortName,"index"),i.queryParams.sortOrder=i.sortOrder);var c=function(){r.fireEvent("onBeforeLoad",[i.queryParams]),r.showLoading()},h=function(t){r.hideLoading(),r.fireEvent("onLoadSuccess",[t,e]),e.call(r,o)},p=function(e){var e=$.isPlainObject(e)?e:{responseText:e};r.fireEvent("onLoadError",[e.responseText,t,e]),t.call(r,e.responseText)};$.isFunction(i.url)?(c(),i.url.call(r,i.queryParams,h,p)):$.ajax({url:i.url,type:i.method,cache:i.cache,dataType:i.dataType,data:i.queryParams,beforeSend:c,success:h,error:p})},setPk:function(e){var t=this,n=t.configs;if(n.pk!="_pk")return;n.pki=1,$.each(e,function(t,r){e[t][n.pk]=n.pki++})},show:function(){var e=this,t=e.configs,n=t.views,r=$("#"+t.id);if(t.isShow)return;t.isShow=!0;for(var i in n)r.append(n[i]);e.setGrid(),e.setView(),e.fireEvent("onViewCreate",[]),e.createGrid(),e.methodCall("show")}}),$.fn._scrollLeft=function(e){return e==undefined?this.scrollLeft():this.each(function(){$(this).css("marginLeft",e*-1)})},$.fn._scrollTop=function(e){return e==undefined?this.scrollTop():this.each(function(){$(this).css("marginTop",e*-1)})},$.fn.datagrid=function(e){if(this.size()<=0)return!1;var t=[],n=[];return e.data&&(n=e.data,e.data=[]),this.each(function(r){var i=$(this),s=$.extend(!0,{},e);s.selector=i.selector,s.helper=i,s.width=$.dataGrid._undef(s.width,i.width()),s.height=$.dataGrid._undef(s.height,i.height()),i.data("metaData",$.extend(!0,{},s,{})),e.data&&(s.data=n);var o=new $.dataGrid(s);i.data("datagrid",o),t.push(o)}),this.size()==1?this.data("datagrid"):t},$.fn.dataGrid=$.fn.datagrid,$.fn.extGrid=$.fn.datagrid,$.fn.extgrid=$.fn.datagrid,$.fn.togrid=function(cfg,_cfg){cfg=$.dataGrid._undef(cfg,{});var _cfg=$.dataGrid.getToGridOptions(_cfg),list=[];return this.each(function(i){$(this).css("display","block");if($(this).attr(_cfg.options_from)){var opt="{"+$(this).attr(_cfg.options_from)+"}";opt=eval("("+opt+")")}else var opt={};var wh={width:$(this).outerWidth(),height:$(this).outerHeight(),title:$(this).attr("title")},columns=[];$(this).find(_cfg.columns_from).size()||(_cfg.columns_from="tr:first-child td,tr:first-child th");var thead=$(this).find(_cfg.columns_from),avg_w=0;if(cfg.border!==!1||opt.border!==!1)avg_w=2/thead.size();thead.each(function(i){if($(this).attr("ignore")!=undefined)return;if($(this).attr("field"))var column_a={field:$(this).attr("field")};else var column_a={};if($(this).attr(_cfg.options_from)){var column_b="{"+$(this).attr(_cfg.options_from)+"}";column_b=eval("("+column_b+")")}else var column_b={};var column=$.extend({},column_b,column_a);column.title=$(this).html(),column.field=column.field?column.field:"field_"+Math.floor(Math.random()*999999),column.width=column.width?column.width:$(this).outerWidth()-1-1,$(this).attr("align")&&(column.align=$(this).attr("align")),column.field=="ck"&&(opt.checkBox=!0),column.field=="ed"&&(wh.editColumn=!0),columns.push(column)}),$(this).find(_cfg.columns_from).parent("tr").remove(),$(this).find(_cfg.data_from).size()||(_cfg.data_from="tr"),opt.columns=columns,opt=$.extend(!0,wh,opt,cfg);if(!opt.url){var data=[];$(this).find(_cfg.data_from).each(function(e){var t={};$(this).find(">td,>th").each(function(e){var n=$(this).html();$(this).attr("field")?t[$(this).attr("field")]=n:opt.columns[e].field&&(t[opt.columns[e].field]=n)}),data.push(t)}),opt.data=data}opt.helper=$("<div id='"+($(this).attr("id")?$(this).attr("id"):"")+"' class='datagrid "+$(this).attr("class")+"'></div>"),$(this).after(opt.helper).remove();var grid=new $.dataGrid(opt);opt.helper.data("metaData",opt),opt.helper.data("datagrid",grid),list.push(grid)}),this.size()==1?list[0]:list},$.fn.toGrid=$.fn.togrid,$.fn._resize=function(e){function n(e,t){$(document.body).css("cursor","col-resize"),$(document.body).css("-moz-user-select","none"),$(document.body).attr("unselectable","on"),t.gheader.find(".datagrid-header-inner").css("cursor","col-resize"),t.gheader.find("div.datagrid-cell").css("cursor","col-resize");var n=$("<div class='datagrid-resize'></div>"),s="#view_"+t.id;$(s).append(n);var o=$(this).offset().left-$(s).offset().left,u=$(s).height(),a=$(this).width();o=parseFloat(o)+parseFloat(a),n.css({position:"absolute",top:0,zIndex:9999,height:parseFloat(u),left:o}),t.line=n,t.x=e.clientX,t.left=o,t.offsetX=0,$(document.body).bind("selectstart",function(e){return!1}),$(document).bind("mousemove",function(e){var n=t.self.fireEvent("onResizeColumn",[t,e]);if(n===!1)return;r(e,t)}),$(document).bind("mouseup",function(e){var n=t.stop(e,t);i(e,t)})}function r(e,t){var n=e.clientX,r=t.left+(n-t.x);t.offsetX=n-t.x,t.line.css({left:r})}function i(e,t){var n="#view_"+t.id;$(document).unbind("mousemove"),$(document).unbind("mouseup"),$(document.body).unbind("selectstart"),$(document.body).css("cursor","default"),$(document.body).removeAttr("unselectable"),t.gheader.find(".datagrid-header-inner").css("cursor","default"),t.gheader.find("div.datagrid-cell").css("cursor","default"),$(t.line).remove()}var e=e||{},e=$.extend({},e),t=this;t.each(function(t){$("<div class='datagrid_resize'></div>").appendTo($(this).parent()).bind("mousedown",function(t){e.field=$(this).parent().attr("field");var r=e.self.fireEvent("onResizeColumnStart",[this,e,t]);if(r===!1)return;n.call(this,t,e),t.preventDefault(),t.stopPropagation()})})},$.fn.moveColumn=function(e){function r(t){n=!0,e.moveField=$(this).attr("field");var r=$('<div class="column-move" id="'+e.id+'_move" style="position:absolute;z-index:9999;">'+$(".datagrid-cell",this).html()+"</div>").appendTo("#"+e.id),i=$('<div class="column-move-line" id="'+e.id+'_line" style="position:absolute;height:'+$(this).outerHeight()+'px;"></div>').appendTo("#"+e.id),s=$("#"+e.id).offset();r.css({left:t.pageX-s.left+10,top:t.pageY-s.top+10}),$(document.body).bind("mousemove.move",function(e){r.css({left:e.pageX-s.left+10,top:e.pageY-s.top+10}),e.preventDefault(),e.stopPropagation()}),$(document.body).bind("mouseup.move",function(t){n=!1,r.remove(),i.remove(),$(document.body).unbind("mousemove.move mouseup.move"),e.self.fireEvent("onColumnMove",[e]),t.preventDefault(),t.stopPropagation()})}var t=this,n=!1;t.bind("mousedown.move",function(t){var n=this,i=setTimeout(function(){r.call(n,t)},e.moveColumnTm);$(document.body).bind("mouseup.wt",function(e){clearTimeout(i),$(document.body).unbind("mouseup.wt")}),t.preventDefault(),t.stopPropagation()}),t.bind("mousemove.h",function(t){if(n==0)return;var r=$("#"+e.id).offset(),i=r.top,s=r.left,o=$(this).outerWidth(),u=$(this).height()-2,a=$(this).offset().top-i,f=$(this).offset().left-s-2,l=t.pageX,c=l-$(this).offset().left;e.moveToField=$(this).attr("field");var h=e.self.fireEvent("onColumnMoving",[e]);if(h===!1)return;c<=o/2?($("#"+e.id+"_line").css({left:f,top:a,height:u}),e.moveToFieldPos=1):($("#"+e.id+"_line").css({left:f+o,top:a,height:u}),e.moveToFieldPos=0)})}})(jQuery);